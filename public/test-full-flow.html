<!DOCTYPE html>
<html>
<head>
    <title>ğŸš€ ë§Œë¦¬ì¥ì„± ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .step { margin: 20px 0; padding: 20px; border: 2px solid #ddd; border-radius: 10px; }
        .step.running { border-color: #3b82f6; background: #eff6ff; }
        .step.success { border-color: #10b981; background: #ecfdf5; }
        .step.error { border-color: #ef4444; background: #fef2f2; }
        .result { margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        button { padding: 15px 30px; font-size: 16px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px 5px; }
        button:hover { background: #2563eb; }
        button:disabled { background: #9ca3af; cursor: not-allowed; }
        .loading { color: #3b82f6; }
        h1 { color: #1f2937; }
        h3 { color: #374151; margin: 0 0 10px 0; }
        .timer { font-weight: bold; color: #059669; }
    </style>
</head>
<body>
    <h1>ğŸš€ ë§Œë¦¬ì¥ì„± ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</h1>
    <p>ìë™ì™„ì„± â†’ ì§€ì—­ì •ë³´ ì¶”ì¶œ â†’ ê°€ì´ë“œ ìƒì„±ê¹Œì§€ ì „ì²´ í”Œë¡œìš°ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
    
    <button onclick="runFullFlow()">ğŸ¯ ì „ì²´ í”Œë¡œìš° ì‹¤í–‰</button>
    <button onclick="clearResults()">ğŸ”„ ê²°ê³¼ ì´ˆê¸°í™”</button>
    
    <div id="results"></div>

    <script>
        let testData = {};
        
        async function runFullFlow() {
            clearResults();
            testData = {};
            
            await step1_autocomplete();
            await step2_guideGeneration();
            
            console.log('ğŸ‰ ì „ì²´ í”Œë¡œìš° ì™„ë£Œ!', testData);
        }
        
        async function step1_autocomplete() {
            const stepDiv = createStepDiv('step1', 'ğŸ” Step 1: ìë™ì™„ì„± API í…ŒìŠ¤íŠ¸');
            
            try {
                stepDiv.className = 'step running';
                const startTime = Date.now();
                
                const response = await fetch(`/api/locations/search?q=${encodeURIComponent('ë§Œë¦¬ì¥ì„±')}&lang=ko`);
                const responseTime = Date.now() - startTime;
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
                    const firstResult = data.data[0];
                    testData.locationData = firstResult;
                    
                    stepDiv.className = 'step success';
                    stepDiv.innerHTML += `
                        <div class="result">âœ… ìë™ì™„ì„± ì„±ê³µ (${responseTime}ms)
ì´ë¦„: ${firstResult.name}
ìœ„ì¹˜: ${firstResult.location}
ì§€ì—­: ${firstResult.region}
êµ­ê°€: ${firstResult.country} (${firstResult.countryCode})
íƒ€ì…: ${firstResult.type}</div>`;
                    
                    return true;
                } else {
                    throw new Error('ìë™ì™„ì„± ê²°ê³¼ ì—†ìŒ');
                }
                
            } catch (error) {
                stepDiv.className = 'step error';
                stepDiv.innerHTML += `<div class="result">âŒ ì—ëŸ¬: ${error.message}</div>`;
                return false;
            }
        }
        
        async function step2_guideGeneration() {
            if (!testData.locationData) {
                return false;
            }
            
            const stepDiv = createStepDiv('step2', 'ğŸ“ Step 2: ìˆœì°¨ ê°€ì´ë“œ ìƒì„± API í…ŒìŠ¤íŠ¸');
            
            try {
                stepDiv.className = 'step running';
                const startTime = Date.now();
                
                // ì§€ì—­ ì •ë³´ë¥¼ URL íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
                const params = new URLSearchParams({
                    region: testData.locationData.region || '',
                    country: testData.locationData.country || '',
                    countryCode: testData.locationData.countryCode || '',
                    type: testData.locationData.type || 'attraction'
                });
                
                const guideUrl = `/api/ai/generate-sequential-guide?${params.toString()}`;
                stepDiv.innerHTML += `<div class="result">ğŸš€ í˜¸ì¶œ URL: ${guideUrl}</div>`;
                
                const response = await fetch(guideUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        locationName: testData.locationData.name,
                        language: 'ko'
                    })
                });
                
                const responseTime = Date.now() - startTime;
                const data = await response.json();
                
                stepDiv.className = 'step success';
                stepDiv.innerHTML += `
                    <div class="result">âœ… ê°€ì´ë“œ ìƒì„± ì„±ê³µ (${responseTime}ms)
ì‘ë‹µ íƒ€ì…: ${typeof data}
ì„±ê³µ ì—¬ë¶€: ${data.success || 'N/A'}
ê°€ì´ë“œ ê¸¸ì´: ${data.guide ? data.guide.length : 'N/A'}ì
ì¢Œí‘œ ì •ë³´: ${data.coordinates ? 'YES' : 'NO'}
DB ì €ì¥: ${data.saved ? 'YES' : 'NO'}</div>`;
                
                if (data.guide) {
                    stepDiv.innerHTML += `<div class="result">ğŸ“– ê°€ì´ë“œ ë¯¸ë¦¬ë³´ê¸°:
${data.guide.substring(0, 200)}...</div>`;
                }
                
                testData.guideData = data;
                return true;
                
            } catch (error) {
                stepDiv.className = 'step error';
                stepDiv.innerHTML += `<div class="result">âŒ ì—ëŸ¬: ${error.message}</div>`;
                return false;
            }
        }
        
        function createStepDiv(id, title) {
            const resultsDiv = document.getElementById('results');
            const stepDiv = document.createElement('div');
            stepDiv.id = id;
            stepDiv.className = 'step';
            stepDiv.innerHTML = `<h3>${title}</h3><div class="loading">ğŸ”„ ì‹¤í–‰ ì¤‘...</div>`;
            resultsDiv.appendChild(stepDiv);
            return stepDiv;
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testData = {};
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = function() {
            setTimeout(runFullFlow, 1000);
        };
    </script>
</body>
</html>