# íŒŸìºìŠ¤íŠ¸ í”Œë¡œìš° ì •ê·œí™” ë¬¸ì„œ

> **ëª©ì **: íŒŸìºìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ì •í™•í•œ ë°ì´í„° í”Œë¡œìš°ë¥¼ ì •ì˜í•˜ê³  í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ êµ¬í˜„ ìŠ¤í™ì„ ëª…í™•íˆí•¨

## ğŸ“Š ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      íŒŸìºìŠ¤íŠ¸ í˜ì´ì§€                             â”‚
â”‚         app/podcast/[language]/[location]/page.tsx             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  1ì°¨ í”Œë¡œìš°: ë°ì´í„° ë¡œë“œ ë° í‘œì‹œ ë‹¨ê³„  â”‚
    â”‚        (ì¥ì†Œ ê²€ìƒ‰ â†’ DB ì¡°íšŒ)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“
   [DBì—ì„œ ë°œê²¬]        [DBì— ì—†ìŒ]
         â†“                    â†“
    [ê¸°ì¡´ ë°ì´í„°]       [Geminië¡œ ìƒì„±]
    íŒŒì‹± & í‘œì‹œ          ì €ì¥ & í‘œì‹œ
         â†“                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  UI í‘œì‹œ: ì˜¤ë””ì˜¤í”Œë ˆì´ì–´ + ì±•í„°ëª©ë¡   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  2ì°¨ í”Œë¡œìš°: ì¬ìƒ ë‹¨ê³„                 â”‚
    â”‚   (ì¬ìƒë²„íŠ¼ í´ë¦­ â†’ ì˜¤ë””ì˜¤ í™•ì¸)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“
   [íŒŒì¼ ìˆìŒ]          [íŒŒì¼ ì—†ìŒ]
         â†“                    â†“
    [ìˆœì°¨ ì¬ìƒ]         [TTS ìƒì„±]
    Segment Loop        ì „ì²´ ì˜¤ë””ì˜¤ ìƒì„±
         â†“                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ì˜¤ë””ì˜¤ ì¬ìƒ + ìŠ¤í¬ë¦½íŠ¸ ë™ê¸°í™”         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ 1ì°¨ í”Œë¡œìš°: ë°ì´í„° ë¡œë“œ ë° í‘œì‹œ

### 1-1. í˜ì´ì§€ ì§„ì…ì 

**íŒŒì¼**: `app/podcast/[language]/[location]/page.tsx`

```typescript
// paramsì—ì„œ languageì™€ location ì¶”ì¶œ
params.language  // 'ko', 'en', 'ja' ë“±
params.location  // ì˜ˆ: 'colosseum', 'eiffel-tower' (URL ìŠ¬ëŸ¬ê·¸)
```

**ì¤‘ìš”**: `params.location`ì€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì›ë³¸ ì§€ëª…ì„ URL ì¸ì½”ë”©í•œ ê°’
- ì…ë ¥: "ì½œë¡œì„¸ì›€" â†’ URL: "/ko/podcast/%EC%BD%9C%EB%A1%9C%EC%84%B8%EC%9B%80"
- params.location: "ì½œë¡œì„¸ì›€" (ë””ì½”ë”©ë¨)

### 1-2. ê¸°ì¡´ íŒŸìºìŠ¤íŠ¸ ì¡°íšŒ (GET)

**ì—”ë“œí¬ì¸íŠ¸**: `GET /api/tts/notebooklm/generate?location=...&language=...`

**ìš”ì²­**:
```javascript
fetch(`/api/tts/notebooklm/generate?location=${encodeURIComponent(location)}&language=${language}`)
```

**ì„œë²„ ì²˜ë¦¬**:
```typescript
// 1) ìŠ¬ëŸ¬ê·¸ ìƒì„±/ì¡°íšŒ
const slugResult = LocationSlugService.getOrCreateLocationSlug(location, language);
// ê²°ê³¼: { slug: 'colosseum', source: 'database' or 'generated' }

// 2) ìŠ¬ëŸ¬ê·¸ ê¸°ë°˜ ì—í”¼ì†Œë“œ ì¡°íšŒ
SELECT * FROM podcast_episodes
WHERE location_slug = slugResult.slug
AND language = language
ORDER BY created_at DESC
LIMIT 1;

// 3) Fallback: ì…ë ¥ê°’ ê¸°ë°˜ ì¡°íšŒ
if (not found) {
  SELECT * FROM podcast_episodes
  WHERE location_input = location
  AND language = language
  LIMIT 1;
}
```

**ì‘ë‹µ - ì—í”¼ì†Œë“œ ì—†ìŒ**:
```json
{
  "success": true,
  "data": {
    "hasEpisode": false,
    "message": "ê¸°ì¡´ íŒŸìºìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤."
  }
}
```

**ì‘ë‹µ - ì—í”¼ì†Œë“œ ìˆìŒ**:
```json
{
  "success": true,
  "data": {
    "episodeId": "uuid-xxx",
    "locationName": "ì½œë¡œì„¸ì›€",
    "language": "ko",
    "status": "completed",
    "existingEpisode": true,
    "segmentCount": 45,
    "totalDuration": 1350,
    "chapters": [
      {
        "chapterNumber": 0,
        "title": "ì¸íŠ¸ë¡œ: ì½œë¡œì„¸ì›€ ì²« ì¸ìƒ",
        "description": "8ê°œ ëŒ€í™”",
        "segmentCount": 8,
        "totalDuration": 240,
        "segments": [
          {
            "sequenceNumber": 1,
            "speakerType": "male",
            "audioUrl": "https://.../0-1ko.mp3",
            "duration": 30,
            "textContent": "ì—¬ëŸ¬ë¶„ ì•ˆë…•í•˜ì„¸ìš”!",
            "chapterIndex": 0
          },
          ...
        ]
      },
      {
        "chapterNumber": 1,
        "title": "ì±•í„°1: ì—­ì‚¬ì™€ ê±´ì¶•",
        "segmentCount": 12,
        ...
      }
    ]
  }
}
```

### 1-3. UI í‘œì‹œ (ê¸°ì¡´ ë°ì´í„° ìˆì„ ë•Œ)

**ìœ„ì¹˜**: `page.tsx` lines 780-1053

```typescript
// 1) ì²« ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸ ìë™ ë¡œë“œ
episode.segments[0].audioUrl â†’ audioRef.current.src
audioRef.current.load()

// 2) ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ í‘œì‹œ
- í˜„ì¬ ì„¸ê·¸ë¨¼íŠ¸ ì •ë³´ í‘œì‹œ (ë¼ì¸ 780-843)
  * ìŠ¤í”¼ì»¤ íƒ€ì… (male/female)
  * í˜„ì¬ ì±•í„° ì œëª©
  * í˜„ì¬ ì§„í–‰ ì‹œê°„
  * í…ìŠ¤íŠ¸ ì½˜í…ì¸  (segment.textContent)

// 3) ì±•í„° ëª©ë¡ í‘œì‹œ (ë¼ì¸ 1030-1053)
<ChapterList
  chapters={episode.chapters}
  currentChapterIndex={segment[0].chapterIndex}  // 0 (ì¸íŠ¸ë¡œ)
  onChapterSelect={(chapterIndex) => {
    // í•´ë‹¹ ì±•í„°ì˜ ì²« ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì í”„
    const firstSegmentIndex = segments.findIndex(
      seg => seg.chapterIndex === chapterIndex
    );
    jumpToSegment(firstSegmentIndex);
  }}
/>
```

**í‘œì‹œë˜ëŠ” ë‚´ìš©**:
- ì±•í„° ëª©ë¡ì—ì„œ ì¸íŠ¸ë¡œ(0)ëŠ” ì²˜ìŒë¶€í„° ì„ íƒëœ ìƒíƒœ
- ë‚˜ë¨¸ì§€ ì±•í„°ë“¤(1, 2, ...) ì œëª© í‘œì‹œ
- ê° ì±•í„°ì˜ ì„¸ê·¸ë¨¼íŠ¸ ê°œìˆ˜ í‘œì‹œ

### 1-4. ìƒˆ íŒŸìºìŠ¤íŠ¸ ìƒì„± (POST)

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/tts/notebooklm/generate`

**ìš”ì²­**:
```javascript
fetch('/api/tts/notebooklm/generate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    locationName: "ì½œë¡œì„¸ì›€",
    language: "ko",
    options: {
      priority: 'engagement',
      audienceLevel: 'intermediate',
      podcastStyle: 'educational'
    }
  })
})
```

**ì„œë²„ ì²˜ë¦¬ (ìˆœì°¨)**:

```
Step 0: ì¤‘ë³µ í™•ì¸
â”œâ”€ LocationSlugService.getOrCreateLocationSlug(locationName, language)
â””â”€ ê¸°ì¡´ ì—í”¼ì†Œë“œ ìˆìœ¼ë©´ ìƒíƒœ í™•ì¸
   â”œâ”€ completed: ë°”ë¡œ ë°˜í™˜
   â””â”€ generating/failed: ì‚­ì œ í›„ ì¬ìƒì„±

Step 1: AI ê¸°ë°˜ ì¥ì†Œ ë¶„ì„
â”œâ”€ ChapterGenerator.generatePodcastStructure(locationName, language)
â”œâ”€ ìƒì„± ê²°ê³¼:
â”‚  â”œâ”€ totalChapters: 4
â”‚  â”œâ”€ intro: { chapterIndex: 0, title: "ì¸íŠ¸ë¡œ", ... }
â”‚  â”œâ”€ chapters: [{ chapterIndex: 1, ... }, ...]
â”‚  â””â”€ locationAnalysis: { culturalSignificance, complexity, ... }

Step 2: ê¸°ì¡´ ê°€ì´ë“œ ì¡°íšŒ (ì„ íƒì )
â”œâ”€ SELECT * FROM guides WHERE locationname = locationName AND language = language
â””â”€ ìˆìœ¼ë©´: ChapterGeneratorì— ë°ì´í„° ì œê³µ (ì±•í„° ìµœì í™”)

Step 3: í˜ë¥´ì†Œë‚˜ ì¤€ë¹„
â”œâ”€ selectedPersonas ë§¤í•‘: [personaId] â†’ [personaDetails]
â””â”€ personaDetails: name, description, expertise, speechStyle, emotionalTone

Step 4: ì±•í„°ë³„ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (ìˆœì°¨)
â”œâ”€ for each chapter in [intro, chapter1, chapter2, ..., outro]
â”‚  â”œâ”€ createPodcastChapterPrompt(config) â†’ Prompt ìƒì„±
â”‚  â”œâ”€ model.generateContent(prompt) â†’ Gemini í˜¸ì¶œ
â”‚  â”œâ”€ parseDialogueScript(scriptText, language) â†’ ì„¸ê·¸ë¨¼íŠ¸ íŒŒì‹±
â”‚  â”‚  â””â”€ ê²°ê³¼: [
â”‚  â”‚      { speaker: 'male', content: '...' },
â”‚  â”‚      { speaker: 'female', content: '...' },
â”‚  â”‚      ...
â”‚  â”‚    ]
â”‚  â””â”€ chapterScript ì™„ì„±
â”‚
â””â”€ ëª¨ë“  ì±•í„° ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì§‘

Step 5: ìŠ¤í¬ë¦½íŠ¸ í†µí•©
â”œâ”€ for each chapter in chapterScripts
â”‚  â””â”€ for each segment in chapter.script.segments
â”‚     â”œâ”€ sequenceNumber ë¶€ì—¬ (1, 2, 3, ...)
â”‚     â”œâ”€ chapterIndex í‘œê¸°
â”‚     â””â”€ allSegments ë°°ì—´ì— ì¶”ê°€
â”‚
â””â”€ combinedScript ìƒì„±: "[male] ëŒ€í™”...\n[female] ëŒ€í™”...\n"

Step 6: ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
â”œâ”€ INSERT INTO podcast_episodes
â”‚  â”œâ”€ id: uuid()
â”‚  â”œâ”€ location_slug: "colosseum"
â”‚  â”œâ”€ location_input: "ì½œë¡œì„¸ì›€"
â”‚  â”œâ”€ location_names: { ko: "ì½œë¡œì„¸ì›€", en: "Colosseum", ... }
â”‚  â”œâ”€ user_script: combinedScript
â”‚  â”œâ”€ language: "ko"
â”‚  â”œâ”€ title: "ì½œë¡œì„¸ì›€ íŒŸìºìŠ¤íŠ¸"
â”‚  â”œâ”€ status: "script_ready"
â”‚  â”œâ”€ chapter_timestamps: [ì±•í„° ë©”íƒ€ë°ì´í„°]
â”‚  â””â”€ created_at: now()
â”‚
â””â”€ INSERT INTO podcast_segments (Ní–‰)
   â”œâ”€ episode_id: episodeId
   â”œâ”€ sequence_number: 1, 2, 3, ...
   â”œâ”€ speaker_type: "male" or "female"
   â”œâ”€ speaker_name: "Host" or "Curator"
   â”œâ”€ text_content: "ëŒ€í™” ë‚´ìš©"
   â”œâ”€ audio_url: NULL (ì•„ì§ ìƒì„± ì•ˆ ë¨, "script_ready" ìƒíƒœ)
   â”œâ”€ duration_seconds: estimated (30ì´ˆ ê¸°ë³¸ê°’)
   â”œâ”€ chapter_index: 0, 1, 2, ...
   â””â”€ created_at: now()

Step 7: GETìœ¼ë¡œ ì¬ì¡°íšŒ (CQRS íŒ¨í„´)
â””â”€ GET /api/tts/notebooklm/generate?location=ì½œë¡œì„¸ì›€&language=ko
   â””â”€ ì €ì¥ëœ ë°ì´í„° ë°˜í™˜
```

**ì‘ë‹µ**:
```json
{
  "success": true,
  "data": {
    "episodeId": "uuid-xxx",
    "status": "script_ready",
    "segmentCount": 45,
    "totalDuration": 1350,
    "chapters": [...ê°™ì€ êµ¬ì¡°...]
  }
}
```

**ì¤‘ìš”**: POST ì§í›„ ë°ì´í„°ëŠ” `script_ready` ìƒíƒœ
- audio_url: NULL (ì•„ì§ TTS ìƒì„± ì•ˆ ë¨)
- ìŠ¤í¬ë¦½íŠ¸ë§Œ ìƒì„±ë¨ (parseDialogueScriptë¡œ ì„¸ê·¸ë¨¼íŠ¸ë¡œ íŒŒì‹±)

---

## ğŸµ 2ì°¨ í”Œë¡œìš°: ì¬ìƒ ë‹¨ê³„

### 2-1. ì¬ìƒ ë²„íŠ¼ í´ë¦­

**í•¨ìˆ˜**: `togglePlayPause()` (line 226)

```typescript
// ì„¸ê·¸ë¨¼íŠ¸ê°€ ì—†ìœ¼ë©´ ìƒì„± ìœ ë„
if (!episode?.segments || episode.segments.length === 0) {
  await generatePodcast();
  return;
}

// í˜„ì¬ ì„¸ê·¸ë¨¼íŠ¸ì˜ audio_url í™•ì¸
const currentSegment = episode.segments[currentSegmentIndex];
if (currentSegment.audioUrl === null) {
  // TTS ìƒì„± í•„ìš”
  // (ìë™ìœ¼ë¡œ generateAudio í˜¸ì¶œí•´ì•¼ í•¨ - í˜„ì¬ ë¯¸êµ¬í˜„)
}

// ì„¸ê·¸ë¨¼íŠ¸ ë¡œë“œ ë° ì¬ìƒ
audioRef.current.src = currentSegment.audioUrl;
audioRef.current.load();
audioRef.current.play();
```

### 2-2. ì˜¤ë””ì˜¤ íŒŒì¼ í™•ì¸

**ê²½ë¡œ**: `audio/podcasts/{ì˜ì–´ìŠ¬ëŸ¬ê·¸}/{ì±•í„°ë²ˆí˜¸}-{ì„¸ê·¸ë¨¼íŠ¸ë²ˆí˜¸}{ì–¸ì–´ì½”ë“œ}.mp3`

**ì˜ˆì‹œ**:
```
audio/podcasts/colosseum/0-1ko.mp3    (ì¸íŠ¸ë¡œ ì²« ì„¸ê·¸ë¨¼íŠ¸)
audio/podcasts/colosseum/0-2ko.mp3    (ì¸íŠ¸ë¡œ ë‘ ë²ˆì§¸ ì„¸ê·¸ë¨¼íŠ¸)
audio/podcasts/colosseum/1-1ko.mp3    (ì±•í„°1 ì²« ì„¸ê·¸ë¨¼íŠ¸)
```

**Supabase ì „ì²´ URL**:
```
https://fajiwgztfwoiisgnnams.supabase.co/storage/v1/object/public/audio/podcasts/colosseum/0-1ko.mp3
```

### 2-3-A. íŒŒì¼ ìˆëŠ” ê²½ìš°: ìˆœì°¨ ì¬ìƒ

**íë¦„**:
```
1. currentSegmentIndex = 0 (ì²« ì„¸ê·¸ë¨¼íŠ¸)
2. audioRef.current.src = episode.segments[0].audioUrl
3. audioRef.current.play()
4. í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸ (timeupdate ì´ë²¤íŠ¸)
   â””â”€ setCurrentTime(audio.currentTime)
   â””â”€ totalElapsedTime ê³„ì‚°
5. ì„¸ê·¸ë¨¼íŠ¸ ì¢…ë£Œ (ended ì´ë²¤íŠ¸)
   â””â”€ currentSegmentIndex++
   â””â”€ loadAndPlaySegment(nextIndex, true)
6. ë‹¤ìŒ ì„¸ê·¸ë¨¼íŠ¸ ë¡œë“œ ë° ì¬ìƒ
7. ...ë°˜ë³µ...
8. ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸ ì¢…ë£Œ
   â””â”€ isPlaying = false
```

**ìŠ¤í¬ë¦½íŠ¸ ë™ê¸°í™”**:
```typescript
// í˜„ì¬ ì„¸ê·¸ë¨¼íŠ¸ì˜ í…ìŠ¤íŠ¸ í‘œì‹œ (line 838)
<p className="text-base text-gray-900">
  {episode.segments[currentSegmentIndex].textContent}
</p>
```

**ì¤‘ìš”**:
- ê° segmentëŠ” ë…ë¦½ì ì¸ ì˜¤ë””ì˜¤ íŒŒì¼
- sequence ìˆœì„œëŒ€ë¡œ ì¬ìƒ
- ê° segment ì¢…ë£Œ ì‹œ ë‹¤ìŒ segment ìë™ ë¡œë“œ

### 2-3-B. íŒŒì¼ ì—†ëŠ” ê²½ìš°: TTS ìƒì„±

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/tts/notebooklm/generate-audio`

**ìš”ì²­** (í•„ìš”í•œ ê²½ìš°):
```javascript
// ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì— ëŒ€í•´ TTS ìƒì„±
fetch('/api/tts/notebooklm/generate-audio', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    episodeId: episode.episodeId,
    language: language,
    segments: episode.segments  // ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ ë°°ì—´
  })
})
```

**ì„œë²„ ì²˜ë¦¬**:
```
for each segment in segments:
  1. TTS ìƒì„±: text_content â†’ ì˜¤ë””ì˜¤ íŒŒì¼
  2. íŒŒì¼ëª…: {chapterIndex}-{segmentNumber}{languageCode}.mp3
  3. Supabase Storageì— ì €ì¥
  4. audio_url ì—…ë°ì´íŠ¸
     UPDATE podcast_segments
     SET audio_url = 'generated_url'
     WHERE id = segment.id
```

**ì‘ë‹µ**:
```json
{
  "success": true,
  "data": {
    "episodeId": "uuid",
    "generatedCount": 45,
    "status": "completed",
    "segments": [
      {
        "sequenceNumber": 1,
        "audioUrl": "https://.../0-1ko.mp3"
      },
      ...
    ]
  }
}
```

**ì™„ë£Œ í›„**:
- episode.status: "script_ready" â†’ "completed"
- ëª¨ë“  segment.audioUrlì´ ìœ íš¨í•œ URLë¡œ ì„¤ì •ë¨
- ìë™ ì¬ìƒ ì‹œì‘

---

## ğŸ“‹ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì •ê·œí™”

### podcast_episodes í…Œì´ë¸”

```sql
CREATE TABLE podcast_episodes (
  -- ê¸°ë³¸ ì •ë³´
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- ìœ„ì¹˜ ì •ë³´ (ì •ê·œí™”)
  location_slug TEXT NOT NULL,        -- ì˜ì–´ ìŠ¬ëŸ¬ê·¸: 'colosseum'
  location_input TEXT NOT NULL,       -- ì›ë³¸ ì…ë ¥: 'ì½œë¡œì„¸ì›€'
  location_names JSONB NOT NULL,      -- ë‹¤êµ­ì–´: { ko: 'ì½œë¡œì„¸ì›€', en: 'Colosseum', ... }

  -- ìŠ¤í¬ë¦½íŠ¸ ë° ë©”íƒ€ë°ì´í„°
  user_script TEXT,                   -- ì „ì²´ ëŒ€í™” ìŠ¤í¬ë¦½íŠ¸
  title TEXT,                         -- ì—í”¼ì†Œë“œ ì œëª©
  language TEXT NOT NULL,             -- 'ko', 'en', 'ja', 'zh', 'es'
  status TEXT NOT NULL DEFAULT 'generating',  -- 'generating', 'script_ready', 'completed', 'failed'

  -- ì±•í„° ë©”íƒ€ë°ì´í„°
  chapter_type TEXT,                  -- 'intro', 'main', 'outro'
  chapter_number INT,                 -- ì±•í„° ìˆœë²ˆ
  chapter_timestamps JSONB,           -- [{ chapterIndex, title, duration, ... }]

  -- ì¬ìƒ ì •ë³´
  total_segments INT,                 -- ì´ ì„¸ê·¸ë¨¼íŠ¸ ê°œìˆ˜
  total_duration INT,                 -- ì´ ê¸¸ì´ (ì´ˆ)
  duration_seconds INT,               -- ì´ ê¸¸ì´ (ì´ˆ, ëŒ€ì²´ í•„ë“œ)

  -- í’ˆì§ˆ ì ìˆ˜
  quality_score NUMERIC DEFAULT 0,    -- 0-100

  -- ì €ì¥ì†Œ ì •ë³´
  folder_path TEXT,                   -- 'audio/podcasts/colosseum'
  slug_source TEXT,                   -- 'database' or 'generated'

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at TIMESTAMP DEFAULT now(),
  updated_at TIMESTAMP DEFAULT now(),

  UNIQUE(location_slug, language)
);
```

### podcast_segments í…Œì´ë¸”

```sql
CREATE TABLE podcast_segments (
  -- ê¸°ë³¸ ì •ë³´
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  episode_id UUID NOT NULL REFERENCES podcast_episodes(id) ON DELETE CASCADE,

  -- ì‹œí€€ìŠ¤ ì •ë³´
  sequence_number INT NOT NULL,       -- ì „ì²´ ìˆœì„œ: 1, 2, 3, ...
  chapter_index INT NOT NULL,         -- ì±•í„° ë²ˆí˜¸: 0 (intro), 1, 2, ...

  -- í™”ì ì •ë³´
  speaker_type TEXT NOT NULL,         -- 'male' or 'female'
  speaker_name TEXT,                  -- 'Host' or 'Curator' or 'Expert'

  -- ë‚´ìš©
  text_content TEXT NOT NULL,         -- ëŒ€í™” ë‚´ìš©

  -- ì˜¤ë””ì˜¤ ì •ë³´
  audio_url TEXT,                     -- NULL (script_ready) or full_url (completed)
  duration_seconds INT DEFAULT 30,    -- ì˜ˆìƒ ê¸¸ì´
  duration INT DEFAULT 30,            -- ì˜ˆìƒ ê¸¸ì´ (ëŒ€ì²´ í•„ë“œ)

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at TIMESTAMP DEFAULT now(),
  updated_at TIMESTAMP DEFAULT now(),

  INDEX(episode_id, sequence_number),
  INDEX(episode_id, chapter_index)
);
```

---

## ğŸ” ë°ì´í„° íë¦„ ìš”ì•½

### 1ì°¨ í”Œë¡œìš° (í˜ì´ì§€ ì§„ì…)

```
ì…ë ¥: params.location ('ì½œë¡œì„¸ì›€'), params.language ('ko')
  â†“
checkExistingPodcast()
  â”œâ”€ GET /api/tts/notebooklm/generate?location=ì½œë¡œì„¸ì›€&language=ko
  â”œâ”€ ì‘ë‹µ: hasEpisode=true/false
  â”‚
  â”œâ”€ [hasEpisode=true]
  â”‚  â””â”€ episode ê°ì²´ì— chapters, segments ë‹´ì•„ì„œ í˜ì´ì§€ ë Œë”ë§
  â”‚     â”œâ”€ ì²« ì„¸ê·¸ë¨¼íŠ¸ (segments[0]) ìë™ ë¡œë“œ
  â”‚     â”œâ”€ ì˜¤ë””ì˜¤í”Œë ˆì´ì–´ í‘œì‹œ (í˜„ì¬ ì„¸ê·¸ë¨¼íŠ¸ ì •ë³´)
  â”‚     â””â”€ ì±•í„° ëª©ë¡ í‘œì‹œ (chapter[0] ì„ íƒ ìƒíƒœ)
  â”‚
  â””â”€ [hasEpisode=false]
     â””â”€ "íŒŸìºìŠ¤íŠ¸ ìƒì„±í•˜ê¸°" ë²„íŠ¼ í‘œì‹œ
        â””â”€ í´ë¦­ ì‹œ generatePodcast()
           â”œâ”€ POST /api/tts/notebooklm/generate
           â”œâ”€ Gemini í˜¸ì¶œ (ìŠ¤í¬ë¦½íŠ¸ ìƒì„±)
           â”œâ”€ DB ì €ì¥ (script_ready ìƒíƒœ)
           â”œâ”€ GETìœ¼ë¡œ ì¬ì¡°íšŒ (CQRS)
           â””â”€ ê°™ì€ í˜ì´ì§€ ë Œë”ë§ (ì¥ì†ŒëŠ” ì´ë¯¸ í‘œì‹œë¨)
```

### 2ì°¨ í”Œë¡œìš° (ì¬ìƒ)

```
ì‚¬ìš©ì: ì¬ìƒ ë²„íŠ¼ í´ë¦­
  â†“
togglePlayPause()
  â”œâ”€ [segments ì—†ìŒ]
  â”‚  â””â”€ generatePodcast() í˜¸ì¶œ
  â”‚
  â”œâ”€ [audio_url ì—†ìŒ (script_ready)]
  â”‚  â””â”€ generateAudioFiles() í˜¸ì¶œ í•„ìš”
  â”‚     â”œâ”€ POST /api/tts/notebooklm/generate-audio
  â”‚     â”œâ”€ ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì˜ ì˜¤ë””ì˜¤ ìƒì„±
  â”‚     â”œâ”€ ê° segment.audio_url ì—…ë°ì´íŠ¸
  â”‚     â””â”€ ì¬ìƒ ì‹œì‘
  â”‚
  â””â”€ [audio_url ìˆìŒ (completed)]
     â””â”€ ìˆœì°¨ ì¬ìƒ ì‹œì‘
        â”œâ”€ currentSegmentIndex = 0
        â”œâ”€ audioRef.src = segments[0].audioUrl
        â”œâ”€ audioRef.play()
        â”œâ”€ ìŠ¤í¬ë¦½íŠ¸ ë™ê¸°í™” (í˜„ì¬ segment.textContent í‘œì‹œ)
        â”œâ”€ ended â†’ ë‹¤ìŒ ì„¸ê·¸ë¨¼íŠ¸ ë¡œë“œ
        â””â”€ ...ë°˜ë³µ...
```

---

## âš ï¸ í˜„ì¬ êµ¬í˜„ì˜ ë¬¸ì œì 

### ë¬¸ì œ 1: script_ready ìƒíƒœ ì²˜ë¦¬ ë¯¸ì™„ì„±
- **í˜„ìƒ**: POST í›„ audio_urlì´ NULL (script_ready ìƒíƒœ)
- **ì˜ˆìƒ**: ì¬ìƒ ì‹œ ìë™ìœ¼ë¡œ TTS ìƒì„±
- **í˜„ì‹¤**: ì¬ìƒ ì‹œ ì˜¤ë¥˜ ë°œìƒ (audio_urlì´ null)
- **í•´ê²°**: togglePlayPause()ì—ì„œ audio_url í™•ì¸ ë¡œì§ í•„ìš”

### ë¬¸ì œ 2: GET ì‘ë‹µì— chapters ì •ë³´ ëˆ„ë½
- **í˜„ìƒ**: GET ì‘ë‹µì— chapters ì •ë³´ê°€ ì—†ì„ ìˆ˜ ìˆìŒ
- **ì˜í–¥**: ì±•í„° ëª©ë¡ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ
- **ì›ì¸**: APIì—ì„œ chapters ì‘ë‹µ í•„ë“œ í™•ì¸ í•„ìš”

### ë¬¸ì œ 3: ì˜¤ë””ì˜¤ URL ìƒì„± ë¡œì§ ë¶ˆëª…í™•
- **í˜„ìƒ**: audio_urlì´ nullì´ê±°ë‚˜ ë¶€ë¶„ ê²½ë¡œ
- **í•„ìš”**: ì „ì²´ URL ìƒì„± (https://....../audio/podcasts/...)

### ë¬¸ì œ 4: ì²´í¬í¬ì¸íŠ¸ ë¡œì§ ì—†ìŒ
- **í˜„ìƒ**: ë¶€ë¶„ ìƒì„± ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ë¶ˆê°€
- **ì˜ˆìƒ**: ì‹¤íŒ¨í•œ ì„¸ê·¸ë¨¼íŠ¸ë§Œ ì¬ìƒì„±

---

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] GET /api/tts/notebooklm/generateì´ chapters ì •ë³´ ë°˜í™˜
- [ ] POST í›„ script_ready ìƒíƒœì¸ ë°ì´í„°ê°€ ì œëŒ€ë¡œ ì €ì¥ë¨
- [ ] page.tsxì—ì„œ audio_url í™•ì¸ ë° TTS ìƒì„± ë¡œì§ êµ¬í˜„
- [ ] ìˆœì°¨ ì¬ìƒ ì‹œ segment ìˆœì„œëŒ€ë¡œ ë¡œë“œ
- [ ] ìŠ¤í¬ë¦½íŠ¸ ë™ê¸°í™” (currentSegmentIndex â†” textContent)
- [ ] ì¬ìƒ ì™„ë£Œ í›„ ë‹¤ìŒ ì„¸ê·¸ë¨¼íŠ¸ ìë™ ë¡œë“œ
- [ ] ì¬ìƒ ì¤‘ ì±•í„° ì„ íƒ ì‹œ ì í”„ (ê°™ì€ ì„¸ê·¸ë¨¼íŠ¸ êµì²´ë¨)
- [ ] ì „ì²´ ê²½ê³¼ ì‹œê°„ ì •í™•íˆ ê³„ì‚°

