import { UserProfile } from '@/types/guide';
import { 
  LANGUAGE_CONFIGS, 
  LOCATION_TYPE_CONFIGS, 
  analyzeLocationType,
  getRecommendedSpotCount 
} from './index';

/**
 * üéØ Requisitos especializados por tipo de ubicaci√≥n para gu√≠as en espa√±ol
 */
function getLocationSpecificRequirements(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `**üè∞ Est√°ndares de Arquitectura Palaciega:**
- **Jerarqu√≠a Arquitect√≥nica**: Sal√≥n del trono ‚Üí salas de audiencia ‚Üí aposentos privados
- **Vida Palatina**: Ceremonias espec√≠ficas, rutinas diarias, eventos estacionales
- **Historia Pol√≠tica**: Decisiones hist√≥ricas importantes y eventos en este lugar
- **Artesan√≠a**: T√©cnicas constructivas, artes decorativas, excelencia ingenieril
- **Sistemas Simb√≥licos**: Emblemas reales, espacios ceremoniales, representaci√≥n del poder`;

    case 'religious':
      return `**üôè Est√°ndares de Arquitectura Religiosa:**
- **Simbolismo Sagrado**: Elementos arquitect√≥nicos y sus significados espirituales
- **Filosof√≠a Religiosa**: Ense√±anzas centrales, pr√°cticas, tradiciones espirituales
- **Patrimonio Art√≠stico**: Arte religioso, esculturas, vidrieras, iconograf√≠a
- **Espacios Lit√∫rgicos**: Pr√°cticas de culto, funciones ceremoniales, rituales sagrados
- **Experiencia Espiritual**: Meditaci√≥n, m√©todos de oraci√≥n, pr√°cticas contemplativas`;

    case 'historical':
      return `**üìö Est√°ndares de Sitios Hist√≥ricos:**
- **Hechos Hist√≥ricos**: Fechas, eventos, figuras verificadas con evidencia documental
- **Historias de Personajes**: Logros y acciones espec√≠ficas de figuras hist√≥ricas
- **Contexto Social**: Condiciones econ√≥micas, culturales y pol√≠ticas de la √©poca
- **Significado de Artefactos**: Hallazgos arqueol√≥gicos, dataci√≥n, importancia cultural
- **Relevancia Contempor√°nea**: Lecciones y perspectivas para la comprensi√≥n moderna`;

    case 'nature':
      return `**üåø Est√°ndares de Entorno Natural:**
- **Formaci√≥n Geol√≥gica**: Millones de a√±os de procesos geol√≥gicos y formaci√≥n rocosa
- **Din√°micas Ecosist√©micas**: Interacciones entre especies, redes alimentarias, biodiversidad
- **Caracter√≠sticas Clim√°ticas**: Microclima, cambios estacionales, patrones meteorol√≥gicos
- **Valor de Conservaci√≥n**: Especies en peligro, protecci√≥n de h√°bitats, importancia ecol√≥gica
- **Sostenibilidad**: Protecci√≥n ambiental y pr√°cticas de turismo responsable`;

    case 'culinary':
      return `**üçΩÔ∏è Est√°ndares de Cultura Culinaria:**
- **Ciencia Culinaria**: Fermentaci√≥n, a√±ejamiento, t√©cnicas de cocina, principios cient√≠ficos
- **Calidad de Ingredientes**: Origen, est√°ndares, propiedades nutricionales, disponibilidad estacional
- **M√©todos Tradicionales**: Recetas ancestrales, t√©cnicas de conservaci√≥n, pr√°cticas culturales
- **Perfiles de Sabor**: Balance de sabores, variaciones regionales, caracter√≠sticas distintivas
- **Historia Gastron√≥mica**: Or√≠genes, evoluci√≥n, significado cultural, adaptaciones regionales`;

    case 'cultural':
      return `**üé® Est√°ndares de Arte y Cultura:**
- **Historia del Arte**: Movimientos art√≠sticos, per√≠odos, posici√≥n del artista en la historia
- **An√°lisis de Obras**: T√©cnicas, materiales, composici√≥n, teor√≠a del color, interpretaci√≥n profesional
- **Contexto Cultural**: Condiciones sociales, pol√≠ticas y econ√≥micas que influyeron en la obra
- **Teor√≠a Est√©tica**: Est√°ndares de belleza, filosof√≠a art√≠stica, m√©todos de apreciaci√≥n
- **Valor Contempor√°neo**: C√≥mo el arte hist√≥rico inspira e influye en la cultura moderna`;

    case 'commercial':
      return `**üõçÔ∏è Est√°ndares de Cultura Comercial:**
- **Historia del Mercado**: Desarrollo de distritos comerciales, antecedentes econ√≥micos, evoluci√≥n
- **Especialidades Locales**: Materias primas, m√©todos de producci√≥n, est√°ndares de calidad
- **Sistemas Comerciales**: Distribuci√≥n tradicional y moderna, evoluci√≥n de la cadena de suministro
- **Vida Comunitaria**: Impacto del comercio en el estilo de vida local, pr√°cticas culturales
- **Impacto Econ√≥mico**: Contribuci√≥n econ√≥mica regional, empleo, ecosistema empresarial`;

    case 'modern':
      return `**üèóÔ∏è Est√°ndares de Arquitectura Moderna:**
- **Ingenier√≠a Estructural**: Tecnolog√≠a de construcci√≥n avanzada, dise√±o antis√≠smico, m√©todos innovadores
- **Filosof√≠a de Dise√±o**: Concepto del arquitecto, intenci√≥n de dise√±o, principios est√©ticos
- **Tecnolog√≠a Verde**: Eficiencia energ√©tica, construcci√≥n sostenible, consideraciones ambientales
- **Planificaci√≥n Urbana**: Papel como hito, contribuci√≥n al desarrollo urbano, integraci√≥n urbana
- **Visi√≥n Futura**: Innovaci√≥n arquitect√≥nica, conceptos de ciudad inteligente, avance tecnol√≥gico`;

    default:
      return `**üéØ Est√°ndares de Turismo Integral:**
- **Enfoque Multifac√©tico**: Cobertura equilibrada de aspectos hist√≥ricos, culturales, naturales, econ√≥micos
- **Informaci√≥n Pr√°ctica**: Transporte, instalaciones, servicios al visitante, accesibilidad
- **Car√°cter Regional**: Caracter√≠sticas √∫nicas que distinguen este lugar de otros
- **Historias Atractivas**: An√©cdotas memorables, inter√©s humano, perspectivas culturales
- **Valor Integral**: Comprensi√≥n completa del significado y atractivo del lugar`;
  }
}

/**
 * üéØ Criterios de validaci√≥n de calidad por tipo de ubicaci√≥n
 */
function getQualityRequirementsByType(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `- **Datos Arquitect√≥nicos**: Dimensiones de edificios, fechas de construcci√≥n, n√∫mero de pilares, medidas de √°rea
- **Figuras Reales**: Nombres espec√≠ficos de monarcas, per√≠odos de reinado, logros principales
- **T√©rminos T√©cnicos**: Terminolog√≠a arquitect√≥nica precisa, t√©cnicas de construcci√≥n`;
    case 'religious':
      return `- **T√©rminos Religiosos**: Nombres propios de espacios sagrados, elementos arquitect√≥nicos, objetos ceremoniales
- **Historia Fundacional**: Fechas de fundaci√≥n, fundadores, historia de renovaciones, eventos significativos
- **Pr√°cticas Religiosas**: M√©todos espec√≠ficos de culto, horarios de servicios, procedimientos ceremoniales`;
    case 'historical':
      return `- **Fechas Hist√≥ricas**: Cronolog√≠a precisa, fechas de eventos, l√≠neas de tiempo exactas
- **Figuras Hist√≥ricas**: Personas reales con logros y contribuciones documentadas
- **Detalles de Artefactos**: Fechas de excavaci√≥n, materiales, dimensiones, n√∫meros de clasificaci√≥n`;
    case 'nature':
      return `- **Datos Geol√≥gicos**: Per√≠odos de formaci√≥n, tipos de rocas, estructuras geol√≥gicas, edad de formaciones
- **Estad√≠sticas Ecol√≥gicas**: Conteos de especies, medidas de √°rea, elevaci√≥n, √≠ndices de biodiversidad
- **Datos Ambientales**: Temperaturas promedio, precipitaci√≥n, humedad, patrones clim√°ticos`;
    case 'culinary':
      return `- **Especificaciones Culinarias**: Tiempos de cocci√≥n, temperaturas, proporciones de ingredientes, m√©todos de preparaci√≥n
- **Contenido Nutricional**: Calor√≠as, nutrientes principales, beneficios para la salud, consideraciones diet√©ticas
- **Or√≠genes Hist√≥ricos**: Or√≠genes de los alimentos, variaciones regionales, evoluci√≥n cultural`;
    default:
      return `- **Datos Medibles**: A√±os, tama√±os, cantidades y otra informaci√≥n cuantificable
- **Hechos Verificables**: Informaci√≥n basada en registros oficiales, fuentes documentadas
- **T√©rminos Profesionales**: Terminolog√≠a y conceptos precisos espec√≠ficos del campo`;
  }
}

// Spanish Audio Guide Instructions
export const SPANISH_AUDIO_GUIDE_INSTRUCTIONS = {
  style: `Usted es un **Gu√≠a Tur√≠stico Profesional y Experto en Patrimonio Cultural** especializado en experiencias de audio inmersivas. Su experiencia incluye:
- **Maestro Narrador**: Transformar hechos hist√≥ricos en narrativas cautivadoras
- **Int√©rprete Cultural**: Conectar el pasado y el presente con explicaciones atractivas
- **Especialista en Contenido de Audio**: Crear guiones optimizados para entrega por voz
- **Experto Local**: Conocimiento profundo de historia regional, arquitectura y tradiciones
- **Educador Entretenido**: Hacer el aprendizaje divertido manteniendo la precisi√≥n

Su misi√≥n es crear gu√≠as de audio que se sientan como tener un amigo conocedor caminando junto a los visitantes, compartiendo historias fascinantes y perspectivas ocultas que transforman el turismo ordinario en experiencias inolvidables.`,
  
  format: `**Requisitos de Formato de Salida:**

### 1. **Solo JSON Puro**
- Devolver SOLO JSON v√°lido sin introducci√≥n, explicaci√≥n o bloques de c√≥digo (\`\`\`)
- Cumplimiento perfecto de sintaxis JSON (comas, comillas, corchetes)
- Los nombres de las claves deben ser 100% id√©nticos a los ejemplos (no traducir)

### 2. **Estructura de Ubicaci√≥n Real**
Configurar route.steps basado en el **orden de visita real y dise√±o espacial** de cada destino tur√≠stico o ubicaci√≥n.

**üéØ Formato de T√≠tulo: "Nombre de Ubicaci√≥n Espec√≠fica - Su Caracter√≠stica/Significado"**

**‚úÖ Varios Ejemplos de T√≠tulos:**
- "Catedral Principal - Donde el Arte G√≥tico Toca el Cielo"
- "Torre del Campanario - Guardi√°n del Tiempo Sagrado"  
- "Mirador - Vistas de la Ciudad M√°s All√° de la Imaginaci√≥n"
- "Patio Central - Coraz√≥n de la Sabidur√≠a Antigua"

### 3. **Conexi√≥n Perfecta de 3 Campos üö® Mejora Central**

**‚úÖ Estructura Correcta:**
\`\`\`
sceneDescription: Antecedentes + Observaci√≥n ‚Üí Pregunta de curiosidad natural
coreNarrative: Respuesta a la curiosidad + Contexto hist√≥rico ‚Üí Avance de historia de personajes  
humanStories: Historias reales de personajes ‚Üí Conclusi√≥n emocional
nextDirection: (Separado) Solo orientaci√≥n de movimiento
\`\`\`

**üö® Conectividad de Flujo Natural - ¬°Muy Importante!**
- Usar conectores √∫nicos y naturales apropiados para cada ubicaci√≥n
- Evitar plantillas predecibles, usar expresiones variadas adecuadas para situaciones
- Sonar como un gu√≠a real hablando de forma espont√°nea y natural

**‚ùå Evitar Expresiones Tipo Plantilla:**
- "¬øAlguna vez se han preguntado qu√© secretos guarda este lugar?"
- "Perm√≠tanme contarles la fascinante historia detr√°s de esto..."
- "Saben, hay una historia incre√≠ble sobre las personas aqu√≠"

**‚úÖ Expresiones Naturales Recomendadas:**
- "Lo que es particularmente interesante aqu√≠ es..."
- "Tal vez tengan curiosidad de saber que..."
- "Aqu√≠ hay algo que podr√≠a sorprenderles..."
- "Si observan de cerca, notar√°n..."`,

  qualityStandards: `**Est√°ndares de Calidad (¬°Lo M√°s Importante!):**
- **üö® Expresiones ABSOLUTAMENTE PROHIBIDAS üö®**
  * "Imaginen", "mundo maravilloso", "historias asombrosas", "experimentar√°n", "respiren profundo"
  * "aqu√≠", "este lugar" sin nombres espec√≠ficos de ubicaci√≥n
  * Saludos gen√©ricos o exclamaciones sin contexto de ubicaci√≥n
- **100% Regla de Densidad de Informaci√≥n: Cada oraci√≥n DEBE incluir al menos:**
  * N√∫meros espec√≠ficos, nombres propios, caracter√≠sticas f√≠sicas, hechos hist√≥ricos, informaci√≥n t√©cnica
- **Estructura de oraci√≥n requerida**: "{Nombre espec√≠fico del lugar}'s {caracter√≠stica espec√≠fica} es {hecho/n√∫mero espec√≠fico}"

**üìç Requisitos Esenciales de Composici√≥n de Cap√≠tulos:**
- **Generar al menos 5-7 cap√≠tulos**: Configurar cap√≠tulos separados para cada punto de observaci√≥n principal
- **Organizar seg√∫n el orden de la ruta de visita**: Ruta eficiente de un solo trazo desde la entrada hasta la salida
- **üö® CR√çTICO: Sincronizaci√≥n obligatoria entre route.steps y realTimeGuide.chapters üö®**
  * El n√∫mero de elementos en el array route.steps y el array realTimeGuide.chapters **debe coincidir exactamente**
  * El title de cada step y el title del chapter correspondiente **deben ser completamente id√©nticos**
  * El orden de los steps y el orden de los chapters **deben coincidir exactamente**
  * ¬°Violar esta regla causar√° errores del sistema!
- **Est√°ndares m√≠nimos de escritura por campo (1500+ caracteres por cap√≠tulo)**:
  * sceneDescription: 400-500+ caracteres, descripci√≥n v√≠vida que estimule los 5 sentidos
  * coreNarrative: 800-1000+ caracteres, explicaci√≥n detallada de hechos hist√≥ricos y significado
  * humanStories: 300-400+ caracteres, an√©cdotas espec√≠ficas de personas y episodios
  * nextDirection: 200-300+ caracteres, gu√≠a clara de ruta de movimiento y distancia
- **Absolutamente prohibido contenido vac√≠o**: Todos los campos deben estar llenos con contenido real`
};

// Spanish example structure
export const SPANISH_AUDIO_GUIDE_EXAMPLE = {
  "content": {
    "overview": {
      "title": "Sagrada Familia - Visi√≥n General",
      "summary": "La obra maestra inacabada de Antoni Gaud√≠, una bas√≠lica √∫nica que combina arquitectura g√≥tica y formas Art Nouveau, llevando 140 a√±os en construcci√≥n.",
      "narrativeTheme": "Donde la fe, el arte y la innovaci√≥n arquitect√≥nica se encuentran en una sinfon√≠a de piedra",
      "keyFacts": [
        {
          "title": "Obra Maestra de Gaud√≠",
          "description": "El proyecto m√°s ambicioso del genio catal√°n, iniciado en 1882"
        },
        {
          "title": "Patrimonio Mundial", 
          "description": "Declarada Patrimonio de la Humanidad por la UNESCO en 2005"
        }
      ],
      "visitInfo": {
        "duration": "Visita completa de 2-3 horas",
        "difficulty": "F√°cil caminata, algunas escaleras",
        "season": "Todo el a√±o, evitar multitudes de verano"
      }
    },
    "route": {
      "steps": [
        {
          "step": 1,
          "location": "Fachada de la Natividad",
          "title": "Fachada de la Natividad - Poema de Piedra al Nacimiento"
        },
        {
          "step": 2, 
          "location": "Interior de la Bas√≠lica",
          "title": "Interior de la Bas√≠lica - Bosque de Columnas Celestial"
        }
      ]
    },
    "realTimeGuide": {
      "chapters": [
        {
          "id": 0,
          "title": "Fachada de la Natividad - Poema de Piedra al Nacimiento",
          "sceneDescription": "Ante ustedes se alza una de las fachadas m√°s extraordinarias jam√°s concebidas por la mente humana. Cada cent√≠metro de esta piedra parece cobrar vida, contando la historia del nacimiento de Cristo a trav√©s de esculturas que desaf√≠an toda l√≥gica arquitect√≥nica tradicional. Las formas org√°nicas fluyen como si la propia naturaleza hubiera decidido construir una catedral. ¬øPueden imaginar el genio necesario para concebir semejante maravilla?",
          "coreNarrative": "Este genio ten√≠a nombre: Antoni Gaud√≠ i Cornet. Cuando comenz√≥ a trabajar en esta fachada en 1894, ya hab√≠a revolucionado la arquitectura barcelonesa, pero aqu√≠ quiso ir m√°s all√°. Su visi√≥n era crear una 'catedral del futuro' que hablara directamente al coraz√≥n de las personas, sin necesidad de palabras. Cada elemento que ven - desde las torres que se elevan como enormes termiteros hasta las esculturas que parecen derretirse en formas imposibles - fue dise√±ado para emocionar antes que para impresionar. Pero la verdadera magia de este lugar no est√° solo en su arquitectura...",
          "humanStories": "Est√° en las personas que lo hicieron posible. Como Etsuro Sotoo, un escultor japon√©s que lleg√≥ a Barcelona en 1978 para trabajar temporalmente en la Sagrada Familia y termin√≥ dedicando su vida entera al proyecto. Durante m√°s de 40 a√±os, Sotoo ha tallado √°ngeles, querubines y figuras b√≠blicas, estudiando cada pliegue de tela, cada expresi√≥n facial, para mantener vivo el esp√≠ritu de Gaud√≠. Cuenta que algunas noches sue√±a con el arquitecto catal√°n, quien le susurra secretos sobre c√≥mo debe ser tallada cada piedra.",
          "nextDirection": "Avancen ahora hacia la entrada principal de la bas√≠lica, situada unos 50 metros hacia su derecha. Al caminar, observen c√≥mo las torres parecen crecer del suelo como √°rboles gigantescos. En el interior les esperar√° una experiencia que transformar√° su percepci√≥n del espacio sagrado."
        }
      ]
    }
  }
};

/**
 * Create Spanish autonomous guide prompt
 */
export const createSpanishGuidePrompt = (
  locationName: string,
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS.es;
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
üë§ Informaci√≥n de Personalizaci√≥n del Usuario:
- Intereses: ${userProfile.interests?.join(', ') || 'General'}
- Grupo de Edad: ${userProfile.ageGroup || 'Adulto'}
- Nivel de Conocimiento: ${userProfile.knowledgeLevel || 'Intermedio'}
- Acompa√±antes: ${userProfile.companions || 'Solo'}
` : 'üë§ Audiencia tur√≠stica general';

  const specialistContext = typeConfig ? `
üéØ Configuraci√≥n de Gu√≠a Especialista:
- Tipo de ubicaci√≥n detectado: ${locationType}
- Rol de experto: ${typeConfig.expertRole}
- √Åreas de enfoque: ${typeConfig.focusAreas.join(', ')}
- Requisitos especiales: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# üéôÔ∏è "${locationName}" Generaci√≥n de Gu√≠a de Audio Profesional en Espa√±ol

## üé≠ Su Rol
Usted es un **${typeConfig?.expertRole || 'Gu√≠a Tur√≠stico Profesional'}**.
Proporcione la m√°s alta calidad de gu√≠a con experiencia especializada para ${locationName}.

${specialistContext}

## üéØ Requisitos de Informaci√≥n Especializada por Ubicaci√≥n

### üìç **Est√°ndares Profesionales ${locationType.toUpperCase()}**
${getLocationSpecificRequirements(locationType)}

${userContext}

## üìã Requisitos de Formato de Salida

### 1. **Solo JSON Puro**
- Devolver SOLO JSON v√°lido sin introducci√≥n, explicaci√≥n o bloques de c√≥digo
- Cumplimiento perfecto de sintaxis JSON (comas, comillas, corchetes)
- Los nombres de las claves deben ser 100% id√©nticos a los ejemplos

### üöÄ **Principios Fundamentales de Mejora de Calidad**
- **Experiencia**: Profundidad y perspicacia a nivel de ${typeConfig?.expertRole || 'experto integral'}
- **Precisi√≥n**: Solo hechos espec√≠ficos verificables y mediciones
- **Singularidad**: Caracter√≠sticas distintivas que distinguen esta ubicaci√≥n
- **Narrativa**: Relatos convincentes, no informaci√≥n seca

### üîç **Criterios de Validaci√≥n de Calidad ${locationType.toUpperCase()}**
${getQualityRequirementsByType(locationType)}

### üö® **Estrictamente Prohibido**
- **Frases gen√©ricas**: "Imaginen", "maravilloso", "asombroso", "experimentar√°n"
- **Referencias vagas**: "aqu√≠", "este lugar" (debe usar nombres de ubicaci√≥n espec√≠ficos)
- **Contenido no verificable**: Especulaci√≥n, suposiciones, opiniones personales
- **Contenido vac√≠o**: Informaci√≥n que solo llena espacio sin sustancia

### 2. **Estructura de Ubicaci√≥n Real**
Configurar route.steps basado en el **orden de visita real y dise√±o espacial** de cada destino tur√≠stico o ubicaci√≥n.

### 3. **Conexi√≥n Perfecta de 3 Campos üö® Mejora Central**

**üö® Conectividad de Flujo Natural - ¬°Muy Importante!**
- Usar conectores √∫nicos y naturales apropiados para cada ubicaci√≥n
- Evitar plantillas predecibles, usar expresiones variadas adecuadas para situaciones
- Sonar como un gu√≠a real hablando de forma espont√°nea y natural

**üö® Expresiones ABSOLUTAMENTE PROHIBIDAS:**
- "Imaginen", "mundo maravilloso", "historias asombrosas", "experimentar√°n", "respiren profundo"
- "aqu√≠", "este lugar" sin nombres espec√≠ficos de ubicaci√≥n
- Saludos gen√©ricos o exclamaciones sin contexto de ubicaci√≥n

**‚úÖ Expresiones Naturales Recomendadas:**
- "Lo que es particularmente interesante aqu√≠ es..."
- "Tal vez tengan curiosidad de saber que..."
- "Aqu√≠ hay algo que podr√≠a sorprenderles..."
- "Si observan de cerca, notar√°n..."

### 4. **Contenido Rico y Original**
- Estricta adherencia a los requisitos m√≠nimos de contenido
- Descripciones originales que capturen el car√°cter √∫nico de la ubicaci√≥n
- Narraci√≥n fascinante en lugar de explicaciones mundanas
- Hechos hist√≥ricos + emociones humanas + inmersi√≥n en el sitio

### 5. **Configuraci√≥n Din√°mica de Cap√≠tulos**
- **Generar n√∫mero apropiado de cap√≠tulos basado en la escala y caracter√≠sticas de la ubicaci√≥n**
- **Ubicaciones peque√±as: 3-4, Medianas: 5-6, Complejos grandes: 7-8**
- **üî¥ CR√çTICO: Coincidencia perfecta entre conteo y t√≠tulos de route.steps y realTimeGuide.chapters**

**¬°Generen la gu√≠a de audio natural y cautivadora para "${locationName}" en formato JSON puro ahora mismo!**`;

  return prompt;
};

/**
 * Enhanced autonomous research-based AI audio guide generation prompt
 */
export const createAutonomousGuidePrompt = (
  locationName: string,
  language: string = 'es',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.es;
  const audioStyle = SPANISH_AUDIO_GUIDE_INSTRUCTIONS;
  
  // Location type analysis and specialist guide setup
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
üë§ Informaci√≥n de Personalizaci√≥n del Usuario:
- Intereses: ${userProfile.interests?.join(', ') || 'General'}
- Grupo de Edad: ${userProfile.ageGroup || 'Adulto'}
- Nivel de Conocimiento: ${userProfile.knowledgeLevel || 'Intermedio'}
- Acompa√±antes: ${userProfile.companions || 'Solo'}
` : 'üë§ Audiencia tur√≠stica general';

  const specialistContext = typeConfig ? `
üéØ Configuraci√≥n de Gu√≠a Especialista:
- Tipo de ubicaci√≥n detectado: ${locationType}
- Rol de experto: ${typeConfig.expertRole}
- √Åreas de enfoque: ${typeConfig.focusAreas.join(', ')}
- Requisitos especiales: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# üéôÔ∏è Misi√≥n de Generaci√≥n de Gu√≠a de Audio Inmersiva "${locationName}"

## üé≠ Su Rol
${audioStyle.style}

${specialistContext}

## üéØ Misi√≥n
Generar un **gu√≠a de audio inmersivo en ${langConfig.name}** JSON para "${locationName}".

${userContext}

${audioStyle.format}

### 4. **Contenido Rico y Original**
- Estricta adherencia a los requisitos m√≠nimos de contenido (ver est√°ndares arriba)
- Descripciones originales que capturen el car√°cter √∫nico de la ubicaci√≥n
- Narraci√≥n fascinante en lugar de explicaciones mundanas
- Hechos hist√≥ricos + emociones humanas + inmersi√≥n en el sitio

### 5. **Configuraci√≥n Din√°mica de Cap√≠tulos**
- **Generar n√∫mero apropiado de cap√≠tulos basado en la escala y caracter√≠sticas de la ubicaci√≥n**
- **Ubicaciones peque√±as: 3-4, Medianas: 5-6, Complejos grandes: 7-8**
- **üî¥ CR√çTICO: Coincidencia perfecta entre conteo y t√≠tulos de route.steps y realTimeGuide.chapters**

## üí° Ejemplos de Escritura de Gu√≠a de Audio

**‚ùå Ejemplo Pobre (Desconectado, estilo plantilla)**:
- sceneDescription: "La Sagrada Familia es una iglesia g√≥tica. Tiene 20 metros de altura."
- coreNarrative: "Fue construida en 1882. Gaud√≠ la dise√±√≥."
- humanStories: "Muchos artistas trabajaron aqu√≠. Hubo trabajos de restauraci√≥n."

**‚úÖ Ejemplo Natural Mejorado**:
- sceneDescription: "La Sagrada Familia se alza como un testimonio del genio visionario de Antoni Gaud√≠, sus torres serpenteando hacia el cielo como si fueran organismos vivos tallados en piedra. Al acercarse a esta bas√≠lica extraordinaria, notar√°n inmediatamente c√≥mo cada superficie cuenta una historia, cada curva desaf√≠a las convenciones arquitect√≥nicas tradicionales. La luz del atardecer baila sobre las fachadas intrincadamente talladas, creando sombras que parecen revelar nuevos secretos con cada momento que pasa. ¬øSe han preguntado alguna vez c√≥mo un solo hombre pudo concebir algo tan revolucionario y atemporal a la vez?"
- coreNarrative: "La respuesta yace en la mente extraordinaria de Gaud√≠, quien en 1883 tom√≥ las riendas de este proyecto y lo transform√≥ en su obsesi√≥n de toda la vida. Su visi√≥n no era simplemente construir otra catedral, sino crear un 'poema p√©treo' que hablara directamente al alma humana. Inspir√°ndose en las formas de la naturaleza - desde las estructuras de los √°rboles hasta los patrones de crecimiento de las plantas - Gaud√≠ desarroll√≥ un lenguaje arquitect√≥nico completamente nuevo. Pero esta obra maestra no es solo el fruto de un genio solitario..."
- humanStories: "Es el resultado de generaciones de artesanos dedicados que han dado sus vidas al proyecto. Como Joan Berg√≥s, el arquitecto que durante d√©cadas estudi√≥ obsesivamente los planos originales de Gaud√≠ para descifrar sus intenciones despu√©s de que un incendio destruyera muchos de los documentos originales. Berg√≥s pasaba noches enteras reconstruyendo cada detalle a partir de fragmentos quemados y bocetos dispersos, movido por una devoci√≥n casi religiosa hacia la visi√≥n del maestro. Su trabajo permiti√≥ que la construcci√≥n continuara fielmente al esp√≠ritu original, convirtiendo a cada obrero en guardi√°n de un sue√±o centenario."

${audioStyle.qualityStandards}

## üìê Estructura JSON Final:
${JSON.stringify(SPANISH_AUDIO_GUIDE_EXAMPLE, null, 2)}

## ‚úÖ Lista de Verificaci√≥n Final
- [ ] Todo el texto escrito en ${langConfig.name}
- [ ] Coincidencia perfecta de route.steps y realTimeGuide.chapters
- [ ] 3 campos conectados naturalmente en historia de 8-9 minutos
- [ ] nextDirection maneja orientaci√≥n de movimiento solo por separado
- [ ] Narraci√≥n natural y original en lugar de expresiones de plantilla
- [ ] Sintaxis JSON 100% precisa

**üî¥ Resumen de Mejora Central üî¥**
1. **Conectar solo 3 campos**: nextDirection manejado por separado
2. **Conexiones naturales**: Expresiones variadas adecuadas para situaciones en lugar de plantillas
3. **Narraci√≥n original**: Descripciones √∫nicas que reflejen las caracter√≠sticas de la ubicaci√≥n
4. **Separaci√≥n completa**: Orientaci√≥n de movimiento solo en nextDirection

**¬°Generen la gu√≠a de audio natural y cautivadora para "${locationName}" en formato JSON puro ahora mismo!**`;

  return prompt;
};

/**
 * Spanish final guide generation prompt (compatible with index.ts)
 */
export const createSpanishFinalPrompt = (
  locationName: string,
  researchData: any,
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS.es;
  const audioStyle = SPANISH_AUDIO_GUIDE_INSTRUCTIONS;
  
  // Location type analysis and specialist guide setup
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
üë§ Informaci√≥n de Personalizaci√≥n del Usuario:
- Intereses: ${userProfile.interests?.join(', ') || 'General'}
- Grupo de Edad: ${userProfile.ageGroup || 'Adulto'}
- Nivel de Conocimiento: ${userProfile.knowledgeLevel || 'Intermedio'}
- Acompa√±antes: ${userProfile.companions || 'Solo'}
` : 'üë§ Audiencia tur√≠stica general';

  const specialistContext = typeConfig ? `
üéØ Configuraci√≥n de Gu√≠a de Campo Especialista:
- Tipo de ubicaci√≥n detectado: ${locationType}
- Rol de experto: ${typeConfig.expertRole}
- √Åreas de enfoque: ${typeConfig.focusAreas.join(', ')}
- Requisitos especiales: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# üéôÔ∏è Generaci√≥n de Gu√≠a de Audio Final "${locationName}"

## üé≠ Su Rol
${audioStyle.style}

${specialistContext}

## üìö Creaci√≥n de Gu√≠a Basada en Datos de Investigaci√≥n
Crear una gu√≠a de audio m√°s precisa y rica basada en los datos detallados de investigaci√≥n proporcionados a continuaci√≥n.

### Datos de Investigaci√≥n:
${JSON.stringify(researchData, null, 2)}

${userContext}

## üéØ Directrices de Creaci√≥n de Gu√≠a Final

### 1. **Utilizaci√≥n de Datos de Investigaci√≥n**
- Tejer naturalmente toda la informaci√≥n proporcionada en la narraci√≥n
- Reflejar con precisi√≥n hechos hist√≥ricos, fechas e informaci√≥n de personajes
- Utilizar activamente an√©cdotas interesantes o historias ocultas descubiertas en la investigaci√≥n

### 2. **Calidad del Gui√≥n de Audio**
- Transformar datos r√≠gidos de investigaci√≥n en estilo conversacional amigable
- Explicar contenido especializado de manera f√°cil e interesante
- Composici√≥n dram√°tica para mantener a los oyentes comprometidos

### 3. **Contenido Mejorado**
- Hacer cada cap√≠tulo m√°s detallado basado en datos de investigaci√≥n
- Incluir n√∫meros espec√≠ficos, fechas y nombres de personajes con precisi√≥n
- Fortalecer la narraci√≥n con perspectivas obtenidas de la investigaci√≥n

### 4. **Contenido M√≠nimo (est√°ndares en espa√±ol)**
- sceneDescription: 500+ caracteres (descripci√≥n detallada basada en investigaci√≥n)
- coreNarrative: 700+ caracteres (incluyendo hechos hist√≥ricos precisos)
- humanStories: 600+ caracteres (historias de personajes investigados)
- nextDirection: 250+ caracteres (orientaci√≥n de ruta espec√≠fica)

### 5. **Reglas Esenciales de Conexi√≥n de Campos**
- Final de sceneDescription: Pregunta o despertar curiosidad ("¬øSab√≠an que...?")
- Inicio de coreNarrative: Comenzar con respuesta a esa pregunta ("Bueno, en realidad...")
- Final de coreNarrative: Vista previa de la siguiente historia ("Pero hay algo a√∫n m√°s notable...")
- Inicio de humanStories: Recogida natural ("Exactamente, y fue entonces cuando...")

## üìê Estructura JSON Final:
${JSON.stringify(SPANISH_AUDIO_GUIDE_EXAMPLE, null, 2)}

## ‚úÖ Lista de Verificaci√≥n de Calidad
- [ ] Toda la informaci√≥n importante de los datos de investigaci√≥n reflejada
- [ ] Precisi√≥n de hechos hist√≥ricos y fechas
- [ ] Flujo natural de narraci√≥n de historias
- [ ] Composici√≥n no aburrida cuando se escucha como audio
- [ ] Contenido rico de 8-10 minutos por cap√≠tulo
- [ ] Conexi√≥n perfecta de 3 campos como un gui√≥n

**üî¥ Cumplimiento Esencial üî¥**
¬°Cada cap√≠tulo es una persona hablando continuamente durante 10 minutos!
sceneDescription ‚Üí coreNarrative ‚Üí humanStories debe
fluir naturalmente como agua.
¬°Nunca escribir cada campo como secciones independientes!

**¬°Crear la mejor gu√≠a de audio para "${locationName}" utilizando perfectamente los datos de investigaci√≥n!**`;

  return prompt;
};

/**
 * Structure generation prompt (overview + route only)
 */
export const createSpanishStructurePrompt = (
  locationName: string,
  language: string = 'es',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.es;
  const userContext = userProfile ? `
üë§ Informaci√≥n de Personalizaci√≥n del Usuario:
- Intereses: ${userProfile.interests?.join(', ') || 'General'}
- Grupo de Edad: ${userProfile.ageGroup || 'Adulto'}
` : 'üë§ Audiencia tur√≠stica general';

  // Location type analysis and recommended spot count info
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType] || LOCATION_TYPE_CONFIGS.general;
  const spotCount = getRecommendedSpotCount(locationName);

  return `# üèóÔ∏è Generaci√≥n de Estructura B√°sica de Gu√≠a "${locationName}"

## üéØ Misi√≥n
Generar **estructura b√°sica (resumen + ruta) solamente** para "${locationName}".
Incluir solo t√≠tulos para cap√≠tulos de gu√≠a en tiempo real, no generar contenido detallado.

${userContext}

## üéØ Informaci√≥n de An√°lisis de Ubicaci√≥n
- Tipo de ubicaci√≥n detectado: ${locationType}
- Conteo de puntos recomendado: ${spotCount.default}
- Rango √≥ptimo de puntos: ${spotCount.min}-${spotCount.max} puntos
- Valor por defecto recomendado: ${spotCount.default} puntos

## üìã Formato de Salida
Devolver solo JSON puro. Sin bloques de c√≥digo o explicaciones, solo JSON.

**Directrices de Decisi√≥n de Conteo de Puntos:**
- **Edificio/tienda individual peque√±o**: 3-4 puntos
- **Destino tur√≠stico de tama√±o mediano**: 5-6 puntos  
- **Instalaci√≥n/palacio complejo grande**: 7-8 puntos
- **Parque natural/sendero**: 4-6 por principales puntos de vista
- **√Årea de tour gastron√≥mico**: 5-8 dependiendo de variedad de comida

### Ejemplo de Estructura (ajustar conteo de puntos para ubicaci√≥n):
{
  "content": {
    "overview": {
      "title": "Resumen de ${locationName}",
      "summary": "Resumen breve (dentro de 200 caracteres)",
      "narrativeTheme": "Tema central en una l√≠nea",
      "keyFacts": [
        { "title": "Informaci√≥n Clave 1", "description": "Descripci√≥n" },
        { "title": "Informaci√≥n Clave 2", "description": "Descripci√≥n" }
      ],
      "visitInfo": {
        "duration": "Duraci√≥n apropiada",
        "difficulty": "Nivel de dificultad",
        "season": "Mejor temporada"
      }
    },
    "route": {
      "steps": [
        { "step": 1, "location": "Entrada", "title": "T√≠tulo del Punto 1" },
        { "step": 2, "location": "Punto Principal 1", "title": "T√≠tulo del Punto 2" },
        { "step": 3, "location": "Punto Principal 2", "title": "T√≠tulo del Punto 3" }
        // ... n√∫mero apropiado de puntos para caracter√≠sticas de ubicaci√≥n
      ]
    },
    "realTimeGuide": {
      "chapters": [
        { "id": 0, "title": "T√≠tulo del Punto 1" },
        { "id": 1, "title": "T√≠tulo del Punto 2" },
        { "id": 2, "title": "T√≠tulo del Punto 3" }
        // ... exactamente el mismo conteo que route.steps
      ]
    }
  }
}

**Importante**: 
- Los t√≠tulos de route.steps y realTimeGuide.chapters deben ser exactamente id√©nticos
- **Configurar n√∫mero apropiado de puntos considerando escala y caracter√≠sticas de ubicaci√≥n** (dentro del rango 3-8)
- Flujo natural desde entrada ‚Üí puntos principales ‚Üí final/salida
- Incluir solo t√≠tulos en cap√≠tulos, sin contenido detallado
- Devolver solo JSON puro, sin explicaciones o bloques de c√≥digo`;
};

/**
 * Chapter detail generation prompt
 */
export const createSpanishChapterPrompt = (
  locationName: string,
  chapterIndex: number,
  chapterTitle: string,
  existingGuide: any,
  language: string = 'es',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.es;

  return `üéôÔ∏è "${locationName}" Cap√≠tulo ${chapterIndex + 1}: "${chapterTitle}" Generaci√≥n Completa de Gu√≠a de Audio

üéØ Misi√≥n
Como gu√≠a tur√≠stico profesional, necesita escribir un gui√≥n de gu√≠a de audio **completo y detallado** para contar a los turistas en el punto "${chapterTitle}".

üìö Contexto de Gu√≠a Existente
${JSON.stringify(existingGuide, null, 2)}

üö® **Absolutamente Importante - Contenido Completo Requerido**
- Escribir **m√≠nimo 1600-1800 caracteres de contenido completo** en el campo narrative (¬°nunca escribir brevemente!)
- Integrar descripci√≥n del sitio + antecedentes hist√≥ricos + historias de personajes en **una historia natural**
- La IA nunca debe usar expresiones incompletas como "...m√°s detalles ser√°n..."
- **Escribir contenido completo y rico de nivel de gu√≠a real**

üìù Estructura de Escritura (conectada naturalmente como una narrative)
1. **Descripci√≥n del Sitio** (400-500 caracteres): Escena v√≠vida que los visitantes pueden ver y sentir realmente
2. **Antecedentes Hist√≥ricos** (600-700 caracteres): Historia, caracter√≠sticas arquitect√≥nicas, significado cultural de este lugar
3. **Historias de Personajes** (300-400 caracteres): Figuras hist√≥ricas reales o an√©cdotas verificadas
4. **Orientaci√≥n de Pr√≥ximo Movimiento** (100-200 caracteres): Ruta espec√≠fica y vista previa de pr√≥xima ubicaci√≥n

üé≠ Gu√≠a de Estilo
- Tono conversacional amigable ("Lo notable aqu√≠ es", "Un hecho interesante es", "Si escuchan la historia", etc.)
- Narraci√≥n educativa pero entretenida
- Cercan√≠a como si un amigo estuviera explicando al lado
- **Cada parte contin√∫a naturalmente como una historia completa**

üö´ **Absolutamente Prohibido**
- Nunca usar saludos como "Hola", "¬°Todos!", "¬°S√≠, todos!" (desde el cap√≠tulo 1)
- Prohibidas expresiones incompletas como "...se cubrir√° con m√°s detalle m√°s tarde...", "...contenido m√°s detallado en breve..."
- Prohibido escribir brevemente - **debe tener 1400-1500 caracteres de contenido rico**

‚úÖ **Expresiones de Inicio Recomendadas**
- "En esta ubicaci√≥n..." "Lo notable aqu√≠ es..." "Curiosamente..."
- "Justo frente a ustedes..." "En este lugar..."
- "Ahora estamos..." "Continuando..." "A continuaci√≥n encontraremos..."

‚úÖ Formato de Salida Requerido
**Importante: ¬°Solo salida JSON pura. Sin bloques de c√≥digo o explicaciones!**

{
  "chapter": {
    "id": ${chapterIndex},
    "title": "${chapterTitle}",
    "narrative": "En esta ubicaci√≥n, lo primero que llama la atenci√≥n es... [Escribir descripci√≥n v√≠vida del sitio en detalle 400-500 caracteres] ...Pero ¬øpor qu√© este lugar es tan especial? Fue en [per√≠odo de tiempo] cuando [explicar antecedentes hist√≥ricos y significado en detalle 600-700 caracteres] ...Dentro de esta historia hay historias verdaderamente conmovedoras de personas. [Narrar ricamente figuras hist√≥ricas reales o an√©cdotas verificadas 400-500 caracteres] ...Ahora, manteniendo estas historias significativas en mente, vamos al siguiente punto. [200-300 caracteres de ruta de movimiento espec√≠fica y vista previa de pr√≥xima ubicaci√≥n] (Total 1800-2000 caracteres de historia completa)",
    "nextDirection": "Desde su posici√≥n actual, sigan [punto de referencia: edificio principal/muro/sendero] hacia [direcci√≥n: norte/sur/este/oeste/noreste/noroeste/sureste/suroeste] por exactamente [n√∫mero] metros. En el camino, pasar√°n por [caracter√≠sticas del sendero: fuente/escultura/se√±alizaci√≥n/escaleras], y sabr√°n que han llegado cuando vean [se√±al de llegada: edificio espec√≠fico/letrero/entrada]. Tiempo de caminata: aproximadamente [n√∫mero] minutos."
  }
}

üö® Requisitos de Cumplimiento Absoluto üö®
- **El campo narrative debe ser 1400-1500 caracteres (¬°m√≠nimo 1400 caracteres!)**
- Comenzar JSON inmediatamente sin introducci√≥n o explicaci√≥n
- Absolutamente prohibidos marcadores de bloques de c√≥digo  
- Formato JSON gramaticalmente perfecto
- Nunca usar contenido incompleto o expresiones como "para ser suplementado m√°s tarde"

¬°Generen la gu√≠a de audio **completa y rica** para el cap√≠tulo "${chapterTitle}" ahora mismo!`;
};