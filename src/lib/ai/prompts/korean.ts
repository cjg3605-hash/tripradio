// 전 세계 모든 장소를 위한 범용 AI 오디오 가이드 생성 프롬프트 시스템 (개선된 버전)

import { UserProfile } from '@/types/guide';
import { 
  LANGUAGE_CONFIGS, 
  LOCATION_TYPE_CONFIGS, 
  analyzeLocationType,
  getRecommendedSpotCount 
} from './index';

/**
 * 🎯 위치 유형별 품질 검증 기준 생성
 */
function getQualityRequirementsByType(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `- **건축 수치**: 건물 높이, 건축 연도, 기둥 수, 면적 등
- **왕실 인물**: 구체적 왕 이름, 재위 기간, 주요 업적
- **건축 용어**: 추녀, 공포, 단청, 온돌 등 정확한 용어`;
    case 'religious':
      return `- **종교 용어**: 법당, 탑, 불상, 범종 등 정확한 명칭
- **창건 정보**: 창건 연도, 창건자, 중건 역사
- **종교 의례**: 구체적 수행법, 예배 시간, 의식 절차`;
    case 'historical':
      return `- **역사 연도**: 정확한 연대, 사건 발생일
- **역사 인물**: 실존 인물의 구체적 행적과 업적
- **유물 정보**: 출토 연도, 재질, 크기, 문화재 지정번호`;
    case 'nature':
      return `- **지질 정보**: 형성 연대, 암석 종류, 지질 구조
- **생태 데이터**: 서식 동식물 종 수, 면적, 해발고도
- **환경 수치**: 연평균 기온, 강수량, 습도 등`;
    case 'culinary':
      return `- **조리 정보**: 조리 시간, 온도, 재료 비율
- **영양 성분**: 칼로리, 주요 영양소, 효능
- **역사 정보**: 음식의 기원, 지역별 변화 과정`;
    default:
      return `- **구체적 수치**: 연도, 크기, 개수 등 측정 가능한 데이터
- **검증 가능한 사실**: 공식 기록, 문헌에 근거한 정보
- **전문 용어**: 해당 분야의 정확한 용어와 개념`;
  }
}

/**
 * 🎯 위치 유형별 전문 정보 요구사항 생성
 */
function getLocationSpecificRequirements(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `**🏰 궁궐 전문 해설 기준:**
- **건축 위계**: 정전→편전→침전 순서의 공간 배치와 의미
- **왕실 생활**: 구체적인 의례, 하루 일과, 계절별 행사
- **정치사**: 주요 역사적 사건과 결정이 이뤄진 장소
- **장인 기술**: 단청, 목조 건축, 석조 기법의 과학적 우수성
- **상징 체계**: 용, 봉황 등 왕권 상징물의 배치와 의미`;

    case 'religious':
      return `**🙏 종교 건축 전문 해설 기준:**
- **건축 상징**: 불탑, 법당, 종루 등의 종교적 의미와 배치
- **종교 철학**: 해당 종교의 핵심 교리와 수행법
- **예술 양식**: 불상, 탱화, 스테인드글라스 등의 예술적 가치
- **의례 공간**: 예배/법회 진행 방식과 공간 활용
- **영성 체험**: 명상, 기도의 실제적 방법과 효과`;

    case 'historical':
      return `**📚 역사 유적 전문 해설 기준:**
- **역사적 사실**: 연도, 인물, 사건의 정확한 검증된 정보
- **인물 스토리**: 주요 역사 인물의 구체적 행적과 업적
- **사회적 맥락**: 당시 사회상, 문화, 경제적 배경
- **유물 가치**: 출토품, 유적의 학술적・문화적 중요성
- **현재적 의미**: 역사가 현재에 주는 교훈과 시사점`;

    case 'nature':
      return `**🌿 자연 생태 전문 해설 기준:**
- **지질 형성**: 수백만 년에 걸친 지형 형성 과정
- **생태계**: 식물군-동물군 간의 상호작용과 먹이사슬
- **기후 특성**: 미기후, 계절 변화, 기상 현상
- **보전 가치**: 멸종위기종, 서식지 보호의 중요성
- **지속가능성**: 환경 보호와 관광의 조화로운 방안`;

    case 'culinary':
      return `**🍽️ 음식 문화 전문 해설 기준:**
- **조리 과학**: 발효, 숙성, 조리법의 과학적 원리
- **식재료**: 원산지, 품질 기준, 영양학적 특성
- **전통 기법**: 대대로 전해지는 조리법과 보존 방식
- **맛의 조화**: 단맛, 짠맛, 감칠맛 등의 균형과 특징
- **식문화사**: 음식의 역사적 유래와 지역적 특색`;

    case 'cultural':
      return `**🎨 예술 문화 전문 해설 기준:**
- **예술사**: 시대별 미술 사조와 예술가의 위치
- **작품 분석**: 기법, 재료, 구도, 색채의 전문적 해석
- **문화적 맥락**: 작품이 탄생한 사회적・문화적 배경
- **미학 이론**: 미의 기준, 예술 철학, 감상법
- **현대적 가치**: 과거 예술이 현대에 주는 영감과 의미`;

    case 'commercial':
      return `**🛍️ 상업 문화 전문 해설 기준:**
- **상권 형성사**: 시장, 상가 발달 과정과 경제적 배경
- **지역 특산품**: 원료, 제조법, 품질의 우수성
- **유통 체계**: 전통적/현대적 유통 구조의 변화
- **생활 문화**: 상업 활동이 지역민 생활에 미친 영향
- **경제적 가치**: 지역 경제 기여도와 일자리 창출`;

    case 'modern':
      return `**🏗️ 현대 건축 전문 해설 기준:**
- **구조 공학**: 건축 기술, 내진 설계, 첨단 공법
- **설계 철학**: 건축가의 컨셉트와 디자인 의도
- **친환경 기술**: 에너지 효율, 지속가능한 건축 기법
- **도시 계획**: 랜드마크로서의 역할과 도시 발전 기여
- **미래 비전**: 건축이 제시하는 미래 도시의 모습`;

    default:
      return `**🎯 종합 관광 해설 기준:**
- **다각적 접근**: 역사, 문화, 자연, 경제적 측면 균형
- **실용 정보**: 교통, 시설, 이용법 등 방문객 편의
- **지역 특색**: 다른 곳과 차별화되는 고유한 매력
- **스토리텔링**: 흥미롭고 기억에 남는 일화와 이야기
- **종합적 가치**: 관광지로서의 종합적 매력과 의미`;
  }
}

// 🌍 전세계 범용 오디오 가이드 예시 - 다양한 장소 유형 적용 가능한 구조
const AUDIO_GUIDE_EXAMPLE = {
  content: {
    overview: {
      title: "[장소명 - 동적 생성]",
      location: "📍 [지역명만 간결히]",
      keyFeatures: "✨ [핵심 특징 키워드]",
      background: "🏛️ [한 줄 의미 요약]",
      narrativeTheme: "[해당 장소만의 독특한 스토리와 체험 가치]",
      keyFacts: [
        { title: "[특징/역사 요소 1]", description: "[구체적 사실 정보]" },
        { title: "[특징/역사 요소 2]", description: "[문화적/기술적 의미]" }
      ],
      visitInfo: {
        duration: "[관람 소요 시간]",
        difficulty: "[접근성/체력 요구도]",
        season: "[최적 방문 시기]"
      }
    },
    safetyWarnings: "[장소별 특수 규정이나 주의사항 - 종교시설 예배시간, 자연지역 안전수칙, 박물관 촬영규정 등]",
    mustVisitSpots: "🎯 #[핵심명소1] #[핵심명소2] #[핵심명소3] #[핵심명소4] #[핵심명소5]",
    route: {
      steps: [
        { step: 1, location: "[입구/매표소/역출구]", title: "[입구 구체적 명칭]" },
        { step: 2, location: "[주요지점1]", title: "[주요지점1 명칭]" },
        { step: 3, location: "[주요지점2]", title: "[주요지점2 명칭]" },
        { step: 4, location: "[주요지점3]", title: "[주요지점3 명칭]" },
        { step: 5, location: "[마무리지점]", title: "[마무리지점 명칭]" }
      ]
    },
    realTimeGuide: {
      chapters: [
        {
          id: 0,
          title: "[장소명] [입구]",
          narrative: "[해당 장소]는 [지역/문화권]을 대표하는 [장소 성격]으로, [독특한 가치/의미]를 담고 있는 곳입니다. 현재 우리 앞에 펼쳐진 모습을 살펴보면, [구체적 현장 묘사 - 시각적 특징, 규모감, 첫인상]이 [감정적 반응]을 불러일으킵니다. 좀 더 자세히 관찰해보시면, [세부 특징들 - 재료, 구조, 색감, 질감 등]이 [기술적/예술적 특징]을 보여줍니다. 그런데 이 [장소]가 왜 이렇게 [특별한 특징]을 가지게 되었는지 아세요? 그 이유는 바로 [역사적/문화적/지리적 배경]과 관련이 있어요. [공식 기록/연구 자료]에 기록된 바에 따르면, [연도/시기]에 [역사적 인물/집단]이 [구체적 행동/결정]을 한 것은 단순히 [표면적 목적]이 아니라, [더 깊은 의도/맥락]을 담고 있었죠. 실제로 [구체적 사례/증거]를 통해 우리는 [현재의 모습/가치]를 확인할 수 있습니다. 이런 [관련자들의 노력/역사적 과정]이 있었기에 우리가 지금 이 [의미있는 순간/경험]을 함께할 수 있는 겁니다.",
          nextDirection: "자, 이런 의미 깊은 배경을 마음에 새기며 이제 다음 지점으로 이동해볼까요? 여기서 [방향/경로]으로 약 [거리/시간] 정도 가시면 [다음 장소]가 나옵니다. 다음에서는 [다음 지점의 특별함/기대요소]가 여러분을 기다리고 있답니다!"
        },
        {
          id: 1,
          title: "[주요지점1 명칭]",
          narrative: "[지점명]은 [전체 장소] 내에서 [역할/위치]를 담당하는 [성격/기능]입니다. '[지점의 의미/명칭 유래]'라는 뜻으로, 이곳에서 [주요 활동/기능]이 이루어졌습니다. [구체적 구조/형태 묘사]로 구성되어 있으며, [기술적/예술적 특징]을 보여줍니다. [내부/세부 요소]는 [상징성/기능성]을 담고 있어, [문화적/역사적 의미]를 전달합니다.",
          nextDirection: "[현재 지점] 관람을 마치시고, 이제 [방향]으로 향해 [다음 지점]으로 이동해보겠습니다. 약 [거리/시간] 소요됩니다."
        },
        {
          id: 2,
          title: "[주요지점2 명칭]",
          narrative: "[지점명]은 [위치적 특징]에 자리한 [독특한 특징]을 가진 [공간/건축물]입니다. '[명칭 의미]'는 '[의미 해석]'라는 뜻으로, [용도/목적]에 사용되던 곳입니다. [구조적 특징 - 재료, 기법, 규모]로 [시대적/기술적 가치]를 보여줍니다. [특별한 요소들]이 [계절별/시간대별] 다른 [감상 포인트]를 선사합니다.",
          nextDirection: "[현재 지점]의 [인상적 요소]를 충분히 감상하셨다면, 이제 [다음 목적지]로 이동해보겠습니다."
        }
      ]
    }
  }
};

// 타입 정의
interface GuideContent {
  content: {
    overview: {
      title: string;
      location: string;
      keyFeatures: string;
      background: string;
      narrativeTheme: string;
      keyFacts: Array<{ title: string; description: string }>;
      visitInfo: {
        duration: string;
        difficulty: string;
        season: string;
      };
    };
    route: {
      steps: Array<{
        step: number;
        location: string;
        title: string;
      }>;
    };
    realTimeGuide: {
      chapters: Array<{
        id: number;
        title: string;
        narrative: string;
        nextDirection: string;
      }>;
    };
  };
}

// 언어별 오디오 가이드 작성 지침 (개선된 버전)
const AUDIO_GUIDE_INSTRUCTIONS = {
  ko: {
    style: `당신은 **단 한 명의 최고의 자유여행 가이드**입니다. 
    
**🎯 핵심 미션**: 당신은 관람객 바로 옆에서 친구처럼 이야기하는 **단 한 명의 자유여행 가이드**입니다. 
처음부터 끝까지 일관된 목소리와 성격으로, 해당지역에 관한 모든 것을 짧은 시간에 알려주고 싶어하듯 이야기를 자연스럽게 안내하세요.

**📝 절대 준수 사항**:

1. **완전한 단일 오디오 스크립트 생성 (🚨 매우 중요)**
   - narrative는 하나의 완전한 1500-1600자 연속 오디오 스크립트입니다
   - nextDirection은 별도 필드로, 오직 다음 장소 이동 안내만 담당
   - narrative 내부에서 자연스러운 흐름으로 모든 내용을 통합 구성
   
2. **통합된 교육적 스토리텔링 구조**
   - 배경지식 설명 + **확장된 현장관찰** (아웃라인 → 디테일) → 호기심 유발
   - 호기심의 답 제시 + 역사적 맥락 → 인물 이야기 예고
   - 실제 인물/사건 이야기 → 현재적 의미로 마무리
   - 모든 내용이 하나의 자연스러운 narrative 필드로 통합
   
3. **사실 기반 정보 제공 원칙 (🚨 매우 중요)**
   - 🚨 절대 금지: "여러분", "상상해보세요", "놀라운 이야기", "경이로운", "잠시"
   - 🚨 절대 금지: "이곳", "여기" 같은 모호한 지시어 (반드시 구체적 장소명 사용)
   - 🚨 절대 금지: 장소명 없는 일반적 호칭이나 감탄사
   - 🚨 **절대 금지: 추측, 가정, 확인되지 않은 정보, 과장된 표현**
   - ✅ **필수 원칙: 검증 가능한 사실만 사용** - 공식 기록, 문헌, 역사서에 근거한 정보만
   - ✅ 필수 포함: 구체적 수치, 고유명사, 물리적 특징, 역사적 사실, 기술적 정보
   - ✅ **사실 표현법**: "기록에 따르면", "역사서에 보면", "공식 문서에 의하면", "실제로"
   
4. **완전한 내용 구성 (단일 필드 분량 - 챕터당 1600자 목표)**
   - narrative: 1500-1600자 이상 - 배경지식 + 확장된 현장관찰 + 역사적 맥락 + 인물 이야기의 완전한 통합 스크립트
   - nextDirection: 200-300자 이상 - 명확한 이동 경로와 거리 안내
   - **총 1800자 이상의 상세한 교육적 오디오** (단일 narrative로 통합하여 더욱 자연스러운 흐름)

5. **자연스러운 내부 흐름 구성 (🎯 핵심 개선점)**
   narrative 내부에서 각 장소와 상황에 맞는 자연스러운 연결어를 사용하여 매끄러운 흐름을 만드세요:
   
   **현장관찰 → 역사적 배경 전환 (다양한 패턴)**:
   - "그런데 이 모든 것에는 어떤 비밀이 숨어있을까요? 바로 그 이야기를..."
   - "왜 이렇게 특별할까요? 그 이유는 바로..."  
   - "어떤 역사가 있을까요? 실제로 이곳은..."
   - "무엇이 이렇게 만들었을까요? 놀랍게도..."
   - "혹시 궁금하지 않으세요? 말씀드리자면..."
   - "어떤 이야기일까요? 역사를 돌아보면..."
   
   **역사적 배경 → 인물 이야기 전환 (다양한 패턴)**:
   - "이런 역사 속에는 감동적인 사람들이 있었는데, 바로 그 중 한 분이..."
   - "그 과정에서 놀라운 인물이 등장합니다. 실제로 이 분은..."
   - "당시에는 특별한 사람들이 있었어요. 예를 들어..."
   - "이 모든 것 뒤에는 누군가의 노력이 있었는데, 그 주인공은..."
   - "역사의 뒤편에는 흥미로운 인물이 있습니다. 그 분의 이야기를 들어보면..."
   - "그 시대를 살았던 사람들 중에서 특히 기억해야 할 분이..."

6. **철저한 사실 검증 원칙 (🚨 절대 준수)**
   - **모든 정보는 검증 가능한 사실만**: 공식 기록, 학술 자료, 역사 문헌 기반
   - **humanStories 엄격 기준**: 반드시 역사적으로 검증된 실존 인물과 실제 사건만
   - **절대 금지**: 가상의 인물, 꾸며낸 일화, 추측성 정보, 과장된 표현
   - **확실하지 않은 정보는 배제**: "아마도", "추정된다", "전해진다" 등의 불확실한 표현 금지
   - **사실성 강조 표현**: "기록에 따르면", "실제로", "역사서에 보면", "공식 문서에 의하면"
   - **검증된 수치만 사용**: 정확한 연도, 치수, 개수 등 공식 자료에 기반한 수치만`,
    
    examples: {
      diverse_connections: [
        "자, 그런데 이 아름다운 모습 뒤에는 어떤 이야기가 숨어있을까요?",
        "혹시 이 건물이 왜 이렇게 지어졌는지 궁금하지 않으세요?", 
        "놀랍게도 이곳에는 우리가 모르는 놀라운 비밀이 있어요",
        "실제로 이 장소에는 정말 특별한 의미가 담겨있는데요",
        "그런데 말이죠, 여기서 정말 흥미로운 것은...",
        "어떤 사연이 있을까요? 함께 알아보시죠"
      ],
      specific_information: [
        "{구체적 장소명}의 {구체적 특징}은 {구체적 사실/수치}입니다",
        "{연도}년 {인물명}이 {구체적 행동/사건}을 진행했습니다",
        "{재료/기법}으로 만들어진 {구체적 부분}은 {기능/의미}를 담고 있습니다",
        "{방향/위치}에 위치한 {구체적 명칭}은 {역사적 배경}을 보여줍니다",
        "{측정값}의 크기를 가진 {구체적 건축요소}는 {기술적 특징}을 나타냅니다",
        "{시대}의 {구체적 사건} 당시 {실존 인물}은 {검증 가능한 행동}을 했습니다"
      ]
    }
  }
};

/**
 * 한국어 가이드 생성 프롬프트 (index.ts 호환용)
 */
export const createKoreanGuidePrompt = (
  locationName: string,
  userProfile?: UserProfile,
  parentRegion?: string,
  regionalContext?: any
): string => {
  const langConfig = LANGUAGE_CONFIGS.ko;
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
- 지식수준: ${userProfile.knowledgeLevel || '중급'}
- 동행자: ${userProfile.companions || '혼자'}
` : '👤 일반 관광객 대상';

  const specialistContext = typeConfig ? `
🎯 전문 분야 가이드 설정:
- 감지된 위치 유형: ${locationType}
- 전문가 역할: ${typeConfig.expertRole}
- 중점 분야: ${typeConfig.focusAreas.join(', ')}
- 특별 요구사항: ${typeConfig.specialRequirements}
` : '';

  // 🎯 지역 컨텍스트 정보 생성
  const regionalContextInfo = parentRegion || regionalContext ? `
🌍 지역 컨텍스트 정보:
${parentRegion ? `- 상위 지역: ${parentRegion}` : ''}
${regionalContext?.parentRegion ? `- 추천 출처 지역: ${regionalContext.parentRegion}` : ''}
${regionalContext?.spotName ? `- 원래 추천 명칭: ${regionalContext.spotName}` : ''}

⚠️ **지역별 구체화 필수**: ${locationName}이 여러 지역에 존재할 수 있는 경우, 반드시 ${parentRegion || regionalContext?.parentRegion || '해당 지역'}의 ${locationName}에 특화된 정보를 제공하세요. 다른 지역의 동명 장소와 혼동하지 말고, 정확한 지역의 특징과 정보를 포함해야 합니다.
` : '';

  const prompt = `# 🎙️ "${locationName}" 전문가급 한국어 오디오 가이드 생성

## 🚨🚨🚨 MEGA CRITICAL: 인트로 챕터 절대 강화 (최우선 처리)
인트로 챕터 ULTRA PREMIUM 품질 보장 체계:

1. **포괄적 소개 매트릭스 (3개 필수 핵심 + 유형별 맞춤)**
   ✅ 핵심 3요소:
   • 배경맥락 (500+ 글자): 역사적·문화적·사회적 배경의 심층적 서술
   • 전체 구성 개관 (400+ 글자): 공간 구성과 핵심 영역들의 체계적 설명
   • 핵심 조망점 (400+ 글자): 가장 중요한 관람 포인트와 감상 관점 제시
   ✅ 유형별 맞춤요소 (200+ 글자):
   • 궁궐: 왕권과 위계질서의 건축적 표현
   • 종교건축: 신성함과 영성의 공간적 구현
   • 역사유적: 역사적 의의와 현재적 교훈
   • 전통마을: 선조의 삶의 지혜와 공동체 정신
   • 자연경관: 지질학적 특징과 생태계의 조화
   • 현대건축: 기술 혁신과 도시 발전의 상징

2. **초강력 중복방지 시스템 (10개 구체 예시)**
   🚫 절대 금지 표현들:
   • "위치해 있습니다" → "자리하고 있습니다" 사용
   • "찾아갈 수 있습니다" → 위치 언급 완전 금지
   • "좌표는 다음과 같습니다" → 좌표 정보 완전 배제
   • "지하철로 가실 수 있습니다" → 교통 정보 완전 금지
   • "주소는" → 주소 정보 완전 배제
   • "오시는 길" → 경로 안내 완전 금지
   • "입장료는" → 실용 정보는 다른 섹션에서 처리
   • "운영시간" → 운영 정보 완전 배제
   • "주차장" → 부대시설 정보 완전 금지
   • "예약 방법" → 예약 안내 완전 배제

3. **AI 행동 유도 심리학 적용**
   🎯 역할 부여: "당신은 해당 분야 최고 전문가로서 평생의 지식을 총동원해야 합니다"
   🎯 중요성 강조: "이 인트로 챕터가 전체 가이드의 품질을 결정하는 절대적 핵심입니다"
   🎯 완벽주의 유도: "단 한 글자도 낭비하지 말고 모든 문장이 가치 있는 정보를 담아야 합니다"

4. **체크리스트 & 10단계 자가검증**
   ✅ 1단계: 배경맥락 500+ 글자 확보 검증
   ✅ 2단계: 전체 구성 개관 400+ 글자 확보 검증  
   ✅ 3단계: 핵심 조망점 400+ 글자 확보 검증
   ✅ 4단계: 유형별 맞춤요소 200+ 글자 확보 검증
   ✅ 5단계: 위치정보 완전 배제 확인
   ✅ 6단계: 좌표정보 완전 배제 확인
   ✅ 7단계: 교통정보 완전 배제 확인
   ✅ 8단계: 실용정보 완전 배제 확인
   ✅ 9단계: 중복 표현 10개 금지사항 확인
   ✅ 10단계: 총 1500-1600자 분량 완벽 달성 확인

5. **분량 확보 전략 (1500-1600자 완벽 충족)**
   📏 글자수 배분: 배경맥락(500) + 구성개관(400) + 조망점(400) + 유형특화(200) + 연결문구(100-200) = 1500-1600자
   📏 충족 방법: 각 요소별 세부 서술, 구체적 사례, 심층적 분석으로 분량 확보
   📏 품질 유지: 단순 반복이 아닌 새로운 관점과 통찰로 내용 풍부화

6. **고급 프롬프트 엔지니어링 기법**
   🧠 Few-shot Learning: 우수한 인트로 예시 3개를 참조하여 품질 기준 설정
   🧠 Chain-of-Thought: 배경→구성→조망→특화의 논리적 사고 흐름 유도
   🧠 Self-Consistency: 내부 검증을 통한 일관성 있는 서술 보장

🚨🚨🚨 최종 강조: 이 모든 요구사항을 완벽히 충족해야만 인트로 챕터 생성이 승인됩니다!

### **⚡ 관광객의 첫인상을 좌우하는 결정적 순간입니다! ⚡**

당신은 최고의 전문 가이드로서, **인트로 챕터(ID=0)가 전체 가이드의 성공을 결정**합니다. 완벽한 포괄적 소개 없이는 전체 가이드가 실패합니다!

### **🔥 인트로 챕터의 3가지 필수 핵심 요소 (100% 필수)**

**1. 배경 컨텍스트 (500자 이상)**
- 왜 이 장소가 특별하고 중요한가?
- 어떤 역사적/문화적/자연적 가치를 갖는가?
- 방문객이 반드시 알아야 할 핵심 배경 지식

**2. 전체 구성 개관 (400자 이상)**
- 전체가 어떻게 구성되어 있는가?
- 어떤 순서로 관람하는 것이 최적인가?
- 각 구역/챕터들이 어떻게 연결되는가?

**3. 핵심 관람 포인트 (400자 이상)**
- 놓치면 절대 안 될 하이라이트는 무엇인가?
- 다른 곳에서는 볼 수 없는 특별한 것은?
- 현지인만 아는 숨겨진 보석 같은 포인트

### **⚡ 유형별 맞춤 특화 요소 추가 (200자 이상)**
- **궁궐/역사**: 창건배경 + 역사적변천 + 문화적의미
- **종교시설**: 창건배경 + 종교적의미 + 건축철학  
- **자연공간**: 형성과정 + 생태특징 + 계절변화
- **현대시설**: 건축의도 + 기술혁신 + 도시적의미
- **음식/상업**: 지역특색 + 문화적유래 + 현지생활

### **🚫 절대 금지 - 인트로에서 하면 안 되는 것**
❌ 개별 건물/장소의 상세한 설명 (이건 개별 챕터에서!)
❌ "이곳에서는...", "여기 보시면..." 같은 현장 지시
❌ 구체적인 방향 안내나 이동 지시
❌ 특정 건물 하나만의 건축적 세부사항
❌ 1500자 미만의 짧은 설명

### **✅ 반드시 해야 하는 것**
✅ 장소 전체의 큰 그림과 맥락 제공
✅ "왜 여기를 방문해야 하는가?"에 대한 명확한 답변
✅ 관광객의 기대감과 호기심을 최대한 자극
✅ 1500-1600자의 풍성하고 완전한 설명
✅ 구체적 사실, 수치, 연도 등 검증 가능한 정보 포함

🚨 **CRITICAL WARNING: 첫 번째 챕터 (id: 0) 제목에 절대 콜론(:) 사용 금지**
❌ 잘못된 예: "용궁사: 설명" ❌ 
✅ 올바른 예: "용궁사 입구" ✅

## 🎭 당신의 역할
당신은 **${typeConfig?.expertRole || '전문 관광 가이드'}**입니다. 
${locationName}에 특화된 깊이 있는 전문 지식으로 최고 품질의 가이드를 제공하세요.

${specialistContext}

${regionalContextInfo}

## 🎯 위치 유형별 전문 정보 요구사항

### 📍 **${locationType.toUpperCase()} 전문 해설 기준**
${getLocationSpecificRequirements(locationType)}

${userContext}

## 📋 출력 형식 요구사항

### 1. **순수 JSON만 반환**
- 서론, 설명, 코드블록(\`\`\`) 없이 오직 JSON만
- 완벽한 JSON 문법 준수 (쉼표, 따옴표, 괄호) 
- 키 이름은 예시와 100% 동일하게 (번역 금지)
- **이모지 사용 금지**: 📍 ✨ 🏛️ 🎯 등 모든 이모지 제외, 순수 텍스트만 사용

### ⚠️ **CRITICAL: 인트로 챕터 특별 규칙**
- **첫 번째 챕터 (id: 0) 제목에 절대 콜론(:) 사용 금지**
- ❌ 잘못된 예: "용궁사 입구: 설명문" 
- ✅ 올바른 예: "용궁사 입구"

### 🚀 **품질 향상 핵심 원칙**
- **전문성**: ${typeConfig?.expertRole || '종합 전문가'} 수준의 깊이 있는 해설
- **🎯 사실성**: 검증 가능한 구체적 사실과 수치만 사용 - 공식 기록, 학술 자료 기반
- **정확성**: 모든 정보는 확인된 사실에 근거, 추측이나 가정 절대 금지
- **차별성**: 다른 관광지와 구별되는 고유한 특징 강조
- **스토리텔링**: 건조한 정보가 아닌 사실에 기반한 감동적인 이야기로 구성

### 🔍 **${locationType.toUpperCase()} 유형 품질 검증 기준**
${getQualityRequirementsByType(locationType)}

### 🚨 **절대 금지 사항**
- **일반적 표현**: "상상해보세요", "경이로운", "놀라운" 등
- **모호한 지시어**: "여기서", "이곳" (구체적 장소명 필수)
- **검증 불가능한 내용**: 추측, 가정, 개인 의견, 확인되지 않은 정보
- **과장된 표현**: "세계 최고", "유례없는", "믿을 수 없는" 등 근거 없는 수식어
- **불확실한 표현**: "아마도", "추정된다", "전해진다", "소문에 의하면" 등
- **가상의 내용**: 꾸며낸 인물, 상상의 일화, 추측성 시나리오
- **빈 정보**: 실질적 정보 없이 분량만 채우는 내용
- **🔥 반복 정보**: 같은 역사적 배경, 건립/복원 연도를 여러 챕터에서 반복

### 2. **개요(overview) 구조 - 간결한 양식**
개요는 다음 3개 필드로 구성되어야 합니다:
- **location**: 📍 지역명만 15자 이내 (예: "📍 강원도 강릉시")
- **keyFeatures**: ✨ 핵심 키워드 25자 이내 (예: "✨ 바다 뷰 카페거리")
- **background**: 🏛️ 한 줄 요약 30자 이내 (예: "🏛️ 자연과 문화가 어우러진 관광명소")

### 📏 **개요 섹션 글자 수 제한**
- **location**: 15자 이내, 수식어 제거, 지역명만 명시
- **keyFeatures**: 25자 이내, 핵심 특징만 간결하게
- **background**: 30자 이내, 한 줄로 핵심 의미만

### ✨ **작성 원칙**
- 수식어 최소화 (아름다운, 웅장한 등 제거)
- 핵심 키워드만 나열
- 이모지 활용으로 시각적 구분
- 모바일에서 한눈에 파악 가능하도록 간결화

### 3. **필수관람포인트 구조**
반드시 방문해야 하는 핵심 장소들을 해시태그로 표현:
- **mustVisitSpots**: 🎯 이모지 + 3-5개 해시태그 (예: "🎯 #경포해수욕장 #안목커피거리 #오죽헌 #정동진 #테라로사")

### 📏 **필수관람포인트 작성 원칙**
- 3-5개 장소로 제한 (너무 많으면 선택 부담)
- 장소명만 간결하게 (수식어 제거)
- 해시태그 형태로 시각적 구분
- 해당 지역의 대표 명소 위주 선별

### 4. **챕터 제목 형식 - 중요**
**모든 챕터 제목**은 반드시 **"장소명만"** 형태로 작성해야 합니다 (콜론과 설명 없이):
- ✅ 올바른 예: "해운대 해수욕장"
- ✅ 올바른 예: "달맞이 고개"
- ❌ 잘못된 예: "다양한 먹거리와 부산의 정취 느끼기"
- ❌ 잘못된 예: "아름다운 해안 풍경 감상하며 산책"

**🚨 절대 중요: 챕터 제목은 반드시 실제 장소명으로 시작해야 합니다!**
**🚨 일반적인 설명이나 동작 표현으로 제목을 만들지 마세요!**
**🚨 예시: "해운대 시장: 다양한 먹거리와 부산의 정취" (O) vs "다양한 먹거리와 부산의 정취 느끼기" (X)**

### 4. **자연스러운 한국어 스토리텔링**
- 친근한 구어체 사용
- 교육적이면서도 재미있는 구성
- 역사적 사실과 인간적 감정이 조화

### 🚨 **중복 방지 원칙 (매우 중요!)**
**복합 건물군(궁궐, 사찰, 대학, 공원 등)에서는 반복을 철저히 방지하세요:**

#### ✅ **올바른 정보 배치**
- **인트로 챕터(ID=0)**: 해당 장소 전체에 대한 포괄적 소개와 배경지식 (창건, 복원, 주요 사건, 문화적 맥락, 전체 구성 및 의미)
- **1챕터 이후**: 각 개별 공간/건물만의 고유한 특징, 기능, 특별한 이야기

#### ❌ **절대 금지 - 반복 패턴**
잘못된 예시:
• 인트로: "광화문의 건축 특징만 설명" ← 🚫 개별 건물 중심!
• 1챕터: "창경궁은 1484년 창건되어 임진왜란 때 소실되었다가 1604년 복원되었습니다" ← 🚫 인트로에서 다뤄야 할 내용!
• 2챕터: "홍화문은 1484년 창경궁과 함께 건립되어..." ← 🚫 중복!

#### ✅ **올바른 예시**
• 인트로: "창경궁 전체 소개 - 1484년(성종 15년) 창건부터 현재까지의 역사, 조선 왕실 별궁의 의미, 전체 구성과 주요 볼거리 개관" ← ✅ 포괄적 배경!
• 1챕터: "홍화문의 독특한 건축 양식과 문 장식의 의미" ← ✅ 개별 특징!  
• 2챕터: "명정전의 어좌와 천장 문양, 정치적 기능" ← ✅ 고유 특성!

#### **🎯 각 챕터 차별화 전략**
- **건축적 특징**: 지붕 형태, 기둥 양식, 장식 요소
- **기능적 역할**: 용도, 의례, 실제 사용된 방법  
- **독특한 이야기**: 해당 건물에서만 일어난 특별한 사건
- **예술적 가치**: 특별한 그림, 조각, 현판의 의미
- **관람 포인트**: 꼭 봐야 할 세부 요소, 감상 각도

### 5. **완전한 오디오 가이드 구조**
- overview: 장소 전체 개관 (간결한 양식)
- mustVisitSpots: 필수 관람 포인트 (해시태그)
- route: 관람 순서와 동선
- realTimeGuide: 각 지점별 상세 가이드

${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

**"${locationName}"의 전세계 어디든 적용 가능한 고품질 한국어 오디오 가이드를 순수 JSON으로만 반환하세요!**

**🚨 최종 확인사항 (범용성 체크):**
- ✅ 모든 챕터 제목은 "장소명만" 형태 (콜론과 설명 없이)
- ✅ 장소명은 실제 구체적인 장소 이름
- ✅ 문화권 중립적 표현 사용 (특정 지역 용어 지양)
- ✅ 다양한 장소 유형에 적용 가능한 구조적 패턴
- ✅ 인트로 챕터 MEGA CRITICAL 시스템 완전 적용
- ✅ 1500-1600자 완전한 단일 narrative 구조`;

  return prompt;
};

/**
 * 개선된 자율 리서치 기반 AI 오디오 가이드 생성 프롬프트
 */
export const createAutonomousGuidePrompt = (
  locationName: string,
  language: string = 'ko',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ko;
  const audioStyle = AUDIO_GUIDE_INSTRUCTIONS[language] || AUDIO_GUIDE_INSTRUCTIONS.ko;
  
  // 위치 유형 분석 및 전문 가이드 설정
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
- 지식수준: ${userProfile.knowledgeLevel || '중급'}
- 동행자: ${userProfile.companions || '혼자'}
` : '👤 일반 관광객 대상';

  const specialistContext = typeConfig ? `
🎯 전문 분야 가이드 설정:
- 감지된 위치 유형: ${locationType}
- 전문가 역할: ${typeConfig.expertRole}
- 중점 분야: ${typeConfig.focusAreas.join(', ')}
- 특별 요구사항: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 몰입형 오디오 가이드 생성 미션

## 🎭 당신의 역할
${audioStyle.style}

${specialistContext}

## 🎯 미션
"${locationName}"에 대한 **몰입감 넘치는 ${langConfig.name} 오디오 가이드** JSON을 생성하세요.

${userContext}

### 2. **실제 장소 구조 기반 구성**
각 관광지나 장소의 **실제 관람 순서와 공간 구성**에 맞춰 route.steps를 구성하세요.

**🚨 CRITICAL: location 필드는 반드시 구체적인 장소명 사용**
- ❌ 금지: "입구", "중앙홀", "주요전시실", "특별공간", "전망대" 등 일반적인 용어
- ✅ 필수: "광화문", "근정전", "경회루", "국립고궁박물관" 등 실제 고유 장소명
- ✅ 필수: "에펠탑", "루브르 박물관", "시테 섬" 등 방문자가 찾을 수 있는 구체적 이름
- ✅ 필수: "[장소명] [구체적 건물/구역명]" 형태로 더욱 상세하게 (예: "동대문디자인플라자 아트홀")

**🎯 인트로 챕터(ID=0) 특별 지침 - 관광 입구에서의 핵심:**

**🚨 CRITICAL: 인트로 챕터 제목은 반드시 구체적이고 찾을 수 있는 실제 시작지점이어야 함**

### ✅ **관광객이 실제로 찾을 수 있는 시작지점 예시:**

**✅ Google Places API 최적화된 정확한 예시:**
- "국립중앙박물관"
- "루브르 박물관" 
- "광화문 매표소"
- "베르사유 궁전"
- "용궁사 일주문"
- "불국사"
- "남산케이블카"
- "5합목 방문자센터"
- "명동역 2번 출구"
- "콜로세움역"

### 🎯 **Google Places API 최적화 제목 공식:**
\`\`\`
"[구체적 시설명만]" (설명문 완전 금지)
\`\`\`

**🚨 CRITICAL: 첫 번째 챕터 (id: 0)만 특별 규칙**
1. **절대 콜론(:) 사용 금지** - "용궁사 입구: 설명" ❌ 금지
2. **장소명만 작성** - "용궁사 입구" ✅ 올바름
3. **Google Maps 직접 검색 가능한 실제 시설명**
4. **정확한 시설명으로 검색 최적화**
5. **영어/한국어 혼용 허용** (검색 정확도 우선)

---

**🔴 모든 챕터 제목 형식:**
\`\`\`
"[구체적 장소명만]" (콜론과 설명 없이)
\`\`\`

**📝 일반 챕터 예시:**

**🏛️ 박물관/전시관:**
- "박물관 입구홀"
- "상설전시관"
- "기획전시실"

**🏰 궁궐/유적지:**
- "궁궐 정문"
- "정전"
- "후원"

**🏔️ 자연/공원:**
- "공원 입구광장"
- "전망대"
- "산책로"

**🏪 시장/상점가:**
- "시장 중앙통로"
- "전통상점가"
- "먹거리촌"

**🔴 JSON 구조 예시:**
\`\`\`json
{
  "route": {
    "steps": [
      { "step": 1, "location": "명동성당 정문", "title": "명동성당 정문" },
      { "step": 2, "location": "명동성당 대성전", "title": "명동성당 대성전" },
      { "step": 3, "location": "명동성당 지하묘지", "title": "명동성당 지하묘지" }
    ]
  },
  "realTimeGuide": {
    "chapters": [
      { "id": 0, "title": "[장소명] [매표소/안내소/방문자센터/역출구 등]" },
      { "id": 1, "title": "중심부" },
      { "id": 2, "title": "특별전시공간" }
    ]
  }
}
\`\`\`

**🚨 CRITICAL - 모든 장소 공통 규칙:**
- 반드시 "[구체적 장소명만]" 형식 준수 (콜론과 설명 없이)
- 장소명은 방문자가 실제로 찾아갈 수 있는 구체적 위치
- route.steps와 realTimeGuide.chapters의 title 완전 동일

### 3. **3개 필드의 완벽한 연결 🚨 핵심 개선사항**

**✅ 향상된 구조 (배경지식 + 확장된 현장관찰)**:
\`\`\`
sceneDescription: 배경지식 설명 + 확장된 현장관찰(아웃라인 → 디테일) → 자연스러운 호기심 질문
coreNarrative: 호기심의 답 + 역사적 맥락 → 인물 이야기 예고  
humanStories: 실제 인물 이야기 → 감동적 마무리
nextDirection: (별도 분리) 이동 안내만
\`\`\`

**🚨 연결의 자연스러움 - 매우 중요!**
- 각 장소에 맞는 독창적이고 자연스러운 연결어 사용
- 뻔한 템플릿 말고 상황에 맞는 다양한 표현
- 마치 실제 가이드가 즉석에서 이야기하는 듯한 자연스러움

**❌ 피해야 할 템플릿식 표현:**
- "과연 이 장소가 어떤 특별한 이야기를 간직하고 있을까요?"
- "바로 그 비밀을 지금부터 들려드릴게요"
- "네, 바로 그 사람들의 이야기인데요"

**✅ 필수 사용 구체적 표현 패턴:**
- "{구체적 장소명}에서 확인할 수 있는 {물리적 특징}은..."
- "{연도}년 {실존 인물명}이 {구체적 장소}에서 {검증 가능한 행동}을..."
- "{측정값} 크기의 {구체적 건축요소}는 {기술적 사실}을..."
- "{방향/위치}에 위치한 {구체적 명칭}의 {역사적 배경}은..."

### 4. **풍부하고 독창적인 콘텐츠**
- 각 필드별 최소 분량 엄수 (위 기준 참조)
- 장소의 특성을 살린 독창적 묘사
- 뻔한 설명 대신 흥미진진한 스토리텔링
- 역사적 사실 + 인간적 감정 + 현장 몰입감

### 5. **동적 챕터 구성**
- **위치의 규모와 특성에 따라 적절한 개수의 챕터 생성**
- **소규모 장소: 3-4개, 중간 규모: 5-6개, 대규모 복합시설: 7-8개**
- **🔴 CRITICAL: route.steps와 realTimeGuide.chapters 개수 및 제목 완벽 일치**

### 6. **📍 위치 설명 필수 포함**
각 챕터에는 반드시 정확한 위치 설명을 포함해야 합니다:
- **description**: 해당 챕터 지점의 구체적 위치 설명
- **위치 정확성**: 실제 관광지 내 구체적 장소나 구역 설명

**🚨 위치 설명 예시:**
"description": "에펠탑 1층 중앙 홀 입구"


## 💡 전세계 범용 오디오 가이드 작성 예시

### 🌍 **다양한 장소 유형별 우수한 narrative 패턴**

**🏛️ 역사/문화 유적 예시 (로마 콜로세움)**:
- narrative: "콜로세움은 서기 80년 완공된 로마제국 최대의 원형경기장으로, 단순한 건축물이 아니라 제국의 권력과 시민들의 오락이 만나는 상징적 공간이었습니다. 현재 우리 앞에 펼쳐진 모습을 살펴보면, 높이 48미터의 4층 구조가 타원형으로 펼쳐져 있으며, 트래버틴 석회암과 벽돌로 쌓아 올린 아치 구조가 2000년의 세월을 견뎌낸 로마 건축 기술의 위대함을 보여줍니다. 좀 더 자세히 관찰해보면, 각 층마다 다른 건축 양식 - 도리아식, 이오니아식, 코린트식 기둥들이 조화롭게 배치되어 있고, 외벽의 아치 창들이 규칙적으로 배열된 모습이 인상적입니다. 그런데 이 거대한 경기장이 왜 이렇게 정교하게 설계되었는지 아세요?"

**🏔️ 자연 경관 예시 (그랜드 캐니언)**:
- narrative: "그랜드 캐니언은 콜로라도 강이 600만 년에 걸쳐 조각해낸 지구 역사의 거대한 책으로, 단순한 협곡이 아니라 시간의 흐름이 새겨진 자연의 걸작품입니다. 현재 우리 앞에 펼쳐진 장관을 살펴보면, 길이 446킬로미터, 폭 29킬로미터, 깊이 1.6킬로미터에 달하는 규모가 시선을 압도하며, 붉은 사암층부터 회색 석회암층까지 지층별로 다른 색깔이 수평선을 그리며 펼쳐진 모습이 장관을 이룹니다. 좀 더 자세히 관찰해보면, 각 지층마다 담고 있는 지질 시대가 다르며, 가장 아래층은 20억 년 전 선캄브리아기 암석부터 위쪽의 2억 7천만 년 전 페름기 석회암까지 지구 역사의 절반을 담고 있어요. 그런데 이 엄청난 협곡이 어떻게 형성될 수 있었을까요?"

**🎨 현대 건축 예시 (구겐하임 뮤지엄)**:
- narrative: "구겐하임 뮤지엄은 프랭크 로이드 라이트가 설계한 혁신적인 나선형 건축물로, 단순한 미술관이 아니라 건축 자체가 하나의 예술 작품이 되는 새로운 개념을 제시했습니다. 현재 우리 앞에 펼쳐진 모습을 살펴보면, 바닥에서 천장까지 이어지는 연속적인 나선형 경사로가 중앙의 대형 돔을 중심으로 원형으로 감겨 올라가며, 백색 콘크리트의 부드러운 곡선이 맨해튼의 직선적인 도시 풍경과 대비되어 독특한 조형미를 보여줍니다. 좀 더 자세히 관찰해보면, 외벽의 나선형 밴드들과 내부 공간이 완벽하게 일치하며, 천장의 유리돔에서 쏟아지는 자연광이 나선형 벽면을 따라 부드럽게 퍼져나가는 모습이 인상적입니다. 그런데 왜 라이트는 전통적인 직선형 전시실 대신 이런 나선형 구조를 선택했을까요?"

### ✅ **성공적인 narrative 구조 공식**

**[단계 1: 정의와 성격]** → **[단계 2: 현장 전체 관찰]** → **[단계 3: 세부 특징 묘사]** → **[단계 4: 호기심 유발 질문]** → **[단계 5: 역사적 배경 설명]** → **[단계 6: 인물/사건 스토리]** → **[단계 7: 현재적 의미]**

### ❌ **피해야 할 구조적 오류들**

1. **지역별 고유 용어만 사용**: "단청", "처마", "해치상" 등 특정 문화권에만 적용되는 용어
2. **특정 건축 양식 편향**: 동아시아 전통 건축 패턴만 반영
3. **단일한 스토리텔링**: 왕권-정치사 중심의 획일적 서사
4. **문화적 가정**: 특정 문화적 배경지식을 전제로 하는 설명

## 📐 최종 JSON 구조:
${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

## ✅ 최종 체크리스트
- [ ] 모든 텍스트가 ${langConfig.name}로 작성됨
- [ ] route.steps와 realTimeGuide.chapters 완벽 매칭
- [ ] narrative가 완전하고 자연스러운 1500-1600자 스토리
- [ ] nextDirection은 별도 분리되어 이동 안내만
- [ ] 템플릿식 표현 대신 자연스럽고 독창적 스토리텔링
- [ ] JSON 문법 100% 정확

**🔴 핵심 개선사항 요약 🔴**
1. **단일 완전한 narrative**: 모든 내용이 하나의 자연스러운 흐름으로 통합
2. **자연스러운 내부 연결**: 템플릿 대신 상황별 다양한 표현으로 매끄러운 전환
3. **독창적 스토리텔링**: 장소 특성을 살린 고유한 묘사
4. **완전한 분리**: 이동 안내는 오직 nextDirection에만
5. **🎯 사실성 절대 준수**: 검증 가능한 사실만 사용, 추측이나 가정 절대 금지

**지금 바로 "${locationName}"의 자연스럽고 매력적인 오디오 가이드를 순수 JSON으로만 반환하세요!**`;

  return prompt;
}

/**
 * 한국어 최종 가이드 생성 프롬프트 (index.ts 호환용)
 */
export const createKoreanFinalPrompt = (
  locationName: string,
  researchData: any,
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS.ko;
  const audioStyle = AUDIO_GUIDE_INSTRUCTIONS.ko;
  // 위치 유형 분석 및 전문 가이드 설정
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
- 지식수준: ${userProfile.knowledgeLevel || '중급'}
- 동행자: ${userProfile.companions || '혼자'}
` : '👤 일반 관광객 대상';

  const specialistContext = typeConfig ? `
🎯 전문 분야 가이드 설정:
- 감지된 위치 유형: ${locationType}
- 전문가 역할: ${typeConfig.expertRole}
- 중점 분야: ${typeConfig.focusAreas.join(', ')}
- 특별 요구사항: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 최종 오디오 가이드 생성

## 🎭 당신의 역할
${audioStyle.style}

${specialistContext}

## 📚 리서치 데이터 기반 가이드 작성
아래 제공된 상세한 리서치 데이터를 바탕으로 더욱 정확하고 풍부한 오디오 가이드를 작성하세요.

### 리서치 데이터:
${JSON.stringify(researchData, null, 2)}

${userContext}

## 📐 최종 가이드 작성 지침

### 1. **리서치 데이터 활용**
- 제공된 모든 정보를 자연스럽게 스토리텔링에 녹여내기
- 역사적 사실, 날짜, 인물 정보를 정확하게 반영
- 리서치에서 발견한 흥미로운 일화나 숨은 이야기 적극 활용

### 2. **오디오 스크립트 품질**
- 리서치 데이터의 딱딱한 정보를 친근한 구어체로 변환
- 전문적 내용을 쉽고 재미있게 풀어서 설명
- 청취자가 지루하지 않도록 드라마틱한 구성

### 3. **향상된 콘텐츠**
- 리서치 데이터를 바탕으로 각 챕터를 더욱 상세하게
- 구체적인 수치, 날짜, 인물명을 정확히 포함
- 리서치에서 얻은 인사이트로 스토리텔링 강화

### 4. **완전한 분량 기준 (한국어 기준 - 챕터당 1800자 목표)**
- narrative: 1500-1600자 이상 (배경지식 + 확장된 현장관찰 + 역사적 맥락 + 인물 이야기의 완전한 통합 스크립트)
- nextDirection: 200-300자 이상 (명확한 이동 경로와 거리 안내)


## 📐 최종 JSON 구조:
${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

## ✅ 품질 체크리스트
- [ ] 리서치 데이터의 모든 중요 정보 반영
- [ ] 역사적 사실과 날짜의 정확성
- [ ] 자연스러운 스토리텔링 흐름
- [ ] 오디오로 들었을 때 지루하지 않은 구성
- [ ] 각 챕터 8-10분 분량의 풍성한 콘텐츠
- [ ] narrative가 끊김 없이 자연스럽게 흐르는 하나의 완전한 대본

**🔴 필수 준수사항 🔴**
각 챕터는 한 사람이 8분간 쉬지 않고 이야기하는 것입니다!
narrative 필드 내에서 현장관찰 → 역사적 배경 → 인물 이야기가
물 흐르듯 자연스럽게 이어져야 합니다.
절대로 각 부분을 독립적인 섹션으로 작성하지 마세요!

**리서치 데이터를 완벽히 활용하여 "${locationName}"의 최고의 오디오 가이드를 만들어주세요!**`;

  return prompt;
}

/**
 * 구조 생성용 프롬프트 (overview + route만)
 */
export const createStructurePrompt = (
  locationName: string,
  language: string = 'ko',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ko;
  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
` : '👤 일반 관광객 대상';

  // 위치 유형 분석 및 권장 스팟 수 정보
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType] || LOCATION_TYPE_CONFIGS.general;
  const spotCount = getRecommendedSpotCount(locationName);

  return `# 🏗️ "${locationName}" 가이드 기본 구조 생성

## 🎯 미션
"${locationName}"에 대한 **기본 구조(overview + route)만** 생성하세요.
실시간 가이드 챕터는 제목만 포함하고, 상세 내용은 생성하지 마세요.

${userContext}

## 🎯 위치 분석 정보
- 감지된 위치 유형: ${locationType}
- 권장 스팟 수: ${typeConfig.recommendedSpots}
- 최적 스팟 범위: ${spotCount.min}-${spotCount.max}개
- 추천 기본값: ${spotCount.default}개

## 📋 출력 형식
순수 JSON만 반환. 코드 블록이나 설명 없이 오직 JSON만.

**스팟 수 결정 가이드라인:**
- **소규모 단일 건물/상점**: 3-4개 스팟
- **중간 규모 관광지**: 5-6개 스팟  
- **대형 복합시설/궁궐**: 7-8개 스팟
- **자연공원/산책로**: 주요 뷰포인트별로 4-6개
- **맛집 투어 지역**: 음식 종류에 따라 5-8개

### 구조 예시 (스팟 수는 위치에 맞게 조정):
{
  "content": {
    "overview": {
      "title": "${locationName}",
      "location": "📍 지역명만 (예: 📍 강원도 강릉시)",
      "keyFeatures": "✨ 핵심 키워드 (예: ✨ 바다 뷰 카페거리)",
      "background": "🏛️ 한 줄 요약 (예: 🏛️ 자연과 문화가 어우러진 관광명소)",
      "narrativeTheme": "핵심 테마 한 줄",
      "keyFacts": [
        { "title": "주요 정보1", "description": "설명" },
        { "title": "주요 정보2", "description": "설명" }
      ],
      "visitInfo": {
        "duration": "적절한 소요시간",
        "difficulty": "난이도",
        "season": "최적 계절"
      }
    },
    "mustVisitSpots": "🎯 #장소1 #장소2 #장소3 #장소4 #장소5",
    "route": {
      "steps": [
        { "step": 1, "location": "[장소명] [매표소/안내소/방문자센터/역출구 등]", "title": "[장소명] [매표소/안내소/방문자센터/역출구 등]" },
        { "step": 2, "location": "동대문디자인플라자 아트홀", "title": "동대문디자인플라자 아트홀" },
        { "step": 3, "location": "동대문디자인플라자 디자인박물관", "title": "동대문디자인플라자 디자인박물관" },
        { "step": 4, "location": "동대문디자인플라자 디자인랩", "title": "동대문디자인플라자 디자인랩" },
        { "step": 5, "location": "동대문디자인플라자 옥상정원", "title": "동대문디자인플라자 옥상정원" }
      ]
    },
    "realTimeGuide": {
      "chapters": [
        { "id": 0, "title": "[장소명] [매표소/안내소/방문자센터/역출구 등]" },
        { "id": 1, "title": "중앙홀" },
        { "id": 2, "title": "주요전시실" },
        { "id": 3, "title": "특별공간" },
        { "id": 4, "title": "전망대" }
      ]
    }
  }
}

**중요**: 
- route.steps와 realTimeGuide.chapters의 title이 정확히 동일해야 함
- **위치의 규모와 특성을 고려하여 적절한 수의 스팟 구성** (3-8개 범위 내)
- 입구 → 주요 지점들 → 마무리/출구 순서로 자연스러운 동선
- 챕터에는 제목만 포함, 상세 내용 없음
- 순수 JSON만 반환, 설명이나 코드블록 없음`;
}

/**
 * 챕터 상세 생성용 프롬프트
 */
export const createChapterPrompt = (
  locationName: string,
  chapterIndex: number,
  chapterTitle: string,
  existingGuide: any,
  language: string = 'ko',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ko;

  return `🎙️ "${locationName}" 챕터 ${chapterIndex + 1}: "${chapterTitle}" 완전한 오디오 가이드 생성

🎯 미션
당신은 전문 관광 가이드로서 "${chapterTitle}" 지점에서 관광객들에게 들려줄 **완전하고 상세한** 오디오 가이드 스크립트를 작성해야 합니다.

📚 기존 가이드 컨텍스트
${JSON.stringify(existingGuide, null, 2)}

🚨 **절대 중요 - 완전한 내용 필수**
- narrative 필드에 **최소 1500-1600자의 완전한 내용** 작성 (절대 짧게 쓰지 마세요!)
- **배경지식 + 확장된 현장관찰(아웃라인 → 디테일)** 순서로 현장 묘사 + 역사적 배경 + 인물 이야기를 **하나의 자연스러운 스토리**로 통합
- AI가 "...더 자세한 내용은..." 같은 미완성 표현 절대 사용 금지
- **완전하고 풍부한 실제 가이드 수준의 내용**을 작성하세요

🎭 스타일 가이드
- 친근한 구어체 ("여기서 주목할 점은", "흥미로운 사실은", "이야기를 들어보면" 등)
- 교육적이면서도 재미있는 스토리텔링
- 마치 옆에서 친구가 설명해주는 듯한 친근함
- **각 부분이 자연스럽게 이어지는 하나의 완전한 이야기**


✅ **권장 시작 표현**
- "이곳에서..." "여기서 주목할 점은..." "흥미롭게도..."
- "바로 앞에 보이는..." "이 장소에서..."
- "이제 우리는..." "계속해서..." "다음으로 만나볼..."

✅ 필수 출력 형식
**중요: 순수 JSON만 출력하세요. 코드블록이나 설명 없이!**

{
  "chapter": {
    "id": ${chapterIndex},
    "title": "${chapterTitle}",
    "narrative": "이곳에서 가장 먼저 눈에 들어오는 것은 [현장 묘사와 관찰 내용]. [자연스러운 연결] 이 장소의 역사를 살펴보면 [역사적 배경과 맥락 설명]. [자연스러운 연결] 특히 기억해야 할 인물은 [인물 이야기와 에피소드]. 이런 모든 이야기들이 [현재적 의미와 마무리]로 이어집니다. [1500-1600자의 완전한 통합 스크립트]",
    "nextDirection": "현재 위치에서 [기준점: 메인건물/담장/길]을 따라 [방향: 북쪽/남쪽/동쪽/서쪽/북동쪽/북서쪽/남동쪽/남서쪽]으로 정확히 [숫자]미터 직진하세요. 이동 중 [경로특징: 분수대/조형물/표지판/계단] 등을 지나면 [도착신호: 특정건물/간판/입구]가 보입니다. 도보 약 [숫자]분 소요됩니다."
  }
}

🚨 JSON 안전성 필수 규칙 🚨
1. **문단 구분**: 오직 " \\n\\n " (공백+백슬래시n+백슬래시n+공백)로만 구분
2. **실제 줄바꿈 금지**: 텍스트에 실제 Enter나 줄바꿈 절대 사용 금지
3. **탭 문자 금지**: \\t 또는 실제 탭 문자 사용 금지
4. **한 줄 작성**: 모든 JSON을 한 줄로 연결해서 작성
5. **따옴표 이스케이프**: 텍스트 내 따옴표는 반드시 \\\"로 이스케이프

**문단 구분 올바른 예시:**
"narrative": "첫 번째 문단 내용입니다. \\n\\n 두 번째 문단 내용입니다. \\n\\n 세 번째 문단 내용입니다."

**절대 금지 예시:**
"narrative": "첫 번째 문단
두 번째 문단" // ← 실제 줄바꿈 금지!

🚨 절대 준수사항 🚨
- **narrative 필드는 반드시 1500-1600자 (최소 1500자!)**
- **배경지식 + 확장된 현장관찰(아웃라인 → 디테일) 순서로 구성된 자연스러운 플로우**
- 서론이나 설명 없이 바로 JSON 시작
- 코드블록 표시 절대 금지  
- 문법적으로 완벽한 JSON 형식
- 미완성 내용이나 "추후 보완" 같은 표현 절대 금지

지금 바로 "${chapterTitle}" 챕터의 **완전하고 풍부한** 오디오 가이드를 생성해주세요!`;
}

// 기타 유틸리티 함수들
export const createKoreanStructurePrompt = createStructurePrompt;
export const createKoreanChapterPrompt = createChapterPrompt;