// 전 세계 모든 장소를 위한 범용 AI 오디오 가이드 생성 프롬프트 시스템 (개선된 버전)

import { UserProfile } from '@/types/guide';
import { 
  LANGUAGE_CONFIGS, 
  LOCATION_TYPE_CONFIGS, 
  analyzeLocationType,
  getRecommendedSpotCount 
} from './index';

/**
 * 🎯 위치 유형별 품질 검증 기준 생성
 */
function getQualityRequirementsByType(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `- **건축 수치**: 건물 높이, 건축 연도, 기둥 수, 면적 등
- **왕실 인물**: 구체적 왕 이름, 재위 기간, 주요 업적
- **건축 용어**: 추녀, 공포, 단청, 온돌 등 정확한 용어`;
    case 'religious':
      return `- **종교 용어**: 법당, 탑, 불상, 범종 등 정확한 명칭
- **창건 정보**: 창건 연도, 창건자, 중건 역사
- **종교 의례**: 구체적 수행법, 예배 시간, 의식 절차`;
    case 'historical':
      return `- **역사 연도**: 정확한 연대, 사건 발생일
- **역사 인물**: 실존 인물의 구체적 행적과 업적
- **유물 정보**: 출토 연도, 재질, 크기, 문화재 지정번호`;
    case 'nature':
      return `- **지질 정보**: 형성 연대, 암석 종류, 지질 구조
- **생태 데이터**: 서식 동식물 종 수, 면적, 해발고도
- **환경 수치**: 연평균 기온, 강수량, 습도 등`;
    case 'culinary':
      return `- **조리 정보**: 조리 시간, 온도, 재료 비율
- **영양 성분**: 칼로리, 주요 영양소, 효능
- **역사 정보**: 음식의 기원, 지역별 변화 과정`;
    default:
      return `- **구체적 수치**: 연도, 크기, 개수 등 측정 가능한 데이터
- **검증 가능한 사실**: 공식 기록, 문헌에 근거한 정보
- **전문 용어**: 해당 분야의 정확한 용어와 개념`;
  }
}

/**
 * 🎯 위치 유형별 전문 정보 요구사항 생성
 */
function getLocationSpecificRequirements(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `**🏰 궁궐 전문 해설 기준:**
- **건축 위계**: 정전→편전→침전 순서의 공간 배치와 의미
- **왕실 생활**: 구체적인 의례, 하루 일과, 계절별 행사
- **정치사**: 주요 역사적 사건과 결정이 이뤄진 장소
- **장인 기술**: 단청, 목조 건축, 석조 기법의 과학적 우수성
- **상징 체계**: 용, 봉황 등 왕권 상징물의 배치와 의미`;

    case 'religious':
      return `**🙏 종교 건축 전문 해설 기준:**
- **건축 상징**: 불탑, 법당, 종루 등의 종교적 의미와 배치
- **종교 철학**: 해당 종교의 핵심 교리와 수행법
- **예술 양식**: 불상, 탱화, 스테인드글라스 등의 예술적 가치
- **의례 공간**: 예배/법회 진행 방식과 공간 활용
- **영성 체험**: 명상, 기도의 실제적 방법과 효과`;

    case 'historical':
      return `**📚 역사 유적 전문 해설 기준:**
- **역사적 사실**: 연도, 인물, 사건의 정확한 검증된 정보
- **인물 스토리**: 주요 역사 인물의 구체적 행적과 업적
- **사회적 맥락**: 당시 사회상, 문화, 경제적 배경
- **유물 가치**: 출토품, 유적의 학술적・문화적 중요성
- **현재적 의미**: 역사가 현재에 주는 교훈과 시사점`;

    case 'nature':
      return `**🌿 자연 생태 전문 해설 기준:**
- **지질 형성**: 수백만 년에 걸친 지형 형성 과정
- **생태계**: 식물군-동물군 간의 상호작용과 먹이사슬
- **기후 특성**: 미기후, 계절 변화, 기상 현상
- **보전 가치**: 멸종위기종, 서식지 보호의 중요성
- **지속가능성**: 환경 보호와 관광의 조화로운 방안`;

    case 'culinary':
      return `**🍽️ 음식 문화 전문 해설 기준:**
- **조리 과학**: 발효, 숙성, 조리법의 과학적 원리
- **식재료**: 원산지, 품질 기준, 영양학적 특성
- **전통 기법**: 대대로 전해지는 조리법과 보존 방식
- **맛의 조화**: 단맛, 짠맛, 감칠맛 등의 균형과 특징
- **식문화사**: 음식의 역사적 유래와 지역적 특색`;

    case 'cultural':
      return `**🎨 예술 문화 전문 해설 기준:**
- **예술사**: 시대별 미술 사조와 예술가의 위치
- **작품 분석**: 기법, 재료, 구도, 색채의 전문적 해석
- **문화적 맥락**: 작품이 탄생한 사회적・문화적 배경
- **미학 이론**: 미의 기준, 예술 철학, 감상법
- **현대적 가치**: 과거 예술이 현대에 주는 영감과 의미`;

    case 'commercial':
      return `**🛍️ 상업 문화 전문 해설 기준:**
- **상권 형성사**: 시장, 상가 발달 과정과 경제적 배경
- **지역 특산품**: 원료, 제조법, 품질의 우수성
- **유통 체계**: 전통적/현대적 유통 구조의 변화
- **생활 문화**: 상업 활동이 지역민 생활에 미친 영향
- **경제적 가치**: 지역 경제 기여도와 일자리 창출`;

    case 'modern':
      return `**🏗️ 현대 건축 전문 해설 기준:**
- **구조 공학**: 건축 기술, 내진 설계, 첨단 공법
- **설계 철학**: 건축가의 컨셉트와 디자인 의도
- **친환경 기술**: 에너지 효율, 지속가능한 건축 기법
- **도시 계획**: 랜드마크로서의 역할과 도시 발전 기여
- **미래 비전**: 건축이 제시하는 미래 도시의 모습`;

    default:
      return `**🎯 종합 관광 해설 기준:**
- **다각적 접근**: 역사, 문화, 자연, 경제적 측면 균형
- **실용 정보**: 교통, 시설, 이용법 등 방문객 편의
- **지역 특색**: 다른 곳과 차별화되는 고유한 매력
- **스토리텔링**: 흥미롭고 기억에 남는 일화와 이야기
- **종합적 가치**: 관광지로서의 종합적 매력과 의미`;
  }
}

// 오디오 가이드 예시 - 자연스럽게 이어지는 구조 (개선된 실용 예시)
const AUDIO_GUIDE_EXAMPLE = {
  content: {
    overview: {
      title: "경복궁",
      location: "서울 종로구",
      keyFeatures: "조선 법궁 건축",
      background: "조선 왕조의 정궁",
      narrativeTheme: "조선 왕조의 웅장함과 역사적 의미를 체험하는 여행",
      keyFacts: [
        { title: "주요 정보 1", description: "장소의 기본 정보나 특징" },
        { title: "주요 정보 2", description: "역사적 배경이나 문화적 의미" }
      ],
      visitInfo: {
        duration: "권장 관람 시간",
        difficulty: "접근성/난이도",
        season: "최적 방문 시기"
      }
    },
    safetyWarnings: "방문 시 주의사항이나 규정이 있다면 여기에 작성 (예: 복장 규정, 촬영 금지 구역, 예배 시간 제한 등)",
    mustVisitSpots: "#근정전 #경회루 #국립고궁박물관 #수정전 #향원정",
    route: {
      steps: [
        { step: 1, location: "광화문", title: "광화문: 조선왕궁의 정문에서 느끼는 위엄" },
        { step: 2, location: "근정전", title: "근정전: 조선 왕의 권위가 살아 숨쉬는 정전" },
        { step: 3, location: "경회루", title: "경회루: 연못 위에 떠 있는 아름다운 누각" },
        { step: 4, location: "궁중정원", title: "궁중정원: 왕실의 사색과 휴식 공간" },
        { step: 5, location: "국립고궁박물관", title: "국립고궁박물관: 조선 왕실 문화의 보물창고" }
      ]
    },
    realTimeGuide: {
      chapters: [
        {
          id: 0,
          title: "🎯 Google Places API 최적화: ${locationName} 관람을 위한 구체적 시설명만 작성 (설명문 완전 금지)\n\n✅ 올바른 예시:\n- 광화문 매표소\n- 트로카데로 전망대  \n- 5합목 방문자센터\n- 명동역 8번 출구\n- 부산역 광장\n\n❌ 잘못된 예시:\n- 광화문 매표소: 경복궁 관광 시작점\n- 트로카데로 전망대: 에펠탑 순례의 시작\n\n✅ 핵심: Google 지도 검색 가능한 실제 시설명만",
          narrative: "[1200-1500자] 전문 오디오가이드 수준의 매력적인 인트로를 작성하세요. 다음 내용을 자연스럽게 포함하되, 마크다운 형식 없이 흐름 있는 문장으로 구성하세요:\n\n1. 역사적 맥락과 변천사 (400자): 창건/설립 배경, 원래 용도와 현재 용도의 변화, 중요한 역사적 사건과 전환점, 시대별 변화와 확장 과정\n\n2. 건축과 공간구성의 철학 (300자): 설계 의도와 건축 양식의 의미, 공간 배치의 목적과 동선 계획, 상징적 요소들과 그 의미\n\n3. 관람 전략과 핵심 포인트 (300자): 전체 구역 개요와 추천 관람순서, 시간대별 관람 팁, 놓치기 쉬운 숨겨진 보물들, 각 챕터에서 특별히 주목해야 할 요소들\n\n4. 현지인 관점의 특별한 이야기 (200자): 일반 관광객이 모르는 흥미로운 사실, 현지 문화와의 연관성, 계절별/시간별 다른 매력, 방문 시 알아두면 유용한 실용 정보\n\n중요: 마크다운 서식(**텍스트**, ##제목, 📜이모지 등)을 사용하지 말고, 일반 텍스트로만 작성하세요.",
          nextDirection: "자, 이런 의미 깊은 이야기를 마음에 새기며 이제 다음 지점으로 이동해볼까요? 여기서 동쪽으로 약 100미터 정도 가시면 근정전이 나옵니다. 다음 정류장에서는 조선의 정치 중심지였던 근정전의 웅장함과 그 속에 담긴 왕권의 상징성이 여러분을 기다리고 있답니다!",
          coordinates: {
            lat: "[위 title에 명시한 실제 시설 위치를 아는 범위에서 추정한 위도 - 모르면 0.0]",
            lng: "[위 title에 명시한 실제 시설 위치를 아는 범위에서 추정한 경도 - 모르면 0.0]",
            description: "[해당 시설의 구체적 위치 설명 (시스템에서 정밀 보정됩니다)]"
          }
        }
      ]
    }
  }
};

// 타입 정의
interface GuideContent {
  content: {
    overview: {
      title: string;
      location: string;
      keyFeatures: string;
      background: string;
      narrativeTheme: string;
      keyFacts: Array<{ title: string; description: string }>;
      visitInfo: {
        duration: string;
        difficulty: string;
        season: string;
      };
    };
    route: {
      steps: Array<{
        step: number;
        location: string;
        title: string;
      }>;
    };
    realTimeGuide: {
      chapters: Array<{
        id: number;
        title: string;
        narrative: string;
        nextDirection: string;
      }>;
    };
  };
}

// 언어별 오디오 가이드 작성 지침 (개선된 버전)
const AUDIO_GUIDE_INSTRUCTIONS = {
  ko: {
    style: `당신은 **단 한 명의 최고의 자유여행 가이드**입니다. 
    
**🎯 핵심 미션**: 당신은 관람객 바로 옆에서 친구처럼 이야기하는 **단 한 명의 자유여행 가이드**입니다. 
처음부터 끝까지 일관된 목소리와 성격으로, 해당지역에 관한 모든 것을 짧은 시간에 알려주고 싶어하듯 이야기를 자연스럽게 안내하세요.

**📝 절대 준수 사항**:

1. **3개 필드의 완벽한 연결 (🚨 매우 중요)**
   - sceneDescription, coreNarrative, humanStories는 하나의 완전한 8-9분 연속 오디오입니다
   - nextDirection은 별도 필드로, 오직 다음 장소 이동 안내만 담당
   - 3개 필드 사이에는 자연스러운 연결어로 매끄럽게 전환 ("그런데 말이죠", "바로 이 때문에", "실제로")
   
2. **향상된 교육적 스토리텔링 구조 (현장관찰 확장)**
   - sceneDescription: 배경지식 설명 + **확장된 현장관찰** (아웃라인 → 디테일) → 호기심 유발 질문
   - coreNarrative: 호기심의 답 제시 + 역사적 맥락 → 인물 이야기 예고
   - humanStories: 실제 인물/사건 이야기 → 현재적 의미로 마무리
   
3. **사실 기반 정보 제공 원칙 (🚨 매우 중요)**
   - 🚨 절대 금지: "여러분", "상상해보세요", "놀라운 이야기", "경이로운", "잠시"
   - 🚨 절대 금지: "이곳", "여기" 같은 모호한 지시어 (반드시 구체적 장소명 사용)
   - 🚨 절대 금지: 장소명 없는 일반적 호칭이나 감탄사
   - 🚨 **절대 금지: 추측, 가정, 확인되지 않은 정보, 과장된 표현**
   - ✅ **필수 원칙: 검증 가능한 사실만 사용** - 공식 기록, 문헌, 역사서에 근거한 정보만
   - ✅ 필수 포함: 구체적 수치, 고유명사, 물리적 특징, 역사적 사실, 기술적 정보
   - ✅ **사실 표현법**: "기록에 따르면", "역사서에 보면", "공식 문서에 의하면", "실제로"
   
4. **향상된 내용 구성 (각 필드별 분량 - 챕터당 1600자 목표)**
   - sceneDescription: 500-600자 이상 - 배경지식 + 확장된 현장관찰(아웃라인 → 디테일)
   - coreNarrative: 800-1000자 이상 - 역사적 사실과 의미 상세 설명
   - humanStories: 300-400자 이상 - 구체적인 인물 일화와 에피소드
   - nextDirection: 200-300자 이상 - 명확한 이동 경로와 거리 안내
   - **총 1600자 이상의 상세한 교육적 오디오** (현장관찰 부분 100글자 증가)

5. **연결 패턴의 다양화 (🎯 핵심 개선점)**
   각 장소와 상황에 맞는 자연스러운 연결어를 사용하세요:
   
   **sceneDescription → coreNarrative 연결 (다양한 패턴)**:
   - "그런데 이 모든 것에는 어떤 비밀이 숨어있을까요? → 바로 그 이야기를..."
   - "왜 이렇게 특별할까요? → 그 이유는 바로..."  
   - "어떤 역사가 있을까요? → 실제로 이곳은..."
   - "무엇이 이렇게 만들었을까요? → 놀랍게도..."
   - "혹시 궁금하지 않으세요? → 말씀드리자면..."
   - "어떤 이야기일까요? → 역사를 돌아보면..."
   
   **coreNarrative → humanStories 연결 (다양한 패턴)**:
   - "이런 역사 속에는 감동적인 사람들이... → 바로 그 중 한 분이..."
   - "그 과정에서 놀라운 인물이... → 실제로 이 분은..."
   - "당시에는 특별한 사람들이... → 예를 들어..."
   - "이 모든 것 뒤에는 누군가의 노력이... → 그 주인공은..."
   - "역사의 뒤편에는 흥미로운 인물이... → 그 분의 이야기를 들어보면..."
   - "그 시대를 살았던 사람들 중에... → 특히 기억해야 할 분이..."

6. **철저한 사실 검증 원칙 (🚨 절대 준수)**
   - **모든 정보는 검증 가능한 사실만**: 공식 기록, 학술 자료, 역사 문헌 기반
   - **humanStories 엄격 기준**: 반드시 역사적으로 검증된 실존 인물과 실제 사건만
   - **절대 금지**: 가상의 인물, 꾸며낸 일화, 추측성 정보, 과장된 표현
   - **확실하지 않은 정보는 배제**: "아마도", "추정된다", "전해진다" 등의 불확실한 표현 금지
   - **사실성 강조 표현**: "기록에 따르면", "실제로", "역사서에 보면", "공식 문서에 의하면"
   - **검증된 수치만 사용**: 정확한 연도, 치수, 개수 등 공식 자료에 기반한 수치만`,
    
    examples: {
      diverse_connections: [
        "자, 그런데 이 아름다운 모습 뒤에는 어떤 이야기가 숨어있을까요?",
        "혹시 이 건물이 왜 이렇게 지어졌는지 궁금하지 않으세요?", 
        "놀랍게도 이곳에는 우리가 모르는 놀라운 비밀이 있어요",
        "실제로 이 장소에는 정말 특별한 의미가 담겨있는데요",
        "그런데 말이죠, 여기서 정말 흥미로운 것은...",
        "어떤 사연이 있을까요? 함께 알아보시죠"
      ],
      specific_information: [
        "{구체적 장소명}의 {구체적 특징}은 {구체적 사실/수치}입니다",
        "{연도}년 {인물명}이 {구체적 행동/사건}을 진행했습니다",
        "{재료/기법}으로 만들어진 {구체적 부분}은 {기능/의미}를 담고 있습니다",
        "{방향/위치}에 위치한 {구체적 명칭}은 {역사적 배경}을 보여줍니다",
        "{측정값}의 크기를 가진 {구체적 건축요소}는 {기술적 특징}을 나타냅니다",
        "{시대}의 {구체적 사건} 당시 {실존 인물}은 {검증 가능한 행동}을 했습니다"
      ]
    }
  }
};

/**
 * 한국어 가이드 생성 프롬프트 (index.ts 호환용)
 */
export const createKoreanGuidePrompt = (
  locationName: string,
  userProfile?: UserProfile,
  parentRegion?: string,
  regionalContext?: any
): string => {
  const langConfig = LANGUAGE_CONFIGS.ko;
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
- 지식수준: ${userProfile.knowledgeLevel || '중급'}
- 동행자: ${userProfile.companions || '혼자'}
` : '👤 일반 관광객 대상';

  const specialistContext = typeConfig ? `
🎯 전문 분야 가이드 설정:
- 감지된 위치 유형: ${locationType}
- 전문가 역할: ${typeConfig.expertRole}
- 중점 분야: ${typeConfig.focusAreas.join(', ')}
- 특별 요구사항: ${typeConfig.specialRequirements}
` : '';

  // 🎯 지역 컨텍스트 정보 생성
  const regionalContextInfo = parentRegion || regionalContext ? `
🌍 지역 컨텍스트 정보:
${parentRegion ? `- 상위 지역: ${parentRegion}` : ''}
${regionalContext?.parentRegion ? `- 추천 출처 지역: ${regionalContext.parentRegion}` : ''}
${regionalContext?.spotName ? `- 원래 추천 명칭: ${regionalContext.spotName}` : ''}

⚠️ **지역별 구체화 필수**: ${locationName}이 여러 지역에 존재할 수 있는 경우, 반드시 ${parentRegion || regionalContext?.parentRegion || '해당 지역'}의 ${locationName}에 특화된 정보를 제공하세요. 다른 지역의 동명 장소와 혼동하지 말고, 정확한 지역의 특징과 정보를 포함해야 합니다.
` : '';

  const prompt = `# 🎙️ "${locationName}" 전문가급 한국어 오디오 가이드 생성

## 🎭 당신의 역할
당신은 **${typeConfig?.expertRole || '전문 관광 가이드'}**입니다. 
${locationName}에 특화된 깊이 있는 전문 지식으로 최고 품질의 가이드를 제공하세요.

${specialistContext}

${regionalContextInfo}

## 🎯 위치 유형별 전문 정보 요구사항

### 📍 **${locationType.toUpperCase()} 전문 해설 기준**
${getLocationSpecificRequirements(locationType)}

${userContext}

## 📋 출력 형식 요구사항

### 1. **순수 JSON만 반환**
- 서론, 설명, 코드블록(\`\`\`) 없이 오직 JSON만
- 완벽한 JSON 문법 준수 (쉼표, 따옴표, 괄호) 
- 키 이름은 예시와 100% 동일하게 (번역 금지)
- **이모지 사용 금지**: 📍 ✨ 🏛️ 🎯 등 모든 이모지 제외, 순수 텍스트만 사용

### 🚀 **품질 향상 핵심 원칙**
- **전문성**: ${typeConfig?.expertRole || '종합 전문가'} 수준의 깊이 있는 해설
- **🎯 사실성**: 검증 가능한 구체적 사실과 수치만 사용 - 공식 기록, 학술 자료 기반
- **정확성**: 모든 정보는 확인된 사실에 근거, 추측이나 가정 절대 금지
- **차별성**: 다른 관광지와 구별되는 고유한 특징 강조
- **스토리텔링**: 건조한 정보가 아닌 사실에 기반한 감동적인 이야기로 구성

### 🔍 **${locationType.toUpperCase()} 유형 품질 검증 기준**
${getQualityRequirementsByType(locationType)}

### 🚨 **절대 금지 사항**
- **일반적 표현**: "상상해보세요", "경이로운", "놀라운" 등
- **모호한 지시어**: "여기서", "이곳" (구체적 장소명 필수)
- **검증 불가능한 내용**: 추측, 가정, 개인 의견, 확인되지 않은 정보
- **과장된 표현**: "세계 최고", "유례없는", "믿을 수 없는" 등 근거 없는 수식어
- **불확실한 표현**: "아마도", "추정된다", "전해진다", "소문에 의하면" 등
- **가상의 내용**: 꾸며낸 인물, 상상의 일화, 추측성 시나리오
- **빈 정보**: 실질적 정보 없이 분량만 채우는 내용
- **🔥 반복 정보**: 같은 역사적 배경, 건립/복원 연도를 여러 챕터에서 반복

### 2. **개요(overview) 구조 - 간결한 양식**
개요는 다음 3개 필드로 구성되어야 합니다:
- **location**: 📍 지역명만 15자 이내 (예: "📍 강원도 강릉시")
- **keyFeatures**: ✨ 핵심 키워드 25자 이내 (예: "✨ 바다 뷰 카페거리")
- **background**: 🏛️ 한 줄 요약 30자 이내 (예: "🏛️ 자연과 문화가 어우러진 관광명소")

### 📏 **개요 섹션 글자 수 제한**
- **location**: 15자 이내, 수식어 제거, 지역명만 명시
- **keyFeatures**: 25자 이내, 핵심 특징만 간결하게
- **background**: 30자 이내, 한 줄로 핵심 의미만

### ✨ **작성 원칙**
- 수식어 최소화 (아름다운, 웅장한 등 제거)
- 핵심 키워드만 나열
- 이모지 활용으로 시각적 구분
- 모바일에서 한눈에 파악 가능하도록 간결화

### 3. **필수관람포인트 구조**
반드시 방문해야 하는 핵심 장소들을 해시태그로 표현:
- **mustVisitSpots**: 🎯 이모지 + 3-5개 해시태그 (예: "🎯 #경포해수욕장 #안목커피거리 #오죽헌 #정동진 #테라로사")

### 📏 **필수관람포인트 작성 원칙**
- 3-5개 장소로 제한 (너무 많으면 선택 부담)
- 장소명만 간결하게 (수식어 제거)
- 해시태그 형태로 시각적 구분
- 해당 지역의 대표 명소 위주 선별

### 4. **챕터 제목 형식 - 중요**
모든 챕터 제목은 반드시 **"장소명: 간략설명"** 형태로 작성해야 합니다:
- ✅ 올바른 예: "해운대 해수욕장: 웅장한 백사장과 푸른 바다"
- ✅ 올바른 예: "달맞이 고개: 낭만적인 야경과 카페 거리"
- ❌ 잘못된 예: "다양한 먹거리와 부산의 정취 느끼기"
- ❌ 잘못된 예: "아름다운 해안 풍경 감상하며 산책"

**🚨 절대 중요: 챕터 제목은 반드시 실제 장소명으로 시작해야 합니다!**
**🚨 일반적인 설명이나 동작 표현으로 제목을 만들지 마세요!**
**🚨 예시: "해운대 시장: 다양한 먹거리와 부산의 정취" (O) vs "다양한 먹거리와 부산의 정취 느끼기" (X)**

### 4. **자연스러운 한국어 스토리텔링**
- 친근한 구어체 사용
- 교육적이면서도 재미있는 구성
- 역사적 사실과 인간적 감정이 조화

### 🚨 **중복 방지 원칙 (매우 중요!)**
**복합 건물군(궁궐, 사찰, 대학, 공원 등)에서는 반복을 철저히 방지하세요:**

#### ✅ **올바른 정보 배치**
- **인트로 챕터(ID=0)**: 해당 장소 전체에 대한 포괄적 소개와 배경지식 (창건, 복원, 주요 사건, 문화적 맥락, 전체 구성 및 의미)
- **1챕터 이후**: 각 개별 공간/건물만의 고유한 특징, 기능, 특별한 이야기

#### ❌ **절대 금지 - 반복 패턴**
잘못된 예시:
• 인트로: "광화문의 건축 특징만 설명" ← 🚫 개별 건물 중심!
• 1챕터: "창경궁은 1484년 창건되어 임진왜란 때 소실되었다가 1604년 복원되었습니다" ← 🚫 인트로에서 다뤄야 할 내용!
• 2챕터: "홍화문은 1484년 창경궁과 함께 건립되어..." ← 🚫 중복!

#### ✅ **올바른 예시**
• 인트로: "창경궁 전체 소개 - 1484년(성종 15년) 창건부터 현재까지의 역사, 조선 왕실 별궁의 의미, 전체 구성과 주요 볼거리 개관" ← ✅ 포괄적 배경!
• 1챕터: "홍화문의 독특한 건축 양식과 문 장식의 의미" ← ✅ 개별 특징!  
• 2챕터: "명정전의 어좌와 천장 문양, 정치적 기능" ← ✅ 고유 특성!

#### **🎯 각 챕터 차별화 전략**
- **건축적 특징**: 지붕 형태, 기둥 양식, 장식 요소
- **기능적 역할**: 용도, 의례, 실제 사용된 방법  
- **독특한 이야기**: 해당 건물에서만 일어난 특별한 사건
- **예술적 가치**: 특별한 그림, 조각, 현판의 의미
- **관람 포인트**: 꼭 봐야 할 세부 요소, 감상 각도

### 5. **완전한 오디오 가이드 구조**
- overview: 장소 전체 개관 (간결한 양식)
- mustVisitSpots: 필수 관람 포인트 (해시태그)
- route: 관람 순서와 동선
- realTimeGuide: 각 지점별 상세 가이드 (좌표 포함 필수)

### 6. **📍 좌표 정보 필수 포함 - 매우 중요!**
각 챕터에는 반드시 정확한 GPS 좌표를 포함해야 합니다:
- **coordinates**: 각 챕터마다 실제 위치의 정확한 GPS 좌표 (lat, lng, description)
- **좌표 정확성**: 실제 관광지의 정확한 위치 정보 제공
- **설명 포함**: coordinates.description에 구체적인 위치 설명 포함

### 📏 **좌표 정보 작성 원칙**
- **lat**: 위도 (소수점 4자리까지 정확히)
- **lng**: 경도 (소수점 4자리까지 정확히)  
- **description**: 해당 좌표 지점의 구체적 위치 설명 (예: "에펠탑 1층 입구", "스핑크스 정면 관람대")

**🚨 좌표 예시:**
"coordinates": {
  "lat": 37.5812,
  "lng": 126.9768,
  "description": "경복궁 경회루 앞 정문 입구"
}

${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

**"${locationName}"의 자연스럽고 매력적인 한국어 오디오 가이드를 순수 JSON으로만 반환하세요!**

**🚨 최종 확인사항:**
- 모든 챕터 제목은 "장소명: 간략설명" 형태여야 합니다
- 장소명은 실제 구체적인 장소 이름이어야 합니다
- 일반적인 설명이나 동작 표현으로 제목을 만들지 마세요`;

  return prompt;
};

/**
 * 개선된 자율 리서치 기반 AI 오디오 가이드 생성 프롬프트
 */
export const createAutonomousGuidePrompt = (
  locationName: string,
  language: string = 'ko',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ko;
  const audioStyle = AUDIO_GUIDE_INSTRUCTIONS[language] || AUDIO_GUIDE_INSTRUCTIONS.ko;
  
  // 위치 유형 분석 및 전문 가이드 설정
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
- 지식수준: ${userProfile.knowledgeLevel || '중급'}
- 동행자: ${userProfile.companions || '혼자'}
` : '👤 일반 관광객 대상';

  const specialistContext = typeConfig ? `
🎯 전문 분야 가이드 설정:
- 감지된 위치 유형: ${locationType}
- 전문가 역할: ${typeConfig.expertRole}
- 중점 분야: ${typeConfig.focusAreas.join(', ')}
- 특별 요구사항: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 몰입형 오디오 가이드 생성 미션

## 🎭 당신의 역할
${audioStyle.style}

${specialistContext}

## 🎯 미션
"${locationName}"에 대한 **몰입감 넘치는 ${langConfig.name} 오디오 가이드** JSON을 생성하세요.

${userContext}

### 2. **실제 장소 구조 기반 구성**
각 관광지나 장소의 **실제 관람 순서와 공간 구성**에 맞춰 route.steps를 구성하세요.

**🚨 CRITICAL: location 필드는 반드시 구체적인 장소명 사용**
- ❌ 금지: "입구", "중앙홀", "주요전시실", "특별공간", "전망대" 등 일반적인 용어
- ✅ 필수: "광화문", "근정전", "경회루", "국립고궁박물관" 등 실제 고유 장소명
- ✅ 필수: "에펠탑", "루브르 박물관", "시테 섬" 등 방문자가 찾을 수 있는 구체적 이름
- ✅ 필수: "[장소명] [구체적 건물/구역명]" 형태로 더욱 상세하게 (예: "동대문디자인플라자 아트홀")

**🎯 인트로 챕터(ID=0) 특별 지침 - 관광 시작점의 핵심:**

**🚨 CRITICAL: 인트로 챕터 제목은 반드시 구체적이고 찾을 수 있는 실제 시작지점이어야 함**

### ✅ **관광객이 실제로 찾을 수 있는 시작지점 예시:**

**✅ Google Places API 최적화된 정확한 예시:**
- "국립중앙박물관"
- "루브르 박물관" 
- "광화문 매표소"
- "베르사유 궁전"
- "남산케이블카"
- "5합목 방문자센터"
- "명동역 2번 출구"
- "콜로세움역"

### 🎯 **Google Places API 최적화 제목 공식:**
\`\`\`
"[구체적 시설명만]" (설명문 완전 금지)
\`\`\`

**✅ 최적화 요구사항:**
1. **장소명만 작성** (콜론(:) 뒤의 모든 설명문 금지)
2. **Google Maps 직접 검색 가능한 실제 시설명**
3. **좌표 정확도 50m 이내 달성 목표**
4. **영어/한국어 혼용 허용** (검색 정확도 우선)

---

**🔴 나머지 챕터 제목 형식:**
\`\`\`
"[구체적 장소명]: [그 장소의 특징/의미]"
\`\`\`

**📝 일반 챕터 예시:**

**🏛️ 박물관/전시관:**
- "입구홀: 웅장한 첫 만남과 전체 개관"
- "상설전시관: 핵심 컬렉션의 진수"
- "기획전시실: 특별한 만남과 새로운 발견"

**🏰 궁궐/유적지:**
- "정문: 역사 속으로의 첫 걸음"
- "정전: 왕권과 위엄의 상징공간"
- "후원: 자연과 조화된 휴식처"

**🏔️ 자연/공원:**
- "입구광장: 자연과의 첫 만남"
- "전망대: 파노라마 뷰포인트"
- "산책로: 자연 속 힐링코스"

**🏪 시장/상점가:**
- "중앙통로: 활기찬 시장의 심장부"
- "전통상점가: 옛 정취가 살아있는 공간"
- "먹거리촌: 미식가들의 천국"

**🔴 JSON 구조 예시:**
\`\`\`json
{
  "route": {
    "steps": [
      { "step": 1, "location": "명동성당 정문", "title": "명동성당 정문: 여행의 시작점" },
      { "step": 2, "location": "명동성당 대성전", "title": "명동성당 대성전: 가장 중요한 볼거리" },
      { "step": 3, "location": "명동성당 지하묘지", "title": "명동성당 지하묘지: 숨겨진 보석 같은 장소" }
    ]
  },
  "realTimeGuide": {
    "chapters": [
      { "id": 0, "title": "메인입구 - 여행의 시작점" },
      { "id": 1, "title": "중심부 - 가장 중요한 볼거리" },
      { "id": 2, "title": "특별전시공간 - 숨겨진 보석 같은 장소" }
    ]
  }
}
\`\`\`

**🚨 CRITICAL - 모든 장소 공통 규칙:**
- 반드시 "[구체적 장소명] - [특징/의미]" 형식 준수
- 장소명은 방문자가 실제로 찾아갈 수 있는 구체적 위치
- 대시(-) 필수 사용으로 장소명과 특징 구분
- route.steps와 realTimeGuide.chapters의 title 완전 동일

### 3. **3개 필드의 완벽한 연결 🚨 핵심 개선사항**

**✅ 향상된 구조 (배경지식 + 확장된 현장관찰)**:
\`\`\`
sceneDescription: 배경지식 설명 + 확장된 현장관찰(아웃라인 → 디테일) → 자연스러운 호기심 질문
coreNarrative: 호기심의 답 + 역사적 맥락 → 인물 이야기 예고  
humanStories: 실제 인물 이야기 → 감동적 마무리
nextDirection: (별도 분리) 이동 안내만
\`\`\`

**🚨 연결의 자연스러움 - 매우 중요!**
- 각 장소에 맞는 독창적이고 자연스러운 연결어 사용
- 뻔한 템플릿 말고 상황에 맞는 다양한 표현
- 마치 실제 가이드가 즉석에서 이야기하는 듯한 자연스러움

**❌ 피해야 할 템플릿식 표현:**
- "과연 이 장소가 어떤 특별한 이야기를 간직하고 있을까요?"
- "바로 그 비밀을 지금부터 들려드릴게요"
- "네, 바로 그 사람들의 이야기인데요"

**✅ 필수 사용 구체적 표현 패턴:**
- "{구체적 장소명}에서 확인할 수 있는 {물리적 특징}은..."
- "{연도}년 {실존 인물명}이 {구체적 장소}에서 {검증 가능한 행동}을..."
- "{측정값} 크기의 {구체적 건축요소}는 {기술적 사실}을..."
- "{방향/위치}에 위치한 {구체적 명칭}의 {역사적 배경}은..."

### 4. **풍부하고 독창적인 콘텐츠**
- 각 필드별 최소 분량 엄수 (위 기준 참조)
- 장소의 특성을 살린 독창적 묘사
- 뻔한 설명 대신 흥미진진한 스토리텔링
- 역사적 사실 + 인간적 감정 + 현장 몰입감

### 5. **동적 챕터 구성**
- **위치의 규모와 특성에 따라 적절한 개수의 챕터 생성**
- **소규모 장소: 3-4개, 중간 규모: 5-6개, 대규모 복합시설: 7-8개**
- **🔴 CRITICAL: route.steps와 realTimeGuide.chapters 개수 및 제목 완벽 일치**

### 6. **📍 위치 설명 필수 포함**
각 챕터에는 반드시 정확한 위치 설명을 포함해야 합니다:
- **description**: 해당 챕터 지점의 구체적 위치 설명
- **위치 정확성**: 실제 관광지 내 구체적 장소나 구역 설명
- **주의**: 좌표(coordinates)는 시스템에서 자동으로 처리되므로 포함하지 마세요

**🚨 위치 설명 예시:**
"description": "에펠탑 1층 중앙 홀 입구"

**⚠️ 주의사항:**
- 좌표(coordinates) 객체는 절대 포함하지 마세요
- 시스템에서 Enhanced Location Service로 정확한 좌표를 자동 생성합니다

## 💡 오디오 가이드 작성 예시

**❌ 나쁜 예시 (단절적, 템플릿식, 사실 검증 부족)**:
- sceneDescription: "광화문은 경복궁의 정문입니다. 높이는 20미터입니다." (추측성 수치)
- coreNarrative: "1395년에 건축되었습니다. 일제강점기에 이전되었습니다." (사실 확인 표현 없음)
- humanStories: "세종대왕이 현판을 썼습니다. 복원 공사가 있었습니다." (검증되지 않은 내용)

**✅ 개선된 자연스러운 예시 (배경지식 + 확장된 현장관찰)**:
- sceneDescription: "광화문은 조선왕조 500년 역사의 상징적인 정문으로, 단순한 출입구가 아니라 왕권과 백성을 연결하는 소통의 창구 역할을 했어요. 현재 우리 앞에 펼쳐진 모습을 살펴보면, 전체적으로는 3층 구조의 웅장한 성문이 시선을 압도하며 왕궁의 격식과 품위를 한눈에 보여줍니다. 좀 더 자세히 관찰해보시면, 화강암으로 쌓아 올린 기단부 위에 목조 누각이 올라가 있고, 지붕의 처마선이 우아하게 곡선을 그리며 하늘로 뻗어 오르는 모습이 인상적이에요. 특히 문 양쪽의 해치상과 현판의 글씨체, 그리고 단청의 오색 조화를 보시면 조선 건축 기술의 정수를 느낄 수 있을 겁니다. 그런데 말이죠, 이 문이 왜 이렇게 크고 화려하게 지어졌는지 아세요?"
- coreNarrative: "그 이유는 바로 조선 초기 왕권 확립과 관련이 있어요. 조선왕조실록에 기록된 바에 따르면, 태조 이성계가 1395년 경복궁을 창건하면서 광화문을 정문으로 삼은 것은 단순히 기능적 목적이 아니라, 새로운 왕조의 위엄과 정통성을 보여주기 위함이었죠. 하지만 이 문은 순탄한 역사만 겪은 것은 아니에요. 일제강점기에는 강제로 이전당했고, 해방 후에도 여러 번 자리를 옮겨야 했거든요. 그런데 이런 고난의 역사 속에서도 광화문을 지키고 복원하려 했던 분들이 계셨어요."
- humanStories: "기록에 따르면 1968년 광화문 복원 공사 당시 문화재 전문가들이 참여했는데, 특히 원형 복원을 위해 일제강점기에 촬영된 흑백사진과 고문헌을 분석하며 정확한 치수와 구조를 찾아내는 작업이 진행되었어요. 실제로 몇 년간의 치밀한 고증 작업을 통해 오늘날 우리가 보는 광화문의 모습이 완성된 거죠. 이런 전문가들의 노력이 있었기에 우리가 지금 이 역사적인 순간을 함께할 수 있는 겁니다."

## 📐 최종 JSON 구조:
${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

## ✅ 최종 체크리스트
- [ ] 모든 텍스트가 ${langConfig.name}로 작성됨
- [ ] route.steps와 realTimeGuide.chapters 완벽 매칭
- [ ] 3개 필드가 자연스럽게 연결된 8-9분 스토리
- [ ] nextDirection은 별도 분리되어 이동 안내만
- [ ] 템플릿식 표현 대신 자연스럽고 독창적 스토리텔링
- [ ] **📍 모든 챕터에 정확한 coordinates 정보 포함 (lat, lng, description)**
- [ ] JSON 문법 100% 정확

**🔴 핵심 개선사항 요약 🔴**
1. **3개 필드만 연결**: nextDirection은 별도 처리
2. **자연스러운 연결**: 템플릿 대신 상황별 다양한 표현
3. **독창적 스토리텔링**: 장소 특성을 살린 고유한 묘사
4. **완전한 분리**: 이동 안내는 오직 nextDirection에만
5. **📍 좌표 필수**: 모든 챕터에 정확한 GPS 좌표 포함 필수
6. **🎯 사실성 절대 준수**: 검증 가능한 사실만 사용, 추측이나 가정 절대 금지

**지금 바로 "${locationName}"의 자연스럽고 매력적인 오디오 가이드를 순수 JSON으로만 반환하세요!**`;

  return prompt;
}

/**
 * 한국어 최종 가이드 생성 프롬프트 (index.ts 호환용)
 */
export const createKoreanFinalPrompt = (
  locationName: string,
  researchData: any,
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS.ko;
  const audioStyle = AUDIO_GUIDE_INSTRUCTIONS.ko;
  // 위치 유형 분석 및 전문 가이드 설정
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
- 지식수준: ${userProfile.knowledgeLevel || '중급'}
- 동행자: ${userProfile.companions || '혼자'}
` : '👤 일반 관광객 대상';

  const specialistContext = typeConfig ? `
🎯 전문 분야 가이드 설정:
- 감지된 위치 유형: ${locationType}
- 전문가 역할: ${typeConfig.expertRole}
- 중점 분야: ${typeConfig.focusAreas.join(', ')}
- 특별 요구사항: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 최종 오디오 가이드 생성

## 🎭 당신의 역할
${audioStyle.style}

${specialistContext}

## 📚 리서치 데이터 기반 가이드 작성
아래 제공된 상세한 리서치 데이터를 바탕으로 더욱 정확하고 풍부한 오디오 가이드를 작성하세요.

### 리서치 데이터:
${JSON.stringify(researchData, null, 2)}

${userContext}

## 📐 최종 가이드 작성 지침

### 1. **리서치 데이터 활용**
- 제공된 모든 정보를 자연스럽게 스토리텔링에 녹여내기
- 역사적 사실, 날짜, 인물 정보를 정확하게 반영
- 리서치에서 발견한 흥미로운 일화나 숨은 이야기 적극 활용

### 2. **오디오 스크립트 품질**
- 리서치 데이터의 딱딱한 정보를 친근한 구어체로 변환
- 전문적 내용을 쉽고 재미있게 풀어서 설명
- 청취자가 지루하지 않도록 드라마틱한 구성

### 3. **향상된 콘텐츠**
- 리서치 데이터를 바탕으로 각 챕터를 더욱 상세하게
- 구체적인 수치, 날짜, 인물명을 정확히 포함
- 리서치에서 얻은 인사이트로 스토리텔링 강화

### 4. **향상된 분량 기준 (한국어 기준 - 챕터당 1600자 목표)**
- sceneDescription: 500-600자 이상 (배경지식 + 확장된 현장관찰로 향상된 현장감)
- coreNarrative: 800-1000자 이상 (역사적 사실과 의미 상세 설명)
- humanStories: 300-400자 이상 (구체적인 인물 일화와 에피소드)
- nextDirection: 200-300자 이상 (명확한 이동 경로와 거리 안내)


## 📐 최종 JSON 구조:
${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

## ✅ 품질 체크리스트
- [ ] 리서치 데이터의 모든 중요 정보 반영
- [ ] 역사적 사실과 날짜의 정확성
- [ ] 자연스러운 스토리텔링 흐름
- [ ] 오디오로 들었을 때 지루하지 않은 구성
- [ ] 각 챕터 8-10분 분량의 풍성한 콘텐츠
- [ ] 3개 필드가 끊김 없이 연결되는 하나의 대본

**🔴 필수 준수사항 🔴**
각 챕터는 한 사람이 8분간 쉬지 않고 이야기하는 것입니다!
sceneDescription → coreNarrative → humanStories가
물 흐르듯 자연스럽게 이어져야 합니다.
절대로 각 필드를 독립적인 섹션으로 작성하지 마세요!

**리서치 데이터를 완벽히 활용하여 "${locationName}"의 최고의 오디오 가이드를 만들어주세요!**`;

  return prompt;
}

/**
 * 구조 생성용 프롬프트 (overview + route만)
 */
export const createStructurePrompt = (
  locationName: string,
  language: string = 'ko',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ko;
  const userContext = userProfile ? `
👤 사용자 맞춤 정보:
- 관심사: ${userProfile.interests?.join(', ') || '일반'}
- 연령대: ${userProfile.ageGroup || '성인'}
` : '👤 일반 관광객 대상';

  // 위치 유형 분석 및 권장 스팟 수 정보
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType] || LOCATION_TYPE_CONFIGS.general;
  const spotCount = getRecommendedSpotCount(locationName);

  return `# 🏗️ "${locationName}" 가이드 기본 구조 생성

## 🎯 미션
"${locationName}"에 대한 **기본 구조(overview + route)만** 생성하세요.
실시간 가이드 챕터는 제목만 포함하고, 상세 내용은 생성하지 마세요.

${userContext}

## 🎯 위치 분석 정보
- 감지된 위치 유형: ${locationType}
- 권장 스팟 수: ${typeConfig.recommendedSpots}
- 최적 스팟 범위: ${spotCount.min}-${spotCount.max}개
- 추천 기본값: ${spotCount.default}개

## 📋 출력 형식
순수 JSON만 반환. 코드 블록이나 설명 없이 오직 JSON만.

**스팟 수 결정 가이드라인:**
- **소규모 단일 건물/상점**: 3-4개 스팟
- **중간 규모 관광지**: 5-6개 스팟  
- **대형 복합시설/궁궐**: 7-8개 스팟
- **자연공원/산책로**: 주요 뷰포인트별로 4-6개
- **맛집 투어 지역**: 음식 종류에 따라 5-8개

### 구조 예시 (스팟 수는 위치에 맞게 조정):
{
  "content": {
    "overview": {
      "title": "${locationName}",
      "location": "📍 지역명만 (예: 📍 강원도 강릉시)",
      "keyFeatures": "✨ 핵심 키워드 (예: ✨ 바다 뷰 카페거리)",
      "background": "🏛️ 한 줄 요약 (예: 🏛️ 자연과 문화가 어우러진 관광명소)",
      "narrativeTheme": "핵심 테마 한 줄",
      "keyFacts": [
        { "title": "주요 정보1", "description": "설명" },
        { "title": "주요 정보2", "description": "설명" }
      ],
      "visitInfo": {
        "duration": "적절한 소요시간",
        "difficulty": "난이도",
        "season": "최적 계절"
      }
    },
    "mustVisitSpots": "🎯 #장소1 #장소2 #장소3 #장소4 #장소5",
    "route": {
      "steps": [
        { "step": 1, "location": "[장소명] [매표소/안내소/방문자센터/역출구 등]", "title": "[장소명] [구체적 시작지점]: [관광 시작점임을 명시]" },
        { "step": 2, "location": "동대문디자인플라자 아트홀", "title": "동대문디자인플라자 아트홀: 웅장한 공간의 압도적 경험" },
        { "step": 3, "location": "동대문디자인플라자 디자인박물관", "title": "동대문디자인플라자 디자인박물관: 핵심 컬렉션과 역사적 가치" },
        { "step": 4, "location": "동대문디자인플라자 디자인랩", "title": "동대문디자인플라자 디자인랩: 숨겨진 이야기와 문화적 의미" },
        { "step": 5, "location": "동대문디자인플라자 옥상정원", "title": "동대문디자인플라자 옥상정원: 파노라마 뷰와 마무리 감상" }
      ]
    },
    "realTimeGuide": {
      "chapters": [
        { "id": 0, "title": "[장소명]을 관람하기 위한 구체적인 시작지점: [매표소/안내소/주차장/역출구/케이블카승강장 등 누구나 찾을 수 있는 실제 장소명]" },
        { "id": 1, "title": "중앙홀: 웅장한 공간의 압도적 경험" },
        { "id": 2, "title": "주요전시실: 핵심 컬렉션과 역사적 가치" },
        { "id": 3, "title": "특별공간: 숨겨진 이야기와 문화적 의미" },
        { "id": 4, "title": "전망대: 파노라마 뷰와 마무리 감상" }
      ]
    }
  }
}

**중요**: 
- route.steps와 realTimeGuide.chapters의 title이 정확히 동일해야 함
- **위치의 규모와 특성을 고려하여 적절한 수의 스팟 구성** (3-8개 범위 내)
- 입구 → 주요 지점들 → 마무리/출구 순서로 자연스러운 동선
- 챕터에는 제목만 포함, 상세 내용 없음
- 순수 JSON만 반환, 설명이나 코드블록 없음`;
}

/**
 * 챕터 상세 생성용 프롬프트
 */
export const createChapterPrompt = (
  locationName: string,
  chapterIndex: number,
  chapterTitle: string,
  existingGuide: any,
  language: string = 'ko',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ko;

  return `🎙️ "${locationName}" 챕터 ${chapterIndex + 1}: "${chapterTitle}" 완전한 오디오 가이드 생성

🎯 미션
당신은 전문 관광 가이드로서 "${chapterTitle}" 지점에서 관광객들에게 들려줄 **완전하고 상세한** 오디오 가이드 스크립트를 작성해야 합니다.

📚 기존 가이드 컨텍스트
${JSON.stringify(existingGuide, null, 2)}

🚨 **절대 중요 - 완전한 내용 필수**
- narrative 필드에 **최소 1500-1600자의 완전한 내용** 작성 (절대 짧게 쓰지 마세요!)
- **배경지식 + 확장된 현장관찰(아웃라인 → 디테일)** 순서로 현장 묘사 + 역사적 배경 + 인물 이야기를 **하나의 자연스러운 스토리**로 통합
- AI가 "...더 자세한 내용은..." 같은 미완성 표현 절대 사용 금지
- **완전하고 풍부한 실제 가이드 수준의 내용**을 작성하세요

🎭 스타일 가이드
- 친근한 구어체 ("여기서 주목할 점은", "흥미로운 사실은", "이야기를 들어보면" 등)
- 교육적이면서도 재미있는 스토리텔링
- 마치 옆에서 친구가 설명해주는 듯한 친근함
- **각 부분이 자연스럽게 이어지는 하나의 완전한 이야기**


✅ **권장 시작 표현**
- "이곳에서..." "여기서 주목할 점은..." "흥미롭게도..."
- "바로 앞에 보이는..." "이 장소에서..."
- "이제 우리는..." "계속해서..." "다음으로 만나볼..."

✅ 필수 출력 형식
**중요: 순수 JSON만 출력하세요. 코드블록이나 설명 없이!**

{
  "chapter": {
    "id": ${chapterIndex},
    "title": "${chapterTitle}",
    "narrative": "이곳에서 가장 먼저 눈에 들어오는 것은... [현장 묘사 500자] \\n\\n 이 장소의 역사를 살펴보면... [역사적 배경 500자] \\n\\n 특히 기억해야 할 인물은... [인물 이야기 300자]",
    "nextDirection": "현재 위치에서 [기준점: 메인건물/담장/길]을 따라 [방향: 북쪽/남쪽/동쪽/서쪽/북동쪽/북서쪽/남동쪽/남서쪽]으로 정확히 [숫자]미터 직진하세요. 이동 중 [경로특징: 분수대/조형물/표지판/계단] 등을 지나면 [도착신호: 특정건물/간판/입구]가 보입니다. 도보 약 [숫자]분 소요됩니다."
  }
}

🚨 JSON 안전성 필수 규칙 🚨
1. **문단 구분**: 오직 " \\n\\n " (공백+백슬래시n+백슬래시n+공백)로만 구분
2. **실제 줄바꿈 금지**: 텍스트에 실제 Enter나 줄바꿈 절대 사용 금지
3. **탭 문자 금지**: \\t 또는 실제 탭 문자 사용 금지
4. **한 줄 작성**: 모든 JSON을 한 줄로 연결해서 작성
5. **따옴표 이스케이프**: 텍스트 내 따옴표는 반드시 \\\"로 이스케이프

**문단 구분 올바른 예시:**
"narrative": "첫 번째 문단 내용입니다. \\n\\n 두 번째 문단 내용입니다. \\n\\n 세 번째 문단 내용입니다."

**절대 금지 예시:**
"narrative": "첫 번째 문단
두 번째 문단" // ← 실제 줄바꿈 금지!

🚨 절대 준수사항 🚨
- **narrative 필드는 반드시 1500-1600자 (최소 1500자!)**
- **배경지식 + 확장된 현장관찰(아웃라인 → 디테일) 순서로 구성된 자연스러운 플로우**
- 서론이나 설명 없이 바로 JSON 시작
- 코드블록 표시 절대 금지  
- 문법적으로 완벽한 JSON 형식
- 미완성 내용이나 "추후 보완" 같은 표현 절대 금지

지금 바로 "${chapterTitle}" 챕터의 **완전하고 풍부한** 오디오 가이드를 생성해주세요!`;
}

// 기타 유틸리티 함수들
export const createKoreanStructurePrompt = createStructurePrompt;
export const createKoreanChapterPrompt = createChapterPrompt;