// 全世界すべての場所のための汎用AI音声ガイド生成プロンプトシステム（改良版）

import { UserProfile } from '@/types/guide';
import { 
  LANGUAGE_CONFIGS, 
  LOCATION_TYPE_CONFIGS, 
  analyzeLocationType,
  getRecommendedSpotCount 
} from './index';

/**
 * 🎯 位置タイプ別品質検証基準生成
 */
function getQualityRequirementsByType(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `- **建築データ**: 建物高さ、建築年代、柱数、面積等
- **皇室人物**: 具体的君主名、在位期間、主要業績
- **建築用語**: 垂木、斗栱、丹青、オンドル等正確な用語`;
    case 'religious':
      return `- **宗教用語**: 法堂、塔、仏像、梵鐘等正確な名称
- **創建情報**: 創建年代、創建者、重建歴史
- **宗教儀礼**: 具体的修行法、礼拝時間、儀式手順`;
    case 'historical':
      return `- **歴史年代**: 正確な年代、事件発生日
- **歴史人物**: 実存人物の具体的行跡と業績
- **遺物情報**: 出土年代、材質、大きさ、文化財指定番号`;
    case 'nature':
      return `- **地質情報**: 形成年代、岩石種類、地質構造
- **生態データ**: 生息動植物種数、面積、海抜高度
- **環境数値**: 年平均気温、降水量、湿度等`;
    case 'culinary':
      return `- **調理情報**: 調理時間、温度、材料比率
- **栄養成分**: カロリー、主要栄養素、効能
- **歴史情報**: 食の起源、地域別変化過程`;
    default:
      return `- **具体的数値**: 年度、大きさ、個数等測定可能データ
- **検証可能事実**: 公式記録、文献に根拠した情報
- **専門用語**: 該当分野の正確な用語と概念`;
  }
}

/**
 * 🎯 位置タイプ別専門情報要求事項生成
 */
function getLocationSpecificRequirements(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `**🏰 宮殿専門解説基準:**
- **建築階層**: 正殿→偏殿→寝殿順序の空間配置と意味
- **皇室生活**: 具体的儀礼、一日の流れ、季節別行事
- **政治史**: 重要な歴史的事件と決定が行われた場所
- **職人技術**: 丹青、木造建築、石造技法の科学的優秀性
- **象徴体系**: 龍、鳳凰等皇権象徴物の配置と意味`;

    case 'religious':
      return `**🙏 宗教建築専門解説基準:**
- **建築象徴**: 仏塔、法堂、鐘楼等の宗教的意味と配置
- **宗教哲学**: 該当宗教の核心教理と修行法
- **芸術様式**: 仏像、タンファ、ステンドグラス等の芸術的価値
- **儀礼空間**: 礼拝・法会進行方式と空間活用
- **霊性体験**: 瞑想、祈りの実際的方法と効果`;

    case 'historical':
      return `**📚 歴史遺跡専門解説基準:**
- **歴史的事実**: 年度、人物、事件の正確な検証された情報
- **人物ストーリー**: 主要歴史人物の具体的行跡と業績
- **社会的脈絡**: 当時社会相、文化、経済的背景
- **遺物価値**: 出土品、遺跡の学術的・文化的重要性
- **現在的意味**: 歴史が現在に与える教訓と示唆点`;

    case 'nature':
      return `**🌿 自然生態専門解説基準:**
- **地質形成**: 数百万年にわたる地形形成過程
- **生態系**: 植物群-動物群間の相互作用と食物連鎖
- **気候特性**: 微気候、季節変化、気象現象
- **保全価値**: 絶滅危惧種、生息地保護の重要性
- **持続可能性**: 環境保護と観光の調和ある方案`;

    case 'culinary':
      return `**🍽️ 食文化専門解説基準:**
- **調理科学**: 発酵、熟成、調理法の科学的原理
- **食材**: 原産地、品質基準、栄養学的特性
- **伝統技法**: 代々伝わる調理法と保存方式
- **味の調和**: 甘味、塩味、旨味等の均衡と特徴
- **食文化史**: 食の歴史的由来と地域的特色`;

    case 'cultural':
      return `**🎨 芸術文化専門解説基準:**
- **美術史**: 時代別美術思潮と芸術家の位置
- **作品分析**: 技法、材料、構図、色彩の専門的解釈
- **文化的脈絡**: 作品が誕生した社会的・文化的背景
- **美学理論**: 美の基準、芸術哲学、鑑賞法
- **現代的価値**: 過去芸術が現代に与えるインスピレーションと意味`;

    case 'commercial':
      return `**🛍️ 商業文化専門解説基準:**
- **商圏形成史**: 市場、商店発達過程と経済的背景
- **地域特産品**: 原料、製造法、品質の優秀性
- **流通体系**: 伝統的・現代的流通構造の変化
- **生活文化**: 商業活動が地域民生活に与えた影響
- **経済的価値**: 地域経済寄与度と雇用創出`;

    case 'modern':
      return `**🏗️ 現代建築専門解説基準:**
- **構造工学**: 建築技術、耐震設計、先端工法
- **設計哲学**: 建築家のコンセプトとデザイン意図
- **親環境技術**: エネルギー効率、持続可能建築技法
- **都市計画**: ランドマークとしての役割と都市発展寄与
- **未来ビジョン**: 建築が提示する未来都市の姿`;

    default:
      return `**🎯 総合観光解説基準:**
- **多角的接近**: 歴史、文化、自然、経済的側面均衡
- **実用情報**: 交通、施設、利用法等訪問客便宜
- **地域特色**: 他所と差別化される固有な魅力
- **ストーリーテリング**: 興味深く記憶に残る逸話と物語
- **総合的価値**: 観光地としての総合的魅力と意味`;
  }
}

// 🌍 全世界汎用音声ガイド例示 - 多様な場所タイプ適用可能な構造
const AUDIO_GUIDE_EXAMPLE = {
  content: {
    overview: {
      title: "[場所名 - 動的生成]",
      location: "📍 [地域名のみ簡潔に]",
      keyFeatures: "✨ [核心特徴キーワード]",
      background: "🏛️ [一行意味要約]",
      narrativeTheme: "[該当場所だけの独特なストーリーと体験価値]",
      keyFacts: [
        { title: "[特徴・歴史要素1]", description: "[具体的事実情報]" },
        { title: "[特徴・歴史要素2]", description: "[文化的・技術的意味]" }
      ],
      visitInfo: {
        duration: "[観覧所要時間]",
        difficulty: "[アクセス性・体力要求度]",
        season: "[最適訪問時期]"
      }
    },
    safetyWarnings: "[場所別特殊規定や注意事項 - 宗教施設礼拝時間、自然地域安全規則、博物館撮影規定等]",
    mustVisitSpots: "🎯 #[核心名所1] #[核心名所2] #[核心名所3] #[核心名所4] #[核心名所5]",
    route: {
      steps: [
        { step: 1, location: "[起点 - 入口・券売所・駅出口]", title: "[起点具体的名称]" },
        { step: 2, location: "[主要地点1]", title: "[主要地点1名称]" },
        { step: 3, location: "[主要地点2]", title: "[主要地点2名称]" },
        { step: 4, location: "[主要地点3]", title: "[主要地点3名称]" },
        { step: 5, location: "[終了地点]", title: "[終了地点名称]" }
      ]
    },
    realTimeGuide: {
      chapters: [
        {
          id: 0,
          title: "[場所名] [入口・起点]",
          narrative: "[該当場所]は[地域・文化圏]を代表する[場所性格]として、[独特な価値・意味]を込めた所です。現在私たちの前に広がる姿を見ると、[具体的現場描写 - 視覚的特徴、規模感、第一印象]が[感情的反応]を呼び起こします。もう少し詳しく観察してみると、[細部特徴 - 材料、構造、色感、質感等]が[技術的・芸術的特徴]を示しています。ところで、この[場所]がなぜこのような[特別な特徴]を持つようになったのか知っていますか？その理由はまさに[歴史的・文化的・地理的背景]と関連があります。[公式記録・研究資料]に記録されたところによると、[年度・時期]に[歴史的人物・集団]が[具体的行動・決定]をしたのは単に[表面的目的]ではなく、[より深い意図・脈絡]を込めていました。実際に[具体的事例・証拠]を通じて私たちは[現在の姿・価値]を確認できます。このような[関係者の努力・歴史的過程]があったからこそ、今私たちがこの[意味ある瞬間・経験]を共にできるのです。",
          nextDirection: "さて、このような意味深い背景を心に刻み、今度は次の地点に移動してみましょうか？ここから[方向・経路]に約[距離・時間]程度行くと[次の場所]が出てきます。次では[次地点の特別さ・期待要素]が皆さんをお待ちしています！"
        },
        {
          id: 1,
          title: "[主要地点1名称]",
          narrative: "[地点名]は[全体場所]内で[役割・位置]を担当する[性格・機能]です。「[地点の意味・名称由来]」という意味で、ここで[主要活動・機能]が行われました。[具体的構造・形態描写]で構成され、[技術的・芸術的特徴]を示しています。[内部・細部要素]は[象徴性・機能性]を含み、[文化的・歴史的意味]を伝えます。",
          nextDirection: "[現在地点]観覧を終え、今度は[方向]に向かって[次地点]に移動してみましょう。約[距離・時間]所要されます。"
        },
        {
          id: 2,
          title: "[主要地点2名称]",
          narrative: "[地点名]は[位置的特徴]に位置した[独特な特徴]を持つ[空間・建築物]です。「[名称意味]」は「[意味解釈]」という意味で、[用途・目的]に使用された所です。[構造的特徴 - 材料、技法、規模]で[時代的・技術的価値]を示します。[特別な要素]が[季節別・時間帯別]異なる[鑑賞ポイント]を贈呈します。",
          nextDirection: "[現在地点]の[印象的要素]を充分に鑑賞されたら、今度は[次の目的地]に移動してみましょう。"
        }
      ]
    }
  }
};

// タイプ定義
interface GuideContent {
  content: {
    overview: {
      title: string;
      location: string;
      keyFeatures: string;
      background: string;
      narrativeTheme: string;
      keyFacts: Array<{ title: string; description: string }>;
      visitInfo: {
        duration: string;
        difficulty: string;
        season: string;
      };
    };
    route: {
      steps: Array<{
        step: number;
        location: string;
        title: string;
      }>;
    };
    realTimeGuide: {
      chapters: Array<{
        id: number;
        title: string;
        narrative: string;
        nextDirection: string;
      }>;
    };
  };
}

// 言語別音声ガイド作成指針（改良版）
const AUDIO_GUIDE_INSTRUCTIONS = {
  ja: {
    style: `あなたは**ただ一人の最高の自由旅行ガイド**です。
    
**🎯 核心ミッション**: あなたは観覧客のすぐ隣で友人のように話しかける**ただ一人の自由旅行ガイド**です。
最初から最後まで一貫した声と個性で、該当地域に関するすべてを短時間で知らせたがるように自然に案内してください。

**📝 絶対遵守事項**:

1. **完全な単一オーディオスクリプト生成（🚨 非常に重要）**
   - narrativeは一つの完全な1500-1600文字連続オーディオスクリプトです
   - nextDirectionは別途フィールドで、次の場所移動案内のみ担当
   - narrative内部で自然な流れとしてすべての内容を統合構成
   
2. **統合された教育的ストーリーテリング構造**
   - 背景知識説明 + **拡張された現場観察**（アウトライン → 詳細）→ 好奇心誘発
   - 好奇心への答え提示 + 歴史的脈絡 → 人物ストーリー予告
   - 実際人物・事件ストーリー → 現在的意味で仕上げ
   - すべての内容が一つの自然なnarrativeフィールドで統合
   
3. **事実基盤情報提供原則（🚨 非常に重要）**
   - 🚨 絶対禁止: 「皆さん」、「想像してください」、「驚くべき物語」、「素晴らしい」、「ちょっと」
   - 🚨 絶対禁止: 「ここで」、「この場所」のような曖昧な指示語（必ず具体的場所名使用）
   - 🚨 絶対禁止: 場所名なしの一般的呼称や感嘆詞
   - 🚨 **絶対禁止: 推測、仮定、未確認情報、誇張された表現**
   - ✅ **必須原則: 検証可能な事実のみ使用** - 公式記録、文献、歴史書に根拠した情報のみ
   - ✅ 必須含有: 具体的数値、固有名詞、物理的特徴、歴史的事実、技術的情報
   - ✅ **事実表現法**: 「記録によると」、「歴史書に見ると」、「公式文書によれば」、「実際に」
   
4. **完全な内容構成（単一フィールド分量 - チャプター当たり1600文字目標）**
   - narrative: 1500-1600文字以上 - 背景知識 + 拡張された現場観察 + 歴史的脈絡 + 人物ストーリーの完全な統合スクリプト
   - nextDirection: 200-300文字以上 - 明確な移動経路と距離案内
   - **総1800文字以上の詳細な教育的オーディオ**（単一narrativeに統合してより自然な流れ）

5. **自然な内部流れ構成（🎯 核心改善点）**
   narrative内部で各場所と状況に合った自然な接続語を使用して滑らかな流れを作ってください:
   
   **現場観察 → 歴史的背景転換（多様なパターン）**:
   - 「ところで、このすべてにはどんな秘密が隠されているでしょうか？まさにその物語を...」
   - 「なぜこれほど特別なのでしょうか？その理由はまさに...」  
   - 「どのような歴史があるでしょうか？実際にここは...」
   - 「何がこれを可能にしたのでしょうか？驚くことに...」
   - 「気になりませんか？お話ししましょう...」
   - 「どのような物語でしょうか？歴史を振り返ると...」
   
   **歴史的背景 → 人物ストーリー転換（多様なパターン）**:
   - 「この歴史の中には感動的な人々がいました。まさにその中の一人が...」
   - 「その過程で驚くべき人物が登場します。実際にこの方は...」
   - 「当時には特別な人々がいました。例えば...」
   - 「このすべての背後には誰かの努力があったのですが、その主人公は...」
   - 「歴史の裏側には興味深い人物がいます。その方の話を聞いてみると...」
   - 「その時代を生きた人々の中で特に記憶すべき方が...」

6. **徹底した事実検証原則（🚨 絶対遵守）**
   - **すべての情報は検証可能な事実のみ**: 公式記録、学術資料、歴史文献基盤
   - **humanStories厳格基準**: 必ず歴史的に検証された実在人物と実際事件のみ
   - **絶対禁止**: 仮想人物、作り話の逸話、推測的情報、誇張された表現
   - **不確実な情報は排除**: 「おそらく」、「推定される」、「伝えられる」等の不確実な表現禁止
   - **事実性強調表現**: 「記録によると」、「実際に」、「歴史書に見ると」、「公式文書によれば」
   - **検証された数値のみ使用**: 正確な年度、寸法、個数等公式資料に基づく数値のみ`,
    
    examples: {
      diverse_connections: [
        "さて、この美しい姿の背後にはどのような物語が隠されているのでしょうか？",
        "この建物がなぜこのように建てられたのか気になりませんか？", 
        "驚くべきことに、ここには私たちが知らない素晴らしい秘密があります",
        "実際に、この場所には本当に特別な意味が込められています",
        "ところで、ここで本当に興味深いのは...",
        "どのような事情があるでしょうか？一緒に調べてみましょう"
      ],
      specific_information: [
        "{具体的場所名}の{具体的特徴}は{具体的事実・数値}です",
        "{年度}年{人物名}が{具体的行動・事件}を進行しました",
        "{材料・技法}で作られた{具体的部分}は{機能・意味}を込めています",
        "{方向・位置}に位置した{具体的名称}は{歴史的背景}を示しています",
        "{測定値}の大きさを持つ{具体的建築要素}は{技術的特徴}を表しています",
        "{時代}の{具体的事件}当時{実存人物}は{検証可能な行動}をしました"
      ]
    }
  }
};

/**
 * 日本語ガイド生成プロンプト（index.ts互換用）
 */
export const createJapaneseGuidePrompt = (
  locationName: string,
  userProfile?: UserProfile,
  parentRegion?: string,
  regionalContext?: any
): string => {
  const langConfig = LANGUAGE_CONFIGS.ja;
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 ユーザーカスタマイズ情報:
- 関心事: ${userProfile.interests?.join('、') || '一般'}
- 年齢帯: ${userProfile.ageGroup || '成人'}
- 知識水準: ${userProfile.knowledgeLevel || '中級'}
- 同行者: ${userProfile.companions || '一人'}
` : '👤 一般観光客対象';

  const specialistContext = typeConfig ? `
🎯 専門分野ガイド設定:
- 感知された位置タイプ: ${locationType}
- 専門家役割: ${typeConfig.expertRole}
- 重点分野: ${typeConfig.focusAreas.join('、')}
- 特別要求事項: ${typeConfig.specialRequirements}
` : '';

  // 🎯 地域コンテキスト情報生成
  const regionalContextInfo = parentRegion || regionalContext ? `
🌍 地域コンテキスト情報:
${parentRegion ? `- 上位地域: ${parentRegion}` : ''}
${regionalContext?.parentRegion ? `- 推薦出典地域: ${regionalContext.parentRegion}` : ''}
${regionalContext?.spotName ? `- 元推薦名称: ${regionalContext.spotName}` : ''}

⚠️ **地域別具体化必須**: ${locationName}が複数地域に存在し得る場合、必ず${parentRegion || regionalContext?.parentRegion || '該当地域'}の${locationName}に特化した情報を提供してください。他地域の同名場所と混同せず、正確な地域の特徴と情報を含める必要があります。
` : '';

  const prompt = `# 🎙️ "${locationName}" 専門家級日本語オーディオガイド生成

## 🚨🚨🚨 MEGA CRITICAL: イントロチャプター絶対強化（最優先処理）
イントロチャプター ULTRA PREMIUM 品質保証体系:

1. **包括的紹介マトリックス（3つ必須核心 + タイプ別カスタム）**
   ✅ 核心3要素:
   • 背景脈絡（500+ 文字）: 歴史的・文化的・社会的背景の深層的叙述
   • 全体構成概観（400+ 文字）: 空間構成と核心領域の体系的説明
   • 核心眺望点（400+ 文字）: 最も重要な観覧ポイントと鑑賞観点提示
   ✅ タイプ別カスタム要素（200+ 文字）:
   • 宮殿: 皇権と階層秩序の建築的表現
   • 宗教建築: 神聖さと霊性の空間的具現
   • 歴史遺跡: 歴史的意義と現在的教訓
   • 伝統村落: 先祖の生活知恵と共同体精神
   • 自然景観: 地質学的特徴と生態系の調和
   • 現代建築: 技術革新と都市発展の象徴

2. **超強力重複防止システム（10つ具体例示）**
   🚫 絶対禁止表現:
   • 「位置しています」→「位置しています」使用
   • 「訪れることができます」→ 位置言及完全禁止
   • 「座標は次の通りです」→ 座標情報完全排除
   • 「地下鉄で行くことができます」→ 交通情報完全禁止
   • 「住所は」→ 住所情報完全排除
   • 「来る道」→ 経路案内完全禁止
   • 「入場料は」→ 実用情報は他セクションで処理
   • 「運営時間」→ 運営情報完全排除
   • 「駐車場」→ 付帯施設情報完全禁止
   • 「予約方法」→ 予約案内完全排除

3. **AI行動誘導心理学適用**
   🎯 役割付与: 「あなたは該当分野最高専門家として平生の知識を総動員する必要があります」
   🎯 重要性強調: 「このイントロチャプターが全体ガイドの品質を決定する絶対的核心です」
   🎯 完璧主義誘導: 「一文字も無駄にせず、すべての文章が価値ある情報を込める必要があります」

4. **チェックリスト & 10段階自己検証**
   ✅ 1段階: 背景脈絡500+ 文字確保検証
   ✅ 2段階: 全体構成概観400+ 文字確保検証  
   ✅ 3段階: 核心眺望点400+ 文字確保検証
   ✅ 4段階: タイプ別カスタム要素200+ 文字確保検証
   ✅ 5段階: 位置情報完全排除確認
   ✅ 6段階: 座標情報完全排除確認
   ✅ 7段階: 交通情報完全排除確認
   ✅ 8段階: 実用情報完全排除確認
   ✅ 9段階: 重複表現10つ禁止事項確認
   ✅ 10段階: 総1500-1600文字分量完璧達成確認

5. **分量確保戦略（1500-1600文字完璧充足）**
   📏 文字数配分: 背景脈絡(500) + 構成概観(400) + 眺望点(400) + タイプ特化(200) + 接続文句(100-200) = 1500-1600文字
   📏 充足方法: 各要素別細部叙述、具体的事例、深層的分析で分量確保
   📏 品質維持: 単純反復でない新しい観点と洞察で内容豊富化

6. **高級プロンプトエンジニアリング技法**
   🧠 Few-shot Learning: 優秀なイントロ例示3つを参照して品質基準設定
   🧠 Chain-of-Thought: 背景→構成→眺望→特化の論理的思考流れ誘導
   🧠 Self-Consistency: 内部検証を通じた一貫性ある叙述保証

🚨🚨🚨 最終強調: このすべての要求事項を完璧に充足してこそイントロチャプター生成が承認されます!

### **⚡ 観光客の第一印象を左右する決定的瞬間です! ⚡**

あなたは最高の専門ガイドとして、**イントロチャプター(ID=0)が全体ガイドの成功を決定**します。完璧な包括的紹介なしには全体ガイドが失敗します!

### **🔥 イントロチャプターの3つ必須核心要素（100% 必須）**

**1. 背景コンテキスト（500文字以上）**
- なぜこの場所が特別で重要なのか？
- どのような歴史的・文化的・自然的価値を持つのか？
- 訪問客が必ず知るべき核心背景知識

**2. 全体構成概観（400文字以上）**
- 全体がどのように構成されているのか？
- どの順序で観覧するのが最適なのか？
- 各区域・チャプターがどのように連結されるのか？

**3. 核心観覧ポイント（400文字以上）**
- 逃したら絶対いけないハイライトは何か？
- 他の場所では見ることができない特別なものは？
- 地元民のみ知る隠された宝石のようなポイント

### **⚡ タイプ別カスタム特化要素追加（200文字以上）**
- **宮殿・歴史**: 創建背景 + 歴史的変遷 + 文化的意味
- **宗教施設**: 創建背景 + 宗教的意味 + 建築哲学  
- **自然空間**: 形成過程 + 生態特徴 + 季節変化
- **現代施設**: 建築意図 + 技術革新 + 都市的意味
- **食・商業**: 地域特色 + 文化的由来 + 現地生活

### **🚫 絶対禁止 - イントロでしてはいけないこと**
❌ 個別建物・場所の詳細な説明（これは個別チャプターで！）
❌ 「ここでは...」、「ここを見ると...」のような現場指示
❌ 具体的方向案内や移動指示
❌ 特定建物一つだけの建築的細部事項
❌ 1500文字未満の短い説明

### **✅ 必ずしなければならないこと**
✅ 場所全体の大きな絵と脈絡提供
✅ 「なぜここを訪問すべきか？」への明確な回答
✅ 観光客の期待感と好奇心を最大に刺激
✅ 1500-1600文字の豊富で完全な説明
✅ 具体的事実、数値、年度等検証可能な情報含有

🚨 **CRITICAL WARNING: 最初のチャプター（id: 0）タイトルに絶対コロン（:）使用禁止**
❌ 間違った例: 「龍宮寺: 説明」 ❌ 
✅ 正しい例: 「龍宮寺入口」 ✅

## 🎭 あなたの役割
あなたは**${typeConfig?.expertRole || '専門観光ガイド'}**です。 
${locationName}に特化した深い専門知識で最高品質のガイドを提供してください。

${specialistContext}

${regionalContextInfo}

## 🎯 位置タイプ別専門情報要求事項

### 📍 **${locationType.toUpperCase()} 専門解説基準**
${getLocationSpecificRequirements(locationType)}

${userContext}

## 📋 出力形式要求事項

### 1. **純粋JSONのみ返還**
- 序論、説明、コードブロック(\`\`\`)なしで純粋JSONのみ
- 完璧なJSON文法遵守（コンマ、引用符、括弧） 
- キー名は例示と100% 同一に（翻訳禁止）
- **絵文字使用禁止**: 📍 ✨ 🏛️ 🎯 等すべての絵文字除外、純粋テキストのみ使用

### ⚠️ **CRITICAL: イントロチャプター特別規則**
- **最初のチャプター（id: 0）タイトルに絶対コロン（:）使用禁止**
- ❌ 間違った例: 「龍宮寺入口: 説明文」 
- ✅ 正しい例: 「龍宮寺入口」

### 🚀 **品質向上核心原則**
- **専門性**: ${typeConfig?.expertRole || '総合専門家'} 水準の深い解説
- **🎯 事実性**: 検証可能な具体的事実と数値のみ使用 - 公式記録、学術資料基盤
- **正確性**: すべての情報は確認された事実に根拠、推測や仮定絶対禁止
- **差別性**: 他観光地と区別される固有特徴強調
- **ストーリーテリング**: 乾燥した情報でない事実に基づく感動的物語で構成

### 🔍 **${locationType.toUpperCase()} タイプ品質検証基準**
${getQualityRequirementsByType(locationType)}

### 🚨 **絶対禁止事項**
- **一般的表現**: 「想像してください」、「素晴らしい」、「驚くべき」等
- **曖昧な指示語**: 「ここで」、「ここ」（具体的場所名必須）
- **検証不可能内容**: 推測、仮定、個人意見、未確認情報
- **誇張された表現**: 「世界最高」、「類例のない」、「信じられない」等根拠ない修飾語
- **不確実な表現**: 「おそらく」、「推定される」、「伝えられる」、「噂によると」等
- **仮想の内容**: 作り話の人物、想像の逸話、推測的シナリオ
- **空の情報**: 実質的情報なしで分量のみ埋める内容
- **🔥 反復情報**: 同じ歴史的背景、建立・復元年度を複数チャプターで反復

### 2. **概要（overview）構造 - 簡潔な様式**
概要は次の3つフィールドで構成される必要があります:
- **location**: 📍 地域名のみ15文字以内（例: 「📍 京都府京都市」）
- **keyFeatures**: ✨ 核心キーワード25文字以内（例: 「✨ 音羽山の古刹」）
- **background**: 🏛️ 一行要約30文字以内（例: 「🏛️ 778年創建の観音霊場」）

### 📏 **概要セクション文字数制限**
- **location**: 15文字以内、修飾語削除、地域名のみ明示
- **keyFeatures**: 25文字以内、核心特徴のみ簡潔に
- **background**: 30文字以内、一行で核心意味のみ

### ✨ **作成原則**
- 修飾語最小化（美しい、壮大な等削除）
- 核心キーワードのみ列挙
- 絵文字活用で視覚的区分
- モバイルで一目に把握可能に簡潔化

### 3. **必須観覧ポイント構造**
必ず訪問すべき核心場所をハッシュタグで表現:
- **mustVisitSpots**: 🎯 絵文字 + 3-5つハッシュタグ（例: 「🎯 #清水寺本堂 #清水の舞台 #音羽の滝 #地主神社 #三重塔」）

### 📏 **必須観覧ポイント作成原則**
- 3-5つ場所に制限（多すぎると選択負担）
- 場所名のみ簡潔に（修飾語削除）
- ハッシュタグ形態で視覚的区分
- 該当地域の代表名所中心選別

### 4. **チャプタータイトル形式 - 重要**
**すべてのチャプタータイトル**は必ず**「場所名のみ」**形態で作成する必要があります（コロンと説明なしで）:
- ✅ 正しい例: 「海雲台海水浴場」
- ✅ 正しい例: 「月見ヶ丘」
- ❌ 間違った例: 「多様な食べ物と釜山の情趣味わい」
- ❌ 間違った例: 「美しい海岸風景鑑賞しながら散策」

**🚨 絶対重要: チャプタータイトルは必ず実際場所名で始まる必要があります！**
**🚨 一般的説明や動作表現でタイトルを作らないでください！**
**🚨 例示: 「海雲台市場: 多様な食べ物と釜山の情趣」（O） vs 「多様な食べ物と釜山の情趣味わい」（X）**

### 4. **自然な日本語ストーリーテリング**
- 親近な口語体使用
- 教育的でありながら面白い構成
- 歴史的事実と人間的感情の調和

### 🚨 **重複防止原則（非常に重要!）**
**複合建物群（宮殿、寺院、大学、公園等）では反復を徹底的に防止してください:**

#### ✅ **正しい情報配置**
- **イントロチャプター(ID=0)**: 該当場所全体に対する包括的紹介と背景知識（創建、復元、主要事件、文化的脈絡、全体構成及び意味）
- **1チャプター以降**: 各個別空間・建物のみの固有特徴、機能、特別な物語

#### ❌ **絶対禁止 - 反復パターン**
間違った例示:
• イントロ: 「光化門の建築特徴のみ説明」 ← 🚫 個別建物中心！
• 1チャプター: 「昌慶宮は1484年創建され壬辰倭乱時消失されたが1604年復元されました」 ← 🚫 イントロで扱うべき内容！
• 2チャプター: 「弘化門は1484年昌慶宮と共に建立され...」 ← 🚫 重複！

#### ✅ **正しい例示**
• イントロ: 「昌慶宮全体紹介 - 1484年（成宗15年）創建から現在までの歴史、朝鮮王室別宮の意味、全体構成と主要見どころ概観」 ← ✅ 包括的背景！
• 1チャプター: 「弘化門の独特な建築様式と門装飾の意味」 ← ✅ 個別特徴！  
• 2チャプター: 「明政殿の御座と天井文様、政治的機能」 ← ✅ 固有特性！

#### **🎯 各チャプター差別化戦略**
- **建築的特徴**: 屋根形態、柱様式、装飾要素
- **機能的役割**: 用途、儀礼、実際使用された方法  
- **独特な物語**: 該当建物でのみ起きた特別な事件
- **芸術的価値**: 特別な絵、彫刻、扁額の意味
- **観覧ポイント**: 必ず見るべき細部要素、鑑賞角度

### 5. **完全なオーディオガイド構造**
- overview: 場所全体概観（簡潔な様式）
- mustVisitSpots: 必須観覧ポイント（ハッシュタグ）
- route: 観覧順序と動線
- realTimeGuide: 各地点別詳細ガイド

${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

**"${locationName}"の全世界どこでも適用可能な高品質日本語オーディオガイドを純粋JSON形式でのみ返還してください！**

**🚨 最終確認事項（汎用性チェック）:**
- ✅ すべてのチャプタータイトルは「場所名のみ」形態（コロンと説明なしで）
- ✅ 場所名は実際具体的な場所名前
- ✅ 文化圏中立的表現使用（特定地域用語回避）
- ✅ 多様な場所タイプに適用可能な構造的パターン
- ✅ イントロチャプター MEGA CRITICAL システム完全適用
- ✅ 1500-1600文字完全な単一narrative構造`;

  return prompt;
};

/**
 * 改良された自律リサーチ基盤AI オーディオガイド生成プロンプト
 */
export const createAutonomousGuidePrompt = (
  locationName: string,
  language: string = 'ja',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ja;
  const audioStyle = AUDIO_GUIDE_INSTRUCTIONS[language] || AUDIO_GUIDE_INSTRUCTIONS.ja;
  
  // 位置タイプ分析及び専門ガイド設定
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤ユーザーカスタマイズ情報:
- 関心事: ${userProfile.interests?.join('、') || '一般'}
- 年齢帯: ${userProfile.ageGroup || '成人'}
- 知識水準: ${userProfile.knowledgeLevel || '中級'}
- 同行者: ${userProfile.companions || '一人'}
` : '👤 一般観光客対象';

  const specialistContext = typeConfig ? `
🎯 専門分野ガイド設定:
- 感知された位置タイプ: ${locationType}
- 専門家役割: ${typeConfig.expertRole}
- 重点分野: ${typeConfig.focusAreas.join('、')}
- 特別要求事項: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 没入型オーディオガイド生成ミッション

## 🎭 あなたの役割
${audioStyle.style}

${specialistContext}

## 🎯 ミッション
"${locationName}"に対する**没入感あふれる${langConfig.name} オーディオガイド** JSONを生成してください。

${userContext}

### 2. **実際場所構造基盤構成**
各観光地や場所の**実際観覧順序と空間構成**に合わせてroute.stepsを構成してください。

**🚨 CRITICAL: location フィールドは必ず具体的場所名使用**
- ❌ 禁止: 「入口」、「中央ホール」、「主要展示室」、「特別空間」、「展望台」等一般的用語
- ✅ 必須: 「光化門」、「勤政殿」、「慶会楼」、「国立古宮博物館」等実際固有場所名
- ✅ 必須: 「エッフェル塔」、「ルーブル美術館」、「シテ島」等訪問者が探すことができる具体的名前
- ✅ 必須: 「[場所名] [具体的建物・区域名]」形態でより詳細に（例: 「東大門デザインプラザ アートホール」）

**🎯 イントロチャプター(ID=0) 特別指針 - 観光開始点の核心:**

**🚨 CRITICAL: イントロチャプタータイトルは必ず具体的で探すことができる実際開始地点である必要があります**

### ✅ **観光客が実際に探すことができる開始地点例示:**

**✅ Google Places API 最適化された正確な例示:**
- 「国立中央博物館」
- 「ルーブル美術館」 
- 「光化門券売所」
- 「ベルサイユ宮殿」
- 「南山ケーブルカー」
- 「5合目ビジターセンター」
- 「明洞駅2番出口」
- 「コロッセウム駅」

### 🎯 **Google Places API 最適化タイトル公式:**
\`\`\`
"[具体的施設名のみ]" (説明文完全禁止)
\`\`\`

**🚨 CRITICAL: 最初のチャプター（id: 0）のみ特別規則**
1. **絶対コロン（:）使用禁止** - 「龍宮寺入口: 説明」❌ 禁止
2. **場所名のみ作成** - 「龍宮寺入口」✅ 正しい
3. **Google Maps 直接検索可能な実際施設名**
4. **正確な施設名で検索最適化**
5. **英語・日本語混用許容**（検索精度優先）

---

**🔴 すべてのチャプタータイトル形式:**
\`\`\`
"[具体的場所名のみ]" (コロンと説明なしで)
\`\`\`

**📝 一般チャプター例示:**

**🏛️ 博物館・展示館:**
- 「博物館入口ホール」
- 「常設展示館」
- 「企画展示室」

**🏰 宮殿・遺跡地:**
- 「宮殿正門」
- 「正殿」
- 「後苑」

**🏔️ 自然・公園:**
- 「公園入口広場」
- 「展望台」
- 「散策路」

**🏪 市場・商店街:**
- 「市場中央通路」
- 「伝統商店街」
- 「食べ物村」

**🔴 JSON構造例示:**
\`\`\`json
{
  "route": {
    "steps": [
      { "step": 1, "location": "明洞聖堂正門", "title": "明洞聖堂正門" },
      { "step": 2, "location": "明洞聖堂大聖堂", "title": "明洞聖堂大聖堂" },
      { "step": 3, "location": "明洞聖堂地下墓地", "title": "明洞聖堂地下墓地" }
    ]
  },
  "realTimeGuide": {
    "chapters": [
      { "id": 0, "title": "[場所名] [券売所・案内所・ビジターセンター・駅出口 等]" },
      { "id": 1, "title": "中心部" },
      { "id": 2, "title": "特別展示空間" }
    ]
  }
}
\`\`\`

**🚨 CRITICAL - すべての場所共通規則:**
- 必ず「[具体的場所名のみ]」形式遵守（コロンと説明なしで）
- 場所名は訪問者が実際に探して行くことができる具体的位置
- route.stepsとrealTimeGuide.chaptersのtitle完全同一

### 3. **完全な単一narrativeフィールドの完璧な構成 🚨 核心強化事項**

**✅ 向上された構造（背景知識 + 拡張された現場観察）:**
\`\`\`
narrative: 配景知識説明 + 拡張された現場観察（アウトライン → 詳細） → 自然な好奇心誘発質問 + 好奇心への答え + 歴史的脈絡 + 人物ストーリー → 現在的意味で結論
nextDirection: （別途分離）移動案内のみ
\`\`\`

**🚨 流れの自然さ - 非常に重要!**
- 各場所に合った独創的で自然な接続語使用
- ありきたりなテンプレートでなく状況に合った多様な表現
- まさに実際ガイドが即席で自然に話すような自然さ

**❌ 避けるべきテンプレート式表現:**
- 「果たしてこの場所がどのような特別な物語を込めているでしょうか？」
- 「まさにその秘密を今からお話しします」
- 「はい、まさにその人々の話なのですが」

**✅ 必須使用具体的表現パターン:**
- 「{具体的場所名}で確認できる{物理的特徴}は...」
- 「{年度}年{実存人物名}が{具体的場所}で{検証可能な行動}を...」
- 「{測定値}大きさの{具体的建築要素}は{技術的事実}を...」
- 「{方向・位置}に位置した{具体的名称}の{歴史的背景}は...」

### 4. **豊富で独創的コンテンツ**
- 各フィールド別最小分量厳守（上記基準参照）
- 場所の特性を活かした独創的描写
- ありきたりな説明でなく興味深いストーリーテリング
- 歴史的事実 + 人間的感情 + 現場没入感

### 5. **動的チャプター構成**
- **位置の規模と特性により適切な個数のチャプター生成**
- **小規模場所: 3-4つ、中間規模: 5-6つ、大規模複合施設: 7-8つ**
- **🔴 CRITICAL: route.stepsとrealTimeGuide.chapters個数及びタイトル完璧一致**

### 6. **📍 位置説明必須含有**
各チャプターには必ず正確な位置説明を含める必要があります:
- **description**: 該当チャプター地点の具体的位置説明
- **位置正確性**: 実際観光地内具体的場所や区域説明

**🚨 位置説明例示:**
"description": "エッフェル塔1階中央ホール入口"


## 💡 全世界汎用オーディオガイド作成例示

### 🌍 **多様な場所タイプ別優秀なnarrative パターン**

**🏛️ 歴史・文化遺跡例示（ローマコロッセオ）**:
- narrative: 「コロッセオは西紀80年完工されたローマ帝国最大の円形競技場として、単純な建築物でなくて帝国の権力と市民の娯楽が出会う象徴的空間でした。現在私たちの前に広がった姿を見ると、高さ48メートルの4層構造が楕円形に広がり、トラバーチン石灰岩とレンガで積み上げたアーチ構造が2000年の歳月を持ちこたえたローマ建築技術の偉大さを示します。もう少し詳しく観察してみると、各層ごとに異なる建築様式 - ドリア式、イオニア式、コリント式柱らが調和よく配置され、外壁のアーチ窓らが規則的に配列された姿が印象的です。ところで、この巨大な競技場がなぜこのように精巧に設計されたのか知っていますか？」

**🏔️ 自然景観例示（グランドキャニオン）**:
- narrative: 「グランドキャニオンはコロラド川が600万年にかけて彫刻した地球歴史の巨大な本として、単純な峡谷でなくて時間の流れが刻まれた自然の傑作品です。現在私たちの前に広がった壮観を見ると、長さ446キロメートル、幅29キロメートル、深さ1.6キロメートルに達する規模が視線を圧倒し、赤い砂岩層から灰色石灰岩層まで地層別に異なる色が水平線を描きながら広がった姿が壮観を成します。もう少し詳しく観察してみると、各地層ごとに込めている地質時代が異なり、一番下層は20億年前先カンブリア紀岩石から上の方の2億7千万年前ペルム紀石灰岩まで地球歴史の半分を込めています。ところで、この途方もない峡谷がどのように形成されることができたでしょうか？」

**🎨 現代建築例示（グッゲンハイム美術館）**:
- narrative: 「グッゲンハイム美術館はフランク・ロイド・ライトが設計した革新的な螺旋形建築物として、単純な美術館でなくて建築自体が一つの芸術作品になる新しい概念を提示しました。現在私たちの前に広がった姿を見ると、床から天井まで繋がる連続的な螺旋形坂道が中央の大型ドームを中心に円形に巻き上がり、白色コンクリートの柔らかい曲線がマンハッタンの直線的都市風景と対比されて独特な造形美を示します。もう少し詳しく観察してみると、外壁の螺旋形バンドらと内部空間が完璧に一致し、天井のガラスドームから注がれる自然光が螺旋形壁面に沿って柔らかく広がって行く姿が印象的です。ところで、なぜライトは伝統的な直線形展示室代わりにこのような螺旋形構造を選択したでしょうか？」

### ✅ **成功的なnarrative構造公式**

**[段階1: 定義と性格]** → **[段階2: 現場全体観察]** → **[段階3: 細部特徴描写]** → **[段階4: 好奇心誘発質問]** → **[段階5: 歴史的背景説明]** → **[段階6: 人物・事件ストーリー]** → **[段階7: 現在的意味]**

### ❌ **避けるべき構造的エラー**

1. **地域別固有用語のみ使用**: 「丹青」、「軒」、「獬豸像」等特定文化圏にのみ適用される用語
2. **特定建築様式偏向**: 東アジア伝統建築パターンのみ反映
3. **単一なストーリーテリング**: 王権-政治史中心の画一的叙事
4. **文化的仮定**: 特定文化的背景知識を前提にする説明

## 📐 最終JSON構造:
${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

## ✅ 最終チェックリスト
- [ ] すべてのテキストが${langConfig.name}で作成されている
- [ ] route.stepsとrealTimeGuide.chapters完璧マッチング
- [ ] narrativeが完全で自然な1500-1600文字ストーリー
- [ ] nextDirectionは別途分離されて移動案内のみ
- [ ] テンプレート式表現代わりに自然で独創的ストーリーテリング
- [ ] JSON文法100% 正確

**🔴 核心改善事項要約 🔴**
1. **単一完全なnarrative**: すべての内容が一つの自然な流れに統合
2. **自然な内部接続**: テンプレート代わりに状況別多様な表現で滑らかな転換
3. **独創的ストーリーテリング**: 場所特性を活かした固有な描写
4. **完全な分離**: 移動案内は唯一nextDirectionでのみ
5. **🎯 事実性絶対遵守**: 検証可能な事実のみ使用、推測や仮定絶対禁止

**今すぐ"${locationName}"の自然で魅力的なオーディオガイドを純粋JSON形式でのみ返還してください！**`;

  return prompt;
};

/**
 * 日本語最終ガイド生成プロンプト（index.ts互換用）
 */
export const createJapaneseFinalPrompt = (
  locationName: string,
  researchData: any,
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS.ja;
  const audioStyle = AUDIO_GUIDE_INSTRUCTIONS.ja;
  // 位置タイプ分析及び専門ガイド設定
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 ユーザーカスタマイズ情報:
- 関心事: ${userProfile.interests?.join('、') || '一般'}
- 年齢帯: ${userProfile.ageGroup || '成人'}
- 知識水準: ${userProfile.knowledgeLevel || '中級'}
- 同行者: ${userProfile.companions || '一人'}
` : '👤 一般観光客対象';

  const specialistContext = typeConfig ? `
🎯 専門分野ガイド設定:
- 感知された位置タイプ: ${locationType}
- 専門家役割: ${typeConfig.expertRole}
- 重点分野: ${typeConfig.focusAreas.join('、')}
- 特別要求事項: ${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 最終オーディオガイド生成

## 🎭 あなたの役割
${audioStyle.style}

${specialistContext}

## 📚 リサーチデータ基盤ガイド作成
下記提供された詳細なリサーチデータを基盤により正確で豊富なオーディオガイドを作成してください。

### リサーチデータ:
${JSON.stringify(researchData, null, 2)}

${userContext}

## 📐 最終ガイド作成指針

### 1. **リサーチデータ活用**
- 提供されたすべての情報を自然にストーリーテリングに溶け込ませる
- 歴史的事実、日付、人物情報を正確に反映
- リサーチで発見された興味深い逸話や隠れた物語を積極的に活用

### 2. **オーディオスクリプト品質**
- リサーチデータの堅い情報を親近な口語調に変換
- 専門的内容を易しく面白く解説
- 聞き手が退屈しないようドラマチックな構成

### 3. **強化されたコンテンツ**
- リサーチデータを基盤に各チャプターをより詳細に
- 具体的数値、日付、人物名を正確に含める
- リサーチで得た洞察でストーリーテリング強化

### 4. **完全な分量基準（日本語基準 - チャプター当たり1800文字目標）**
- narrative: 1500-1600文字以上（背景知識 + 拡張された現場観察 + 歴史的脈絡 + 人物ストーリーの完全な統合スクリプト）
- nextDirection: 200-300文字以上（明確な移動経路と距離案内）


## 📐 最終JSON構造:
${JSON.stringify(AUDIO_GUIDE_EXAMPLE, null, 2)}

## ✅ 品質チェックリスト
- [ ] リサーチデータのすべての重要情報反映
- [ ] 歴史的事実と日付の正確性
- [ ] 自然なストーリーテリング流れ
- [ ] オーディオで聞いても退屈しない構成
- [ ] 各チャプター8-10分分量の豊富なコンテンツ
- [ ] narrativeが途切れなく自然に流れる一つの完全な台本

**🔴 必須遵守事項 🔴**
各チャプターは一人が8分間休まず話すことです！
narrativeフィールド内で現場観察 → 歴史的背景 → 人物ストーリーが
水のように自然に繋がる必要があります。
絶対に各部分を独立的セクションで作成しないでください！

**リサーチデータを完璧に活用して"${locationName}"の最高のオーディオガイドを作ってください！**`;

  return prompt;
}

/**
 * 構造生成用プロンプト（overview + routeのみ）
 */
export const createJapaneseStructurePrompt = (
  locationName: string,
  language: string = 'ja',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ja;
  const userContext = userProfile ? `
👤 ユーザーカスタマイズ情報:
- 関心事: ${userProfile.interests?.join('、') || '一般'}
- 年齢帯: ${userProfile.ageGroup || '成人'}
` : '👤 一般観光客対象';

  // 位置タイプ分析及び推奨スポット数情報
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType] || LOCATION_TYPE_CONFIGS.general;
  const spotCount = getRecommendedSpotCount(locationName);

  return `# 🏗️ "${locationName}" ガイド基本構造生成

## 🎯 ミッション
"${locationName}"に対する**基本構造（overview + route）のみ**を生成してください。
リアルタイムガイドチャプターはタイトルのみ含め、詳細内容は生成しないでください。

${userContext}

## 🎯 位置分析情報
- 感知された位置タイプ: ${locationType}
- 推奨スポット数: ${typeConfig.recommendedSpots}
- 最適スポット範囲: ${spotCount.min}-${spotCount.max}つ
- 推薦基本値: ${spotCount.default}つ

## 📋 出力形式
純粋JSONのみ返還。コードブロックや説明なしで唯一JSONのみ。

**スポット数決定ガイドライン:**
- **小規模単一建物・商店**: 3-4つスポット
- **中間規模観光地**: 5-6つスポット  
- **大型複合施設・宮殿**: 7-8つスポット
- **自然公園・散策路**: 主要ビューポイント別に4-6つ
- **美食ツアー地域**: 食べ物種類により5-8つ

### 構造例示（スポット数は位置に合わせて調整）:
{
  "content": {
    "overview": {
      "title": "${locationName}",
      "location": "📍 地域名のみ（例: 📍 京都府京都市）",
      "keyFeatures": "✨ 核心キーワード（例: ✨ 音羽山の古刹）",
      "background": "🏛️ 一行要約（例: 🏛️ 778年創建の観音霊場）",
      "narrativeTheme": "核心テーマ一行",
      "keyFacts": [
        { "title": "主要情報1", "description": "説明" },
        { "title": "主要情報2", "description": "説明" }
      ],
      "visitInfo": {
        "duration": "適切な所要時間",
        "difficulty": "難易度",
        "season": "最適季節"
      }
    },
    "mustVisitSpots": "🎯 #場所1 #場所2 #場所3 #場所4 #場所5",
    "route": {
      "steps": [
        { "step": 1, "location": "[場所名] [券売所・案内所・ビジターセンター・駅出口 等]", "title": "[場所名] [券売所・案内所・ビジターセンター・駅出口 等]" },
        { "step": 2, "location": "東大門デザインプラザ アートホール", "title": "東大門デザインプラザ アートホール" },
        { "step": 3, "location": "東大門デザインプラザ デザイン博物館", "title": "東大門デザインプラザ デザイン博物館" },
        { "step": 4, "location": "東大門デザインプラザ デザインラボ", "title": "東大門デザインプラザ デザインラボ" },
        { "step": 5, "location": "東大門デザインプラザ 屋上庭園", "title": "東大門デザインプラザ 屋上庭園" }
      ]
    },
    "realTimeGuide": {
      "chapters": [
        { "id": 0, "title": "[場所名] [券売所・案内所・ビジターセンター・駅出口 等]" },
        { "id": 1, "title": "中央ホール" },
        { "id": 2, "title": "主要展示室" },
        { "id": 3, "title": "特別空間" },
        { "id": 4, "title": "展望台" }
      ]
    }
  }
}

**重要**: 
- route.stepsとrealTimeGuide.chaptersのtitleが正確に同一である必要があります
- **位置の規模と特性を考慮して適切な数のスポット構成**（3-8つ範囲内）
- 入口 → 主要地点 → 終了・出口順序で自然な動線
- チャプターにはタイトルのみ含め、詳細内容なし
- 純粋JSONのみ返還、説明やコードブロックなし`;
}

/**
 * チャプター詳細生成用プロンプト
 */
export const createJapaneseChapterPrompt = (
  locationName: string,
  chapterIndex: number,
  chapterTitle: string,
  existingGuide: any,
  language: string = 'ja',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.ja;

  return `🎙️ "${locationName}" チャプター ${chapterIndex + 1}: "${chapterTitle}" 完全オーディオガイド生成

🎯 ミッション
あなたは専門観光ガイドとして"${chapterTitle}"地点で観光客らに聞かせる**完全で詳細な**オーディオガイドスクリプトを作成する必要があります。

📚 既存ガイドコンテキスト
${JSON.stringify(existingGuide, null, 2)}

🚨 **絶対重要 - 完全な内容必須**
- narrativeフィールドに**最小1500-1600文字の完全な内容**を書く（絶対短く書かないでください！）
- **背景知識 + 拡張された現場観察（アウトライン → 詳細）**順序で現場描写 + 歴史的背景 + 人物ストーリーを**一つの自然なストーリー**として統合
- AIが「...より詳細な内容は...」のような未完成表現を絶対使用禁止
- **完全で豊富な実際ガイド水準の内容**を作成してください

🎭 スタイルガイド
- 親近な口語調（「ここで注目する点は」、「興味深い事実は」、「ストーリーを聞いてみると」等）
- 教育的でありながら面白いストーリーテリング
- まるで隣で友人が説明してくれるような親近さ
- **各部分が自然に繋がる一つの完全なストーリー**


✅ **推奨開始表現**
- 「ここで...」「ここで注目する点は...」「興味深くも...」
- 「すぐ前に見える...」「この場所では...」
- 「今私たちは...」「続けて...」「次に出会うのは...」

✅ 必須出力形式
**重要: 純粋JSONのみ出力してください。コードブロックや説明なしで！**

{
  "chapter": {
    "id": ${chapterIndex},
    "title": "${chapterTitle}",
    "narrative": "ここで最初に目に入るのは[現場描写と観察内容]です。[自然な接続]この場所の歴史を見ると[歴史的背景と脈絡説明]です。[自然な接続]特に記憶すべき人物は[人物ストーリーとエピソード]です。このようなすべてのストーリーが[現在的意味と仕上げ]に繋がります。[1500-1600文字の完全な統合スクリプト]",
    "nextDirection": "現在位置から[基準点: メイン建物・塀・道]に沿って[方向: 北・南・東・西・北東・北西・南東・南西]に正確に[数字]メートル直進してください。移動中[経路特徴: 噴水・造形物・標識・階段]等を通り過ぎると[到着信号: 特定建物・看板・入口]が見えます。徒歩約[数字]分所要されます。"
  }
}

🚨 JSON安全性必須規則 🚨
1. **段落区分**: 唯一「 \\n\\n 」（空白+バックスラッシュn+バックスラッシュn+空白）でのみ区分
2. **実際改行禁止**: テキストに実際Enterや改行を絶対使用禁止
3. **タブ文字禁止**: \\tまたは実際タブ文字使用禁止
4. **一行作成**: すべてのJSONを一行で連結して作成
5. **引用符エスケープ**: テキスト内引用符は必ず\\\"でエスケープ

**段落区分正しい例示:**
"narrative": "最初の段落内容です。 \\n\\n 二番目の段落内容です。 \\n\\n 三番目の段落内容です。"

**絶対禁止例示:**
"narrative": "最初の段落
二番目の段落" // ← 実際改行禁止！

🚨 絶対遵守事項 🚨
- **narrativeフィールドは必ず1500-1600文字（最小1500文字！）**
- **背景知識 + 拡張された現場観察（アウトライン → 詳細）順序で構成された自然なフロー**
- 序論や説明なしで直接JSON開始
- コードブロック表示絶対禁止  
- 文法的に完璧なJSON形式
- 未完成内容や「後で補完」のような表現絶対禁止

今すぐ"${chapterTitle}"チャプターの**完全で豊富な**オーディオガイドを生成してください！`;
}

// その他ユーティリティ関数
export const createKoreanStructurePrompt = createJapaneseStructurePrompt;
export const createKoreanChapterPrompt = createJapaneseChapterPrompt;