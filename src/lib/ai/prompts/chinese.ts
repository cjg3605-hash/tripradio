// Chinese Audio Guide Instructions

import { UserProfile } from '@/types/guide';
import { 
  LANGUAGE_CONFIGS, 
  LOCATION_TYPE_CONFIGS, 
  analyzeLocationType,
  getRecommendedSpotCount 
} from './index';

/**
 * 🎯 위치 타입별 품질 요건 생성 시스템（한국 기준 적용）
 */
function getQualityRequirementsByType(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `**🏰 宫殿建筑的事实基准要求:**
- **建筑验证数据**: 柱数、梁结构、屋顶形式、具体建设年代记录
- **历史人物**: 实存君主姓名、在位期间、文献记录的成就
- **建筑技法**: 工程验证的建设技术、材料、设计原理
- **공간 기능**: 각 건물의 실제 용도와 의례적 기능에 대한 문헌 기록
- **복원 과정**: 발굴 증거와 복원 근거, 고증 과정의 학술적 기준`;
    case 'religious':
      return `**🙏 종교건축의 사실기준 요건:**
- **종교적 상징**: 건축 요소의 종교적 의미와 교리적 근거
- **창건 역사**: 정확한 창건 연대, 창건자, 문헌상 기록
- **의례 실천**: 실제 수행되는 예배 방식, 법요 시간, 의식 절차
- **예술 유산**: 불화, 조각, 단청의 제작 시기와 작가, 도상학적 의미
- **수행 전통**: 수행법의 역사적 전래 과정과 종파적 특징`;
    case 'historical':
      return `**📚 역사유적의 사실기준 요건:**
- **고고학적 증거**: 발굴 연대, 출토 유물, 층위학적 분석 결과
- **역사적 인물**: 실존 인물의 문헌 기록, 행적, 검증된 업적
- **사건의 기록**: 정확한 연대, 사료상 근거, 역사적 맥락
- **문화재 지정**: 지정 번호, 지정 사유, 보존 상태, 학술적 가치
- **시대적 배경**: 당시 정치, 경제, 사회적 상황의 역사학적 해석`;
    case 'nature':
      return `**🌿 자연환경의 과학기준 요건:**
- **지질학적 형성**: 지질 연대, 암석 종류, 형성 과정의 과학적 설명
- **생태계 데이터**: 서식 종수, 면적, 고도, 기후대 분류
- **환경 측정값**: 연평균 기온, 강수량, 습도, 미기후 특성
- **보전 가치**: 멸종위기종, 서식지 보호 등급, 생태학적 중요성
- **지리적 특성**: 지형적 특징, 수계, 토양 구성, 자연재해 이력`;
    case 'culinary':
      return `**🍽️ 음식문화의 사실기준 요건:**
- **조리 과학**: 조리법, 발효 과정, 온도, 시간의 과학적 원리
- **영양학적 분석**: 칼로리, 영양소, 건강 효과의 의학적 근거
- **역사적 기원**: 음식의 기원, 전래 과정, 지역적 변화의 문헌 기록
- **재료의 특성**: 원산지, 품질 기준, 계절성, 보관법
- **문화적 의미**: 의례적 사용, 사회적 기능, 지역 정체성과의 관계`;
    default:
      return `**🎯 종합관광지의 사실기준 요건:**
- **구체적 데이터**: 연도, 크기, 수량 등 측정 가능한 정확한 수치
- **검증 가능한 사실**: 공식 기록, 문서화된 정보원에 기반한 정보
- **전문 용어**: 해당 분야의 정확한 용어와 개념 사용
- **역사적 맥락**: 시대적 배경과 의미에 대한 학술적 해석
- **현재적 의미**: 현대적 가치와 의의에 대한 객관적 평가`;
  }
}

/**
 * 🎯 위치 타입별 전문 해설 기준 생성（한국어 품질 기준 적용）
 */
function getLocationSpecificRequirements(locationType: string): string {
  switch (locationType) {
    case 'palace':
      return `**🏰 宫殿建筑专业解说基准:**
- **空间等级**: 正殿→偏殿→寝宫的空间布局与意义，品级制度的出入限制
- **宫廷生活**: 具体的礼仪程序、日常起居、季节性活动的历史记录
- **政治史**: 在此发生的重大历史决策与事件的文献记录
- **建筑工艺**: 斗拱、彩绘、廊檐等传统建筑技术的科学原理
- **象征体系**: 龙、凤等皇家象征的意义与布局原则，权力表现方式`;

    case 'religious':
      return `**🙏 宗교건축 전문해설 기준:**
- **신성한 상징**: 건축 요소의 종교적 의미와 교리적 근거
- **종교 철학**: 핵심 교의, 수행법, 정신적 전통의 역사적 전개
- **예술 유산**: 불화, 조각, 단청의 도상학적 의미와 제작 기법
- **의례 공간**: 예배 실천, 의식 기능, 성스러운 의례의 구체적 절차
- **수행 체험**: 명상법, 기도 방식, 관상적 실천의 전통적 방법론`;

    case 'historical':
      return `**📚 历史遗迹专业解说基准:**
- **历史事实**: 经过验证的年代、事件、人物的史料记录证据
- **人物叙述**: 历史人物的具体成就与行动的文献依据
- **社会背景**: 当时的经济、文化、政治状况的史学分析
- **文物价值**: 考古发现、年代测定、文化财重要性与学术意义
- **현代적 의미**: 역사가 현대에 주는 교훈과 통찰의 해석학적 접근`;

    case 'nature':
      return `**🌿 自然环境专业解说基准:**
- **地质形成**: 数百万年地质过程与岩石形成的科学说明
- **生态系统**: 物种相互作用、食物网、生物多样性的生态学分析
- **气候特征**: 微气候、季节变化、气象模式的气候学数据
- **보전 가치**: 멸종위기종, 서식지 보호 등급, 생태학적 중요성의 과학적 평가
- **可持续性**: 环境保护与负责任旅游实践的具体方案`;

    case 'culinary':
      return `**🍽️ 음식문화 전문해설 기준:**
- **조리 과학**: 발효, 숙성, 조리 기법의 과학적 원리와 화학적 변화
- **식재료 품질**: 원산지, 품질 기준, 영양 특성, 계절성의 객관적 분석
- **전통 기법**: 대대로 전해지는 조리법, 보존 기술, 문화적 실천의 역사적 기록
- **미각 프로필**: 맛의 균형, 지역적 변화, 특징적 성질의 과학적 설명
- **饮食历史**: 起源、演进、文化意义、地域适应的人类学接近`;

    case 'cultural':
      return `**🎨 艺术文化专业解说基准:**
- **美术史**: 艺术运动、时期、艺术家的美术史地位与影响关系
- **作品分析**: 技法、材料、构图、色彩理论、专业解读的美学接近
- **문화적 맥락**: 작품에 영향을 준 사회적, 정치적, 경제적 조건의 역사적 분석
- **미학 이론**: 미의 기준, 예술 철학, 감상 방법의 이론적 토대
- **当代价值**: 历史艺术对现代文化的启发与意义的解释`;

    case 'commercial':
      return `**🛍️ 상업문화 전문해설 기준:**
- **시장 역사**: 상업지구 발전, 경제적 배경, 상업 진화의 역사적 과정
- **지역 특산품**: 원재료, 생산 방법, 품질 기준, 고유한 특징의 구체적 분석
- **유통 시스템**: 전통적·현대적 유통, 공급망 진화의 경제학적 관점
- **공동체 생활**: 상업 활동이 지역 생활 양식에 미치는 사회학적 영향
- **경제적 파급효과**: 지역경제 기여도, 고용, 비즈니스 생태계의 정량적 분석`;

    case 'modern':
      return `**🏗️ 현代건축 전문해설 기준:**
- **구조 공학**: 첨단 건설 기술, 내진 설계, 혁신적 공법의 기술적 원리
- **설계 철학**: 건축가의 컨셉트, 설계 의도, 미학 원리의 건축학적 해석
- **환경 기술**: 에너지 효율, 지속가능 건설, 환경 배려의 공학적 접근
- **도시 계획**: 랜드마크로서의 역할, 도시 발전 기여도의 도시학적 분석
- **미래 비전**: 건축 혁신, 스마트시티 개념, 기술 진보의 미래학적 전망`;

    default:
      return `**🎯 종합관광 전문해설 기준:**
- **다면적 접근**: 역사, 문화, 자연, 경제적 측면의 균형잡힌 통합적 해석
- **실용 정보**: 교통, 시설, 방문자 서비스, 접근성의 구체적 안내
- **지역 특성**: 이 장소를 다른 곳과 구별하는 고유한 매력의 정체성 분석
- **매력적인 서사**: 기억에 남는 일화, 인간적 관심사, 문화적 통찰의 스토리텔링
- **종합적 가치**: 장소의 의의와 매력에 대한 포괄적 이해와 의미 부여`;
  }
}

// Chinese Audio Guide Instructions
export const CHINESE_AUDIO_GUIDE_INSTRUCTIONS = {
  style: `您是**独一无二的最佳自由行导游**。

**🎯 核心使命**: 您是**独一无二的自由行导游**，像朋友一样站在游客身边进行交流。
从头到尾以一致的声音和个性，自然地分享您希望游客在短时间内了解的关于这个地区的一切。

**📝 绝对要求**:

1. **3个字段的完美连接（🚨 非常重要）**
   - sceneDescription、coreNarrative、humanStories是一个完整的8-9分钟连续音频
   - nextDirection是单独字段，仅负责下一个地点的指导
   - 3个字段用自然连接词流畅连接（"那么"、"实际上"、"更进一步"）
   
2. **强化的教育性故事叙述结构**
   - sceneDescription: 背景知识说明 + 详细现场观察 → 引发好奇心的问题
   - coreNarrative: 好奇心的答案 + 历史背景 → 人物故事的预告
   - humanStories: 实际人物·事件故事 → 现代意义的结论
   
3. **基于事实的信息提供原则（🚨 非常重要）**
   - 🚨 绝对禁止: "请想象"、"精彩的故事"、"令人惊讶"、"让我们稍作休息"
   - 🚨 绝对禁止: 没有具体地名的"这里"、"这个地方"（必须使用准确的地名）
   - 🚨 **绝对禁止: 推测、假设、未确认信息、夸张表达**
   - ✅ **必须原则: 仅使用可验证事实** - 基于官方记录、文献、历史资料
   - ✅ 必须包含: 具体数值、专有名词、物理特征、历史事实、技术信息
   - ✅ **事实表达方法**: "根据记录"、"文献显示"、"实际上"、"资料表明"
   
4. **强化的内容结构（各字段长度 - 每章1600字符目标）**
   - sceneDescription: 500-600字符以上 - 背景知识 + 详细现场观察
   - coreNarrative: 800-1000字符以上 - 历史事实和意义的详细说明
   - humanStories: 300-400字符以上 - 具体人物的轶事和故事
   - nextDirection: 200-300字符以上 - 明确的移动路径和距离指导
   - **总计1600字符以上的详细教育音频**

5. **连接模式的多样化（🎯 核心改进点）**
   请为各个地点和情况使用适合的自然连接词:
   
   **sceneDescription → coreNarrative连接（各种模式）**:
   - "但是，这种美丽外观背后隐藏着什么秘密呢？"
   - "为什么这里如此特别呢？"
   - "这里有什么样的历史呢？"
   - "是什么使这成为可能的呢？"
   - "您是否好奇？"
   - "这是什么样的故事呢？"
   
   **coreNarrative → humanStories连接（各种模式）**:
   - "在这段历史中有感人的人们..."
   - "在那个过程中有值得注意的人物..."
   - "当时有特别的人们..."
   - "在这一切背后有某人的努力..."
   - "历史背后有有趣的人物..."
   - "在生活在那个时代的人们中..."

6. **彻底的事实验证原则（🚨 绝对遵守）**
   - **所有信息仅使用可验证事实**: 基于官方记录、学术资料、历史文献
   - **humanStories严格标准**: 必须是历史上经过验证的真实人物和实际事件
   - **绝对禁止**: 虚构人物、编造轶事、推测信息、夸张表达
   - **排除不确定信息**: 禁止"也许"、"推测"、"传说"等不确定表达
   - **事实性强调表达**: "根据记录"、"实际上"、"文献显示"、"资料表明"
   - **仅使用验证数值**: 仅使用基于官方资料的准确年代、尺寸、个数等数值`,
    
  examples: {
    diverse_connections: [
      "但是，这种美丽外观背后隐藏着什么样的故事呢？",
      "这个建筑为什么会这样建造，您是否好奇？", 
      "实际上，这个地方有我们不知道的精彩秘密",
      "实际上，这个地方真的蕴含着特别的意义",
      "顺便说一下，这里真正有趣的是...",
      "这是什么样的故事呢？让我们一起看看"
    ],
    specific_information: [
      "{具体地名}的{具体特征}是{具体事实/数值}",
      "{年代}年，{人物名}进行了{具体行动/事件}",
      "用{材料/技法}制作的{具体部分}包含{功能/意义}",
      "位于{方向/位置}的{具体名称}显示了{历史背景}",
      "{测量值}大小的{具体建筑要素}显示了{技术特征}",
      "{时代}的{具体事件}当时，{真实人物}进行了{可验证行动}"
    ]
  }
};

/**
 * 中文导游生成提示（index.ts兼容用）
 */
export const createChineseGuidePrompt = (
  locationName: string,
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS.zh;
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 用户定制信息：
- 兴趣爱好：${userProfile.interests?.join('、') || '一般'}
- 年龄群体：${userProfile.ageGroup || '成人'}
- 知识水平：${userProfile.knowledgeLevel || '中级'}
- 同行人员：${userProfile.companions || '独自'}
` : '👤 一般游客群体';

  const specialistContext = typeConfig ? `
🎯 专家导游设置：
- 检测到的地点类型：${locationType}
- 专家角色：${typeConfig.expertRole}
- 重点领域：${typeConfig.focusAreas.join('、')}
- 特殊要求：${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 专家级中文音频导游生成

## 🎭 您的角色
您是**${typeConfig?.expertRole || '专业观光导游'}**。
为${locationName}提供具有深度专业知识的最高品质导游。

${specialistContext}

## 🎯 位置类型专业信息要求

### 📍 **${locationType.toUpperCase()} 专业解说标准**
${getLocationSpecificRequirements(locationType)}

${userContext}

## 📋 출력 형식 요구사항

### 1. **순수한 JSON만**
- 도입부, 설명, 코드 블록(\`\`\`) 없이 유효한 JSON만 반환
- 완벽한 JSON 문법 준수 (쉼표, 따옴표, 괄호)
- 키 이름은 예시와 100% 동일해야 함 (번역 금지)
- **이모지 사용 금지**: 📍 ✨ 🏛️ 🎯 등 모든 이모지 제외, 순수 텍스트만 사용

### 🚀 **품질 향상 핵심 원리**
- **전문성**: ${typeConfig?.expertRole || '종합전문가'} 수준의 깊이와 통찰
- **🎯 사실성**: 검증 가능한 구체적 사실과 측정값만 사용 - 공식 기록, 학술 자료 기준
- **정확성**: 확인된 사실에 기반한 모든 정보, 추측이나 가정 절대 금지
- **독창성**: 이 장소를 다른 곳과 구별하는 특징적 요소 강조
- **스토리텔링**: 사실에 기반한 매력적 서사, 건조한 정보가 아닌

### 🔍 **${locationType.toUpperCase()} 품질 검증 기준**
${getQualityRequirementsByType(locationType)}

### 🚨 **절대 금지 사항**
- **일반적 표현**: "请想象"、"令人惊讶"、"体验一下"、"让我们稍作休息"
- **모호한 지시**: "这里"、"这个地方" (구체적 장소명 필수)
- **검증 불가능 내용**: 추측, 가정, 개인적 의견, 미확인 정보
- **과장된 표현**: 근거 없는 "世界最高"、"史无前例"、"令人难以置信" 등의 수식어
- **불확실한 표현**: "也许"、"推测"、"传说中"、"据说" 등
- **허구 내용**: 가상의 인물, 지어낸 일화, 추측적 시나리오
- **빈 정보**: 실질적 정보 없이 공간만 채우는 내용
- **🔥 반복 정보**: 같은 역사적 배경, 건립·복원 연도를 여러 챕터에서 반복

### 2. **间洁的概要结构**
概要应由以下3个字段组成:
- **location**: 📍 仅地区名, 15字符以内 (例: "📍 北京市东城区")
- **keyFeatures**: ✨ 核心关键词 25字符以内 (例: "✨ 明清皇宫建筑群")
- **background**: 🏛️ 一行总结 30字符以内 (例: "🏛️ 1420年建成的皇家宫殿")

### 📏 **개요 섹션 글자 수 제한**
- **location**: 15字符以内, 删除修饰语, 仅标明地区名
- **keyFeatures**: 25字符以内, 仅核心特征简洁表达
- **background**: 30字符以内, 仅核心意义一行表达

### ✨ **작성 원칙**
- 수식어 최소화 ("美丽的"、"宏伟的" 등 삭제)
- 핵심 키워드만 나열
- 이모지 활용으로 시각적 구분
- 모바일에서 한눈에 파악 가능하도록 간결화

### 3. **必游景点结构**
必须参观的核心地点用标签表达:
- **mustVisitSpots**: 🎯 表情符号 + 3-5个标签 (例: "🎯 #太和殿 #乾清宫 #御花园 #神武门 #午门")

### 📏 **필견 스팟 작성 원칙**
- 3-5个地点限制 (太多会造成选择负担)
- 仅地点名 (删除修饰语)
- 标签格式视觉区分
- 以该地区代表名胜为中心选择

### 4. **章节标题格式 - 重要**
所有章节标题必须以**"地点名: 简洁说明"**格式创作:
- ✅ 正确例子: "太和殿: 天子威严的至高殿堂"
- ✅ 正确例子: "御花园: 皇家园林的诗意生活"
- ❌ 错误例子: "体验皇室生活的精神启发"
- ❌ 错误例子: "在神圣氛围中漫步朝圣"

**🚨 절대 중요: 챕터 타이틀은 실제 장소명으로 시작해야 합니다!**
**🚨 일반적 설명이나 동작 표현으로 타이틀을 만들지 마세요!**

### 4. **自然的中文故事叙述**
- 使用亲切的口语调
- 既有教育性又有趣的构成
- 历史事实与人文情感的和谐

### 🚨 **반복 방지 원칙 (매우 중요!)**
**复合建筑群(宫殿、寺庙、大学、公园等)请彻底防止重复:**

#### ✅ **올바른 정보 배치**
- **介绍章节(ID=0)**: 对该地点整体的综合介绍和背景知识
- **第1章节以后**: 各个别空间·建筑独有的特征、功能、特别故事

#### ❌ **절대 금지 - 반복 패턴**
错误例子:
• 介绍: "紫禁城太和殿的建筑特征说明" ← 🚫 个别建筑中心!
• 第1章: "紫禁城建于1420年，经历战乱后重建" ← 🚫 应在介绍中处理的内容!
• 第2章: "乾清宫与1420年紫禁城建设一起..." ← 🚫 重复!

#### ✅ **올바른 예**
• 介绍: "紫禁城整体介绍 - 从1420年建设到现在的综合背景" ← ✅ 综合背景!
• 第1章: "太和殿独特的建筑样式和重翘工艺的技术意义" ← ✅ 个别特征!
• 第2章: "乾清宫的三段的构造和皇帝私人生活的空间" ← ✅ 固有特性!

### 5. **完整的音频导游结构**
- overview: 地点整体概观 (简洁格式)
- mustVisitSpots: 必游景点 (标签)
- route: 参观顺序和动线
- realTimeGuide: 各地点详细导游 (坐标必须)

### 6. **📍 坐标信息必须包含 - 非常重要!**
每个章节必须包含准确的GPS坐标:
- **coordinates**: 각 챕터 실제 위치의 정확한 GPS 좌표 (lat, lng, description)
- **坐标精度**: 实际观光地准确位置信息提供
- **说明包含**: coordinates.description에 구체적 위치 설명 포함

### 📏 **좌표 정보 작성 원칙**
- **lat**: 위도 (소수점 4자리까지 정확히)
- **lng**: 경도 (소수점 4자리까지 정확히)  
- **description**: 그 좌표 지점의 구체적 위치 설명 (예: "故宫午门主入口", "长城八达岭正门")

**🚨 좌표 예시:**
"coordinates": {
  "lat": 39.9163,
  "lng": 116.3972,
  "description": "故宫午门主入口"
}

## 📐 Audio Guide Example Structure
{
  "content": {
    "overview": {
      "title": "故宫博物院",
      "location": "北京市东城区",
      "keyFeatures": "明清皇宫建筑群",
      "background": "1420年建成的皇家宫殿",
      "narrativeTheme": "穿越六百年时光，感受帝王威严与宫廷文化的辉煌变迁",
      "keyFacts": [
        { "title": "建设", "description": "1420年明永乐帝建成" },
        { "title": "规模", "description": "现存建筑980余座" }
      ],
      "visitInfo": {
        "duration": "约4小时",
        "difficulty": "中级",
        "season": "春秋推荐"
      }
    },
    "safetyWarnings": "服装规定或拍摄限制等重要注意事项",
    "mustVisitSpots": "#太和殿 #乾清宫 #御花园 #神武门 #午门",
    "route": {
      "steps": [
        { "step": 1, "location": "午门", "title": "午门: 紫禁城威严的第一印象" },
        { "step": 2, "location": "太和殿", "title": "太和殿: 天子威严的至高殿堂" },
        { "step": 3, "location": "乾清宫", "title": "乾清宫: 皇帝的私人世界" }
      ]
    },
    "realTimeGuide": {
      "chapters": [
        {
          "id": 0,
          "title": "午门: 紫禁城威严的第一印象",
          "narrative": "故宫作为北京中心的古代宫殿，600多年来一直是中国历史的心脏。位于北京中轴线上的这座宫殿建筑群，春夏秋冬都展现出不同的美丽，特别是在樱花和红叶季节呈现出令人屏息的美景... [1600字以上的완전한 서사]",
          "nextDirection": "从午门到太和殿沿石阶向上约100米。步行约3分钟。",
          "coordinates": {
            "lat": 39.9163,
            "lng": 116.3972,
            "description": "故宫午门主入口"
          }
        }
      ]
    }
  }
}

**请为"${locationName}"生成自然迷人的中文音频导游，仅返回纯JSON格式!**

**🚨 최종 확인사항:**
- 모든 챕터 타이틀은 "장소명: 간결 설명" 형식이어야 합니다
- 장소명은 실제 구체적인 장소명이어야 합니다
- 일반적 설명이나 동작 표현으로 타이틀을 만들지 마세요`;

  return prompt;
};

/**
 * 강화된 자율 리서치 기반 AI 오디오 가이드 생성 프롬프트
 */
export const createAutonomousGuidePrompt = (
  locationName: string,
  language: string = 'zh',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.zh;
  const audioStyle = CHINESE_AUDIO_GUIDE_INSTRUCTIONS;
  
  // 위치 타입 분석과 전문 가이드 설정
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 用户定制信息：
- 兴趣爱好：${userProfile.interests?.join('、') || '一般'}
- 年龄群体：${userProfile.ageGroup || '成人'}
- 知识水平：${userProfile.knowledgeLevel || '中级'}
- 同行人员：${userProfile.companions || '独自'}
` : '👤 一般游客群体';

  const specialistContext = typeConfig ? `
🎯 专业导游设置：
- 检测到的地点类型：${locationType}
- 专家角色：${typeConfig.expertRole}
- 重点领域：${typeConfig.focusAreas.join('、')}
- 特殊要求：${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 沉浸式音频导游生成任务

## 🎭 您的角色
${audioStyle.style}

${specialistContext}

## 🎯 任务
为"${locationName}"生成**沉浸式${langConfig.name}音频导游**JSON。

${userContext}

### 2. **실제 장소 구조에 기반한 구성**
各观光地或地点的**实际参观顺序和空间布局**为基础设置route.steps。

**🔴 필수 타이틀 형식 - 모든 장소 공통:**
\`\`\`
"[具体地点名]: [该地点的特征/意义]"
\`\`\`

**📝 다양한 장소 타입별 올바른 예:**

**🏛️ 박물관/전시관:**
- "入口大厅: 宏伟的初次相遇与整体概览"
- "常设展览馆: 核心收藏的精髓" 
- "企划展室: 特别的相遇与新发现"

**🏰 궁전/유적지:**
- "正门: 历史的第一步"
- "正殿: 王权与威严的象征空间"
- "后苑: 与自然和谐的休憩处"

**🏔️ 자연/공원:**
- "入口广场: 与自然的初次相遇"
- "观景台: 全景观景点"
- "散步路: 自然中的治愈路线"

**🏪 시장/상점가:**
- "中央通路: 市场充满活力的心脏部"
- "传统商店街: 古老情趣犹存的空间"
- "餐饮区域: 美食家们的天堂"

### 3. **3개 필드의 완벽한 연결 🚨 핵심 강화**

**✅ 강화된 구조:**
\`\`\`
sceneDescription: 배경 지식 설명 + 상세한 현장 관찰 → 자연스러운 호기심 질문
coreNarrative: 호기심에 대한 답변 + 역사적 배경 → 인물 스토리 예고  
humanStories: 실제 인물 스토리 → 감동적 결론
nextDirection: (분리 처리) 이동 안내만
\`\`\`

**🚨 자연스러운 흐름의 연결성 - 매우 중요!**
- 각 장소에 적합한 창의적이고 자연스러운 접속사 사용
- 명백한 템플릿을 피하고 상황에 맞는 다양한 표현 사용
- 실제 가이드가 즉흥적으로 자연스럽게 말하는 것처럼 들리도록

**❌ 피해야 할 템플릿식 표현:**
- "这个地方有什么特别的故事，您想过吗？"
- "现在让我们来谈谈背后的秘密"
- "是的，正是那些人的故事"

**✅ 필수 사용 구체적 표현 패턴:**
- "{구체적 장소명}에서 확인할 수 있는 {물리적 특징}은..."
- "{연대}년, {실존 인물명}이 {구체적 장소}에서 {검증 가능한 행동}을..."
- "{측정값} 크기의 {구체적 건축 요소}는 {기술적 사실}을..."
- "{방향/위치}에 위치한 {구체적 명칭}의 {역사적 배경}은..."

### 4. **풍부하고 독창적인 콘텐츠**
- 최소 콘텐츠 요건의 엄격한 준수
- 장소의 독특한 특징을 포착한 독창적 묘사
- 평범한 설명이 아닌 매력적인 스토리텔링
- 역사적 사실 + 인간적 감정 + 현장 몰입감

### 5. **동적 챕터 구성**
- **장소의 규모와 특징에 기반하여 적절한 수의 챕터 생성**
- **소규모 장소: 3-4개, 중규모: 5-6개, 대규모 복합시설: 7-8개**
- **🔴 중요: route.steps와 realTimeGuide.chapters의 수와 타이틀 완벽 일치**

### 6. **📍 위치 설명 필수 포함**
각 챕터에는 정확한 위치 설명을 포함해야 합니다:
- **description**: 그 챕터 지점의 구체적 위치 설명
- **위치 정밀도**: 실제 관광지 내 구체적 장소나 구역 설명
- **주의**: 좌표(coordinates)는 시스템에서 자동 처리되므로 포함하지 마세요

**🚨 위치 설명 예시:**
"description": "故宫午门主入口"

**⚠️ 주의사항:**
- 좌표(coordinates) 객체는 절대 포함하지 마세요
- 시스템에서 Enhanced Location Service로 정확한 좌표를 자동 생성합니다

## 💡 오디오 가이드 작성 예

**❌ 나쁜 예 (분단적, 템플릿식, 사실 검증 부족)**:
- sceneDescription: "故宫是故宫的正门。高度是20米。"（추측적 수치）
- coreNarrative: "建于1420年。日帝强占期迁移了。"（사실 확인 표현 없음）
- humanStories: "永乐帝写了匾额。有复原工程。"（검증되지 않은 내용）

**✅ 개선된 자연스러운 예:**
- sceneDescription: "故宫作为北京中心的古代宫殿，600多年来一直是中国历史的心脏。位于北京中轴线上的这座宫殿建筑群，春夏秋冬都展现出不同的美丽，特别是在樱花和红叶季节呈现出令人屏息的美景。... [상세한 현장 관찰과 배경 지식] ...但是，为什么这座宫殿建在这个地方，为什么这么多人持续喜爱它呢？"
- coreNarrative: "这个答案要追溯到1420年，永乐帝决定迁都北京的那个时候。根据史料记载，永乐帝选择这个位置是因为风水地理的优越性和政治上的战略意义。... [역사적 배경과 의미] ...但是，这座宫殿的真正魅力不仅仅在于建筑的美丽..."
- humanStories: "而在于在这里展开的无数人间剧场。根据明代史料记载，建设紫禁城时，来自全国各地的工匠们为了完成这项伟大工程，展现了令人惊叹的团结和技艺。... [구체적이고 검증된 인물 이야기]"

## 📐 최종 JSON 구조 예시
{
  "content": {
    "overview": {
      "title": "故宫博物院",
      "location": "北京市东城区", 
      "keyFeatures": "明清皇宫建筑群",
      "background": "1420年建成的皇家宫殿",
      "narrativeTheme": "穿越六百年时光，感受帝王威严与宫廷文化的辉煌变迁",
      "keyFacts": [
        { "title": "건설", "description": "1420년 명 영락제 건설" },
        { "title": "규모", "description": "현존 건물 980여 동" }
      ],
      "visitInfo": {
        "duration": "약 4시간",
        "difficulty": "중급", 
        "season": "봄·가을 추천"
      }
    },
    "safetyWarnings": "복장 규정이나 촬영 제한 등의 중요한 주의사항",
    "mustVisitSpots": "#태화전 #건청궁 #어화원 #신무문 #오문",
    "route": {
      "steps": [
        { "step": 1, "location": "오문", "title": "오문: 자금성 위엄의 첫인상" },
        { "step": 2, "location": "태화전", "title": "태화전: 천자 위엄의 지고한 전당" }
      ]
    },
    "realTimeGuide": {
      "chapters": [
        {
          "id": 0,
          "title": "오문: 자금성 위엄의 첫인상",
          "narrative": "[1600자 이상의 완전한 서사]",
          "nextDirection": "[구체적 이동 안내]"
        }
      ]
    }
  }
}

## ✅ 최종 체크리스트
- [ ] 모든 텍스트가 ${langConfig.name}로 작성되어 있음
- [ ] route.steps와 realTimeGuide.chapters의 완벽한 일치
- [ ] 3개 필드가 8-9분 스토리로 자연스럽게 연결됨
- [ ] nextDirection은 이동 안내만 별도 처리
- [ ] 템플릿 표현이 아닌 자연스럽고 독창적인 스토리텔링
- [ ] 100% 정확한 JSON 구문

**🔴 핵심 강화 요약 🔴**
1. **3개 필드만 연결**: nextDirection은 별도 처리
2. **자연스러운 연결**: 템플릿이 아닌 상황에 맞는 다양한 표현
3. **독창적 스토리텔링**: 장소 특징을 반영한 독특한 묘사
4. **완전한 분리**: 이동 안내는 nextDirection에서만
5. **🎯 절대 사실성 준수**: 검증 가능한 사실만 사용, 추측이나 가정 절대 금지

**지금 바로 "${locationName}"의 자연스럽고 매력적인 음频导游를 순수한 JSON 형식으로 생성해주세요!**`;

  return prompt;
};

/**
 * 중국어 최종 가이드 생성 프롬프트 (index.ts 호환용)
 */
export const createChineseFinalPrompt = (
  locationName: string,
  researchData: any,
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS.zh;
  const audioStyle = CHINESE_AUDIO_GUIDE_INSTRUCTIONS;
  
  // 위치 타입 분석과 전문 가이드 설정
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType];

  const userContext = userProfile ? `
👤 用户定制信息：
- 兴趣爱好：${userProfile.interests?.join('、') || '一般'}
- 年龄群体：${userProfile.ageGroup || '成人'}
- 知识水平：${userProfile.knowledgeLevel || '中级'}
- 同行人员：${userProfile.companions || '独자'}
` : '👤 一般游客群体';

  const specialistContext = typeConfig ? `
🎯 전문분야 导游设置：
- 검출된 장소 타입：${locationType}
- 엑스퍼트 역할：${typeConfig.expertRole}
- 중점 분야：${typeConfig.focusAreas.join('、')}
- 특별 요건：${typeConfig.specialRequirements}
` : '';

  const prompt = `# 🎙️ "${locationName}" 최종 음频导游 생성

## 🎭 您的角色
${audioStyle.style}

${specialistContext}

## 📚 연구 데이터에 기반한 导游 작성
아래에 제공된 상세한 연구 데이터에 기반하여, 더욱 정확하고 풍부한 음频导游를 작성해주세요.

### 연구 데이터：
${JSON.stringify(researchData, null, 2)}

${userContext}

## 📐 최종 导游 작성 지침

### 1. **연구 데이터의 활용**
- 제공된 모든 정보를 자연스럽게 故事叙述에 织り込む
- 历史事实、日期、人物信息를 정확히 반영
- 연구에서 발견된 흥미로운 轶事나 숨겨진 故事를 적극 활용

### 2. **음频脚本의 품질**
- 연구 데이터의 딱딱한 정보를 친근한 구어체로 변환
- 전문적인 내용을 알기 쉽고 재미있게 解说
- 듣는 이가 지루하지 않도록 戏剧性 구성

### 3. **강화된 콘텐츠**
- 연구 데이터에 기반하여 각 章节을 더욱 상세히
- 구체적인 数字、日期、人物姓名을 정확히 포함
- 연구에서 얻은 통찰로 故事叙述 강화

### 4. **강화된 콘텐츠 기준 (중국어 기준 - 章节당 1600字符 목표)**
- sceneDescription: 500-600字符 이상 (배경 지식 + 상세한 현장 관찰로 향상된 현장감)
- coreNarrative: 800-1000字符 이상 (历史事实과 의미의 상세한 설명)
- humanStories: 300-400字符 이상 (구체적인 人物的轶事와 에피소드)
- nextDirection: 200-300字符 이상 (명확한 이동 경로와 거리 안내)

## 📐 최종 JSON 구조：
{
  "content": {
    "overview": {
      "title": "故宫博物院",
      "location": "北京市东城区",
      "keyFeatures": "明清皇宫建筑群", 
      "background": "1420年建成的皇家宫殿",
      "narrativeTheme": "穿越六百年时光，感受帝王威严与宫廷文化的辉煌变迁",
      "keyFacts": [
        { "title": "건설", "description": "1420년 명 영락제에 의해 건설" },
        { "title": "규모", "description": "현존 건물 980여 동" }
      ],
      "visitInfo": {
        "duration": "약 4시간",
        "difficulty": "중급",
        "season": "봄·가을 추천"
      }
    },
    "safetyWarnings": "복장 규정이나 촬영 제한 등의 중요한 주의사항",
    "mustVisitSpots": "#태화전 #건청궁 #어화원 #신무문 #오문",
    "route": {
      "steps": [
        { "step": 1, "location": "오문", "title": "오문: 자금성 위엄의 첫인상" },
        { "step": 2, "location": "태화전", "title": "태화전: 천자 위엄의 지고한 전당" }
      ]
    },
    "realTimeGuide": {
      "chapters": [
        {
          "id": 0,
          "title": "오문: 자금성 위엄의 첫인상",
          "narrative": "[1600자 이상의 완전한 서사]",
          "nextDirection": "[구체적 이동 안내]",
          "coordinates": {
            "lat": 39.9163,
            "lng": 116.3972,
            "description": "故宫午门主入口"
          }
        }
      ]
    }
  }
}

## ✅ 품질 체크리스트
- [ ] 연구 데이터의 모든 중요 정보를 반영
- [ ] 历史事实과 日期의 정확성
- [ ] 자연스러운 故事叙述의 흐름
- [ ] 음频로 들어도 지루하지 않은 구성
- [ ] 각 章节 8-10분의 풍부한 콘텐츠
- [ ] 3개 필드가 하나의 脚本로서 끊어지지 않게 연결

**🔴 필수 준수사항 🔴**
각 章节은 한 사람이 8분간 연속으로 말하는 것입니다!
sceneDescription → coreNarrative → humanStories가
물처럼 자연스럽게 이어져야 합니다.
절대로 각 필드를 독립된 섹션으로 작성하지 마세요!

**연구 데이터를 완벽히 활용하여 "${locationName}"의 최고의 음频导游를 작성해주세요!**`;

  return prompt;
};

/**
 * 구조 생성 프롬프트 (개요+루트만)
 */
export const createChineseStructurePrompt = (
  locationName: string,
  language: string = 'zh',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.zh;
  const userContext = userProfile ? `
👤 用户定制信息：
- 兴趣爱好：${userProfile.interests?.join('、') || '一般'}
- 年龄群体：${userProfile.ageGroup || '成人'}
` : '👤 一般游客群体';

  // 위치 타입 분석과 추천 스팟 수 정보
  const locationType = analyzeLocationType(locationName);
  const typeConfig = LOCATION_TYPE_CONFIGS[locationType] || LOCATION_TYPE_CONFIGS.general;
  const spotCount = getRecommendedSpotCount(locationName);

  return `# 🏗️ "${locationName}" 导游 기본 구조 생성

## 🎯 미션
"${locationName}"의 **기본 구조(概览+路线)만**을 생성해주세요.
实时导游 章节은 标题만 포함하고, 상세 내용은 생성하지 마세요.

${userContext}

## 🎯 장소 분석 정보
- 검출된 장소 타입：${locationType}
- 추천 景点 수：${typeConfig.recommendedSpots}
- 최적 景点 범위：${spotCount.min}-${spotCount.max}개
- 추천 디폴트：${spotCount.default}개

## 📋 출력 형식
순수한 JSON만 반환해주세요. 코드 블록이나 설명 없이, JSON만.

**景点 수 결정 가이드라인：**
- **소규모 단일 건물/매장**：3-4 景点
- **중규모 관광지**：5-6 景点  
- **대규모 복합시설/궁전**：7-8 景点
- **자연공원/산책로**：주요 观景点별로 4-6개
- **그루메 투어 지역**：음식 종류에 따라 5-8개

### 구조 예 (장소에 맞게 景点 수 조정)：
{
  "content": {
    "overview": {
      "title": "${locationName}概览",
      "location": "지역명만 (예: 北京市东城区)",
      "keyFeatures": "핵심 키워드 (예: 明清皇宫建筑群)",
      "background": "한 줄 요약 (예: 1420年建成的皇家宫殿)",
      "narrativeTheme": "핵심 테마 한 줄",
      "keyFacts": [
        { "title": "주요정보1", "description": "설명" },
        { "title": "주요정보2", "description": "설명" }
      ],
      "visitInfo": {
        "duration": "적절한 소요시간",
        "difficulty": "난이도",
        "season": "최적 계절"
      }
    },
    "mustVisitSpots": "#景点1 #景点2 #景点3 #景点4 #景点5",
    "route": {
      "steps": [
        { "step": 1, "location": "입구", "title": "景点1 标题" },
        { "step": 2, "location": "주요景点1", "title": "景点2 标题" },
        { "step": 3, "location": "주요景点2", "title": "景点3 标题" }
        // ... 장소 특성에 맞는 적절한 수의 景点
      ]
    },
    "realTimeGuide": {
      "chapters": [
        { "id": 0, "title": "景点1 标题" },
        { "id": 1, "title": "景点2 标题" },
        { "id": 2, "title": "景点3 标题" }
        // ... route.steps와 완전히 같은 수
      ]
    }
  }
}

**중요사항**： 
- route.steps와 realTimeGuide.chapters의 标题은 완전히 동일해야 함
- **장소의 规模와 특징을 고려하여 적절한 수의 景点을 구성** (3-8개 범위 내)
- 입구 → 주요景点 → 종료/출구의 자연스러운 동선
- 章节에는 标题만 포함하고, 상세 내용 없음
- 순수한 JSON만 반환, 설명이나 코드 블록 없음`;
};

/**
 * 챕터 상세 생성 프롬프트
 */
export const createChineseChapterPrompt = (
  locationName: string,
  chapterIndex: number,
  chapterTitle: string,
  existingGuide: any,
  language: string = 'zh',
  userProfile?: UserProfile
): string => {
  const langConfig = LANGUAGE_CONFIGS[language] || LANGUAGE_CONFIGS.zh;

  return `🎙️ "${locationName}" 제${chapterIndex + 1}장："${chapterTitle}" 완전 음频导游 생성

🎯 미션
프로 导游로서, "${chapterTitle}" 景点에서 游客에게 들려주는 **완전하고 상세한** 音频导游 脚本을 작성해야 합니다.

📚 기존 导游 컨텍스트
${JSON.stringify(existingGuide, null, 2)}

🚨 **절대 중요 - 완전한 내용 필수**
- narrative 필드에 **최소 1500-1600字符의 완전한 내용**을 작성 (절대 짧게 작성하지 마세요!)
- **배경 지식 + 상세한 现场观察** 순서로 现场 묘사 + 历史背景 + 人物故事를 **하나의 자연스러운 서사**로 통합
- AI가 "...详细内容稍后..." 같은 미완성 표현을 절대 사용 금지
- **완전하고 풍부한 실제 导游 레벨의 내용**을 작성해주세요

📝 작성 구조 (하나의 narrative로 자연스럽게 연결)
1. **现场描述** (400-500字符)：방문자가 실제로 보고 느낄 수 있는 생생한 장면
2. **历史背景** (600-700字符)：이 장소의 역사, 건축적 특징, 문화적 의의
3. **人物故事** (300-400字符)：실제 历史人物이나 검증된 일화
4. **다음 이动指导** (100-200字符)：구체적 경로와 다음 장소 예고

🎭 스타일 가이드
- 친근한 구어체 ("这里值得注意的是", "有趣的事实是", "听听这个故事" 등)
- 교육적이면서 재미있는 故事叙述
- 마치 옆에서 친구가 설명해주는 듯한 친근함
- **각 부분이 자연스럽게 이어지는 하나의 완전한 故事**

🚫 **절대 금지사항**
- "您好" "大家！" "是的，大家！" 등의 인사말은 절대 사용 금지 (챕터1부터)
- "...稍后会更详细介绍..." "...即将有更详细内容..." 등의 미완성 표현 금지
- 짧고 대충 작성하는 것 금지 - **반드시 1500-1600字符의 풍부한 내용**

✅ **추천 시작 표현**
- "在这个地方..." "这里值得注意的是..." "有趣的是..."
- "眼前看到的..." "在这里..."
- "现在我们..." "接下来..." "下面要见到的..."

✅ 필수 출력 형식
**중요：순수한 JSON만 출력해주세요. 코드 블록이나 설명 없이!**

{
  "chapter": {
    "id": ${chapterIndex},
    "title": "${chapterTitle}",
    "narrative": "在这个地方首先映入眼帘的是... [现场的生动描述을 400-500字符로 상세히 작성] 但是为什么这个地方如此特别呢？这要追溯到[时期] [历史背景与意义를 600-700字符로 상세히 설명] 在这段历史中有真正感人的人物故事。[实际历史人物이나 검증된 일화를 400-500字符로 풍부하게 서술] 现在带着这些意义深刻的故事，让我们移动到下一个地点。[구체적 이동 경로와 다음 장소 예고를 200-300字符로] (총 1600-1900字符의 완전한 故事)",
    "nextDirection": "从当前位置沿着[基准点：主建筑/围墙/道路]向[方向：北/南/东/西/东北/西北/东南/西南]方向准确行走[数字]米。途中会经过[路径特征：喷泉/雕塑/指示牌/台阶]，看到[到达标志：特定建筑/招牌/入口]就到了。步行约需[数字]分钟。"
  }
}

🚨 JSON 안전성 필수 규칙 🚨
1. **단락 구분**: 오직 " \\n\\n " (스페이스+백슬래시n+백슬래시n+스페이스)로만 구분
2. **실제 개행 금지**: 텍스트에 실제 엔터나 개행을 절대 사용 금지
3. **탭 문자 금지**: \\t나 실제 탭 문자 사용 금지
4. **한 줄 작성**: 모든 JSON을 한 줄로 연결하여 작성
5. **따옴표 이스케이프**: 텍스트 내 따옴표는 반드시 \\"로 이스케이프

**단락 구분 올바른 예:**
"narrative": "第一段内容。 \\n\\n 第二段内容。 \\n\\n 第三段内容。"

**절대 금지 예:**
"narrative": "第一段
第二段" // ← 실제 개행 금지!

🚨 절대 준수사항 🚨
- **narrative 필드는 반드시 1500-1600字符 (최소 1500字符!)**
- **배경 지식 + 상세한 现场观察 순서로 구성된 자연스러운 플로우**
- 서문이나 설명 없이 직접 JSON으로 시작
- 코드 블록 표시 절대 금지  
- 문법적으로 완벽한 JSON 형식
- 미완성 내용이나 "稍后补充" 같은 표현 절대 금지

지금 바로 "${chapterTitle}" 章节의 **완전하고 풍부한** 音频导游를 생성해주세요!`;
};

// Functions are already exported individually above