// AI μλ™ νλ¥΄μ†λ‚ μ„ νƒ λ° μ μ‘ν• ν”„λ΅¬ν”„νΈ μ‹μ¤ν…

export const createAdaptivePersonaPrompt = (locationName: string, language: string = 'ko'): string => {
  // π§  μ¤λ§νΈ λ¶„λ¥κΈ°λ΅ μµμ  νλ¥΄μ†λ‚ λ―Έλ¦¬ μ„ νƒ
  const smartClassificationResult = SmartPersonaClassifier.selectOptimalPersona(locationName);
  
  console.log('π― μ¤λ§νΈ λ¶„λ¥κΈ° μ¶”μ² νλ¥΄μ†λ‚:', smartClassificationResult);
  
  return `# π­ AI μλ™ νλ¥΄μ†λ‚ μ„ νƒ λ° κ°€μ΄λ“ μƒμ„± μ‹μ¤ν…

## π§  μ¤λ§νΈ λ¶„λ¥κΈ° μ¶”μ² κ²°κ³Ό
**μ¶”μ² νλ¥΄μ†λ‚**: ${smartClassificationResult.persona}
**μ‹ λΆ°λ„**: ${(smartClassificationResult.confidence * 100).toFixed(1)}%
**μ¶”μ² μ΄μ **: ${smartClassificationResult.reasoning.join(', ')}

## π― μµμΆ… νλ¥΄μ†λ‚ μ„ νƒ κ°€μ΄λ“λΌμΈ
μ„μ μ¤λ§νΈ λ¶„λ¥κΈ° μ¶”μ²μ„ **μ°μ„ μ μΌλ΅ κ³ λ ¤**ν•λ, "${locationName}"μ κµ¬μ²΄μ  νΉμ„±μ„ λ¶„μ„ν•μ—¬ μµμΆ… κ²°μ •ν•μ„Έμ”.

## π― 1λ‹¨κ³„: μ¥μ† λ¶„μ„ λ° μµμ  νλ¥΄μ†λ‚ μλ™ μ„ νƒ

**λ¶„μ„ λ€μƒ**: "${locationName}"

**AI μ„λ¬΄**: μ„ μ¥μ†λ¥Ό λ¶„μ„ν•κ³  κ°€μ¥ μ ν•©ν• μ „λ¬Έκ°€ νλ¥΄μ†λ‚μ™€ λ¬Έν™”μ  μ ‘κ·Ό λ°©μ‹μ„ μλ™μΌλ΅ κ²°μ •ν•μ„Έμ”.

### π“ μ¥μ† λ¶„μ„ μ”μ†λ“¤:
1. **μ§€λ¦¬μ  μ„μΉ**: μ–΄λ λ‚λΌ/μ§€μ—­μΈκ°€?
2. **λ¬Έν™”κ¶**: μ–΄λ–¤ λ¬Έλ…/λ¬Έν™”κ¶μ— μ†ν•λ”κ°€?
3. **κ±΄μ¶• μ–‘μ‹**: μ–΄λ–¤ κ±΄μ¶•μ  νΉμ§•μ„ κ°€μ§€λ”κ°€?
4. **μ—­μ‚¬μ  μ‹λ€**: μ–Έμ  λ§λ“¤μ–΄μ΅λ”κ°€?
5. **μ£Όμ” κΈ°λ¥**: μ›λ λ¬΄μ—‡μ„ μ„ν•΄ λ§λ“¤μ–΄μ΅λ”κ°€?

### π­ μ„ νƒ κ°€λ¥ν• νλ¥΄μ†λ‚ μ ν•λ“¤:

#### **π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: μ•ν•¨λΈλΌ κ¶μ „, λ² λ¥΄μ‚¬μ  κ¶μ „, κ²½λ³µκ¶, μκΈμ„±, λ£¨λΈλ¥΄ κ¶μ „, μμ €μ„± λ“±
- νΉμ§•: μ™•κ¶κ³Ό μ •μΉ, κ¶μ •λ¬Έν™”, κ±΄μ¶• μ„κ³„μ§μ„, μ™•μ‹¤ μƒν™μ‚¬ μ „λ¬Έ
- ν†¤: ν’κ²© μκ³  κ¶μ„μ μ΄λ©° μ—­μ‚¬μ  κΉμ΄ μ¤‘μ‹

#### **β› μΆ…κµ/μμ„± μ „λ¬Έκ°€**
- μ μ© λ€μƒ: μ„±λ² λ“λ΅ λ€μ„±λ‹Ή, μ•™μ½”λ¥΄μ™€νΈ, λ¶κµ­μ‚¬, λΈ”λ£¨λ¨μ¤ν¬, λ°”ν‹°μΉΈ, μ„μ• λ“±
- νΉμ§•: μΆ…κµ μ² ν•™, μμ„±, μ‹ μ•™κ³Ό μμ μ μ΅°ν™”, μλ΅€ λ¬Έν™” μ „λ¬Έ
- ν†¤: κ²½κ±΄ν•κ³  λ…μƒμ μ΄λ©° μ΄μ›”μ  κ²½ν— μ λ„

#### **π›οΈ κ³ λ€λ¬Έλ… μ „λ¬Έκ°€**
- μ μ© λ€μƒ: ν”ΌλΌλ―Έλ“, νλ¥΄ν…λ…Ό μ‹ μ „, μ½λ΅μ„Έμ›€, λ§μ¶”ν”½μ¶”, ννΈλΌ, μ¤ν†¤ν—¨μ§€ λ“±
- νΉμ§•: κ³ λ€ κΈ°μ , λ¬Έλ…μ‚¬, μΈλ¥ μ μ‚°, κ³ κ³ ν•™μ  λ°κ²¬ μ „λ¬Έ
- ν†¤: κ²½μ΄λ΅μ›€κ³Ό μ‹κ°„μ κΉμ΄ κ°•μ΅°

#### **π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€**
- μ μ© λ€μƒ: μ—ν νƒ‘, κµ¬κ²ν•μ„, μ‹λ“λ‹ μ¤νλΌν•μ°μ¤, λ¶€λ¥΄μ¦ ν• λ¦¬ν, λΉλ°”μ¤ κµ¬κ²ν•μ„ λ“±
- νΉμ§•: νμ‹  κΈ°μ , λ¨λ λ””μμΈ, λ„μ‹ λ°μ „, κ±΄μ¶• κ³µν•™ μ „λ¬Έ
- ν†¤: λ―Έλμ§€ν–¥μ μ΄κ³  νμ‹ μ 

#### **πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: κ·Έλλ“μΊλ‹μ–Έ, κ°λΌνκ³ μ¤, μΈλ£¨λ£¨, μλ΅μ¤ν†¤, μ•„λ§μ΅΄, μ‚¬νλ¦¬ λ“±
- νΉμ§•: μ§€μ§ν•™, μƒνƒκ³„, ν™κ²½λ³΄νΈ, μ•Όμƒλ™λ¬Ό, κΈ°ν›„ μ „λ¬Έ
- ν†¤: μμ—°κ³Όμ κµκ°κ³Ό κ²½μ™Έκ° μ¤‘μ‹

#### **π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€**
- μ μ© λ€μƒ: λ©”νΈλ΅ν΄λ¦¬νƒ„ λ―Έμ κ΄€, μ°ν”ΌμΉ κ°¤λ¬λ¦¬, ν”„λΌλ„ λ―Έμ κ΄€, ν…μ΄νΈ λ¨λ λ“±
- νΉμ§•: λ―Έμ μ‚¬, μμ  μ‚¬μ΅°, μ‘ν’ λ¶„μ„, νλ μ΄ν… μ „λ¬Έ
- ν†¤: κ°μ„±μ μ΄κ³  μ°½μ΅°μ μ΄λ©° λ―Έμ  κ°κ° μ¤‘μ‹

#### **π μμ‹/μ”λ¦¬ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: μΈ ν‚¤μ§€ μ‹μ¥, λ°λ μ‹μ•„ μ‹μ¥, μ΄μ¤νƒ„λ¶ κ·Έλλ“ λ°”μλ¥΄, λ‚ν λ°Έλ¦¬, ν”„λ΅λ°©μ¤ λ“±
- νΉμ§•: μ”λ¦¬ λ¬Έν™”, μ§€μ—­ νΉμ‚°λ¬Ό, μμ‹ μ—­μ‚¬, μ™€μΈ/μ  λ¬Έν™” μ „λ¬Έ
- ν†¤: μΉκ·Όν•κ³  κ°κ°μ μ΄λ©° λ¬Έν™”μ  μ¤ν† λ¦¬ν…”λ§ μ¤‘μ‹

#### **π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: 5λ²κ°€, μƒΉμ ¤λ¦¬μ , λ…λ™, μ‹λ¶€μ•Ό, λ°€λΌλ…Έ ν¨μ… μ§€κµ¬, μ†νΈ λ“±
- νΉμ§•: ν¨μ… νΈλ λ“, λΈλλ“ μ—­μ‚¬, λΌμ΄ν”„μ¤νƒ€μΌ, μ†λΉ„ λ¬Έν™” μ „λ¬Έ
- ν†¤: νΈλ λ””ν•κ³  μ‹¤μ©μ μ΄λ©° ν„λ€μ  κ°κ° μ¤‘μ‹

#### **π μ—”ν„°ν…μΈλ¨ΌνΈ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: λΈλ΅λ“μ›¨μ΄, λΌμ¤λ² μ΄κ±°μ¤, λ””μ¦λ‹λλ“, μ λ‹λ²„μ„¤ μ¤νλ””μ¤, ν• λ¦¬μ°λ“ λ“±
- νΉμ§•: κ³µμ—° μμ , μν™” μ‚°μ—…, μ—”ν„°ν…μΈλ¨ΌνΈ μ—­μ‚¬, λ€μ¤‘λ¬Έν™” μ „λ¬Έ
- ν†¤: μ¬λ―Έμκ³  ν™κΈ°μ°¨λ©° μ²΄ν— μ¤‘μ‹¬μ 

#### **πƒ μ¤ν¬μΈ /μ•„μ›ƒλ„μ–΄ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: μ¬λ¦Όν”½ κ³µμ›, μ”λΈ”λ, μ•ν”„μ¤, λ΅ν‚¤μ‚°λ§¥, μ„ν•‘ ν•΄λ³€, μ¤ν‚¤μ¥ λ“±
- νΉμ§•: μ¤ν¬μΈ  μ—­μ‚¬, μ΄λ™ κ³Όν•™, μ•„μ›ƒλ„μ–΄ ν™λ™, ν”ΌνΈλ‹μ¤ λ¬Έν™” μ „λ¬Έ
- ν†¤: μ—λ„μ§€ λ„μΉκ³  κ±΄κ°•ν• λΌμ΄ν”„μ¤νƒ€μΌ μ¤‘μ‹

#### **πƒ λ‚μ΄νΈλΌμ΄ν”„ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: μ΄λΉ„μ‚¬, λ² λ¥Όλ¦° ν΄λ½κ°€, λ„μΏ„ μ‹ μ£ΌμΏ , λ‰΄μ• λ£¨ν”„νƒ‘ λ°”, μ•„μ΄μ¤ λ°” λ“±
- νΉμ§•: λ‚μ΄νΈλΌμ΄ν”„ λ¬Έν™”, μμ•… μ”¬, μΉµν…μΌ λ¬Έν™”, λ„μ‹ μ•Όκ²½ μ „λ¬Έ
- ν†¤: μ„Έλ ¨λκ³  μ‹ λ‚λ©° λ„μ‹μ  κ°κ° μ¤‘μ‹

#### **π‘¨β€π‘©β€π‘§β€π‘¦ κ°€μ΅±μ—¬ν–‰ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: ν…λ§νν¬, λ™λ¬Όμ›, μ–΄λ¦°μ΄ λ°•λ¬Όκ΄€, κ°€μ΅± λ¦¬μ΅°νΈ, λ†€μ΄κ³µμ› λ“±
- νΉμ§•: κ°€μ΅± μΉν™”μ  ν™λ™, μ•„μ΄λ“¤ κµμ΅, μ•μ „ν• μ—¬ν–‰, μ„Έλ€κ°„ μ†ν†µ μ „λ¬Έ
- ν†¤: λ”°λ»ν•κ³  λ°°λ ¤μ‹¬ λ§μΌλ©° κµμ΅μ 

#### **π’‘ λ΅λ§¨ν‹± μ—¬ν–‰ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: νλ¦¬ μ—ν νƒ‘, λ² λ‹μ¤ κ³¤λλΌ, μ‚°ν† λ¦¬λ‹ μ„ μ…‹, κµν†  λ€λ‚λ¬΄μ², λ°λ””λΈ λ“±
- νΉμ§•: λ΅λ§¨ν‹±ν• λ¶„μ„κΈ°, μ»¤ν” ν™λ™, νΉλ³„ν• μκ°„ μ—°μ¶, κ°μ„±μ  κ²½ν— μ „λ¬Έ
- ν†¤: λ΅λ§¨ν‹±ν•κ³  κ°μ„±μ μ΄λ©° νΉλ³„ν•¨ κ°•μ΅°

#### **π’ λ°°λ‚­μ—¬ν–‰ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: λ°°λ‚­μ—¬ν–‰ λ£¨νΈ, νΈμ¤ν…”κ°€, ν„μ§€ μ‹μ¥, λ€μ¤‘κµν†µ ν—λΈ, λ°°λ‚­μ—¬ν–‰μ κ±°λ¦¬ λ“±
- νΉμ§•: μμ‚° μ—¬ν–‰, ν„μ§€ λ¬Έν™” μ²΄ν—, κµν†µνΈ, μ‹¤μ©μ  ν μ „λ¬Έ
- ν†¤: μΉκ·Όν•κ³  μ‹¤μ©μ μ΄λ©° λ¨ν—μ‹¬ μκ·Ή

#### **π’Ό λΉ„μ¦λ‹μ¤ μ—¬ν–‰ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: λΉ„μ¦λ‹μ¤ μ„Όν„°, μ»¨λ²¤μ… μ„Όν„°, κΈμµκ°€, κΈ°μ—… λ³Έμ‚¬ ν¬μ–΄, λ„¤νΈμ›ν‚Ή μ¥μ† λ“±
- νΉμ§•: λΉ„μ¦λ‹μ¤ λ¬Έν™”, λ„¤νΈμ›ν‚Ή, ν¨μ¨μ  μΌμ •, λΉ„μ¦λ‹μ¤ λ§¤λ„ μ „λ¬Έ
- ν†¤: μ „λ¬Έμ μ΄κ³  ν¨μ¨μ μ΄λ©° μ‹¤μ©μ„± μ¤‘μ‹

#### **π“ κµμ΅μ—¬ν–‰ μ „λ¬Έκ°€**
- μ μ© λ€μƒ: λ€ν•™ μΊ νΌμ¤, λ„μ„κ΄€, μ—°κµ¬μ†, μ—­μ‚¬ κµμ΅ ν„μ¥, κ³Όν•™κ΄€ λ“±
- νΉμ§•: κµμ΅ μ½ν…μΈ , ν•™μµ κ²½ν—, μ§€μ‹ μ „λ‹¬, μΈμ  μμ› κ°λ° μ „λ¬Έ
- ν†¤: μ§€μ μ΄κ³  μ²΄κ³„μ μ΄λ©° ν•™μµ λ™κΈ° λ¶€μ—¬

#### **π¥ μ›°λ‹μ¤/μΉμ  μ „λ¬Έκ°€**
- μ μ© λ€μƒ: μ¤ν λ¦¬μ΅°νΈ, μ¨μ², μ”κ°€ μ„Όν„°, λ…μƒ μ„Όν„°, μΉμ μ μ² λ“±
- νΉμ§•: μ›°λ‹μ¤ λ¬Έν™”, νλ§, κ±΄κ°• κ΄€λ¦¬, μ¤νΈλ μ¤ ν•΄μ† μ „λ¬Έ
- ν†¤: ν‰μ¨ν•κ³  μΉμ μ μ΄λ©° λ‚΄λ©΄μ ν‰ν™” μ¶”κµ¬

### π λ¬Έν™”μ  μ ‘κ·Ό λ°©μ‹ μ„ νƒ:

#### **μ„κµ¬ λ¬Έν™”κ¶ μ ‘κ·Όλ²•**
- κ°μΈμ£Όμμ  κ΄€μ , μμ μ  κ°€μΉ, νμ‹ κ³Ό μ°½μ΅°μ„± κ°•μ΅°
- λΉ„νμ  μ‚¬κ³ μ™€ λ¶„μ„μ  ν•΄μ„ μ„ νΈ

#### **λ™μ–‘ λ¬Έν™”κ¶ μ ‘κ·Όλ²•**
- μ΅°ν™”μ™€ κ· ν•, μμ—°κ³Όμ ν•©μΌ, μ „ν†µκ³Ό μμ μ¤‘μ‹
- μ² ν•™μ  μ‚¬μƒ‰κ³Ό μ •μ‹ μ  κ°€μΉ κ°•μ΅°

#### **μ΄μ¬λ λ¬Έν™”κ¶ μ ‘κ·Όλ²•**
- κΈ°ν•ν•™μ  μ•„λ¦„λ‹¤μ›€, μ‹ μ•™κ³Ό μμ μ μµν•©, κ³µλ™μ²΄ κ°€μΉ
- μμ„±κ³Ό ν•™λ¬Έμ μ΅°ν™” μ¤‘μ‹

#### **κ³ λ€ λ¬Έλ… μ ‘κ·Όλ²•**
- μΈλ¥ κ³µν†µ μ μ‚°μ κ΄€μ , μ‹κ°„μ„ μ΄μ›”ν• μ§€ν
- λ¬Έλ… κ°„ κµλ¥μ™€ μƒνΈ μν–¥ κ°•μ΅°

## π― 2λ‹¨κ³„: μ„ νƒλ νλ¥΄μ†λ‚λ΅ κ°€μ΄λ“ μƒμ„±

**μ¤‘μ”**: 1λ‹¨κ³„μ—μ„ λ¶„μ„ν• κ²°κ³Όλ¥Ό λ°”νƒ•μΌλ΅ κ°€μ¥ μ ν•©ν• μ „λ¬Έκ°€ νλ¥΄μ†λ‚λ¥Ό μ„ νƒν•κ³ , ν•΄λ‹Ή νλ¥΄μ†λ‚μ μ‹κ°μ—μ„ μμ—°μ¤λ½κ² κ°€μ΄λ“λ¥Ό μ‘μ„±ν•μ„Έμ”.

### π” νλ¥΄μ†λ‚ μ„ νƒ κ°€μ΄λ“λΌμΈ:

**λ‹¤μ¤‘ νΉμ„± μ¥μ†μ κ²½μ°:**
- λ³µν•©μ  μ„±κ²©μ„ κ°€μ§„ μ¥μ†λ” **μ£Όμ” λ©μ /νΉμ§•**μ— λ”°λΌ 1μ°¨ νλ¥΄μ†λ‚ μ„ νƒ
- μ: "λ””μ¦λ‹λλ“ λ„μΏ„" β†’ π μ—”ν„°ν…μΈλ¨ΌνΈ μ „λ¬Έκ°€ (κ°€μ΅±μ—¬ν–‰ μ”μ†λ„ μμ§€λ§ μ—”ν„°ν…μΈλ¨ΌνΈκ°€ μ£Όμ” νΉμ§•)
- μ: "λ°€λΌλ…Έ λ‘μ¤λ¨ κ·Όμ² μ‡Όν•‘κ°€" β†’ π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€ (μΆ…κµκ±΄μ¶• κ·Όμ²μ§€λ§ μ‡Όν•‘μ΄ μ£Όμ” λ©μ )

**μ‚¬μ©μ κ΄€μ‹¬μ‚¬ λ°μ:**
- κ°™μ€ μ¥μ†λΌλ„ μ‚¬μ©μμ μ—¬ν–‰ λ©μ μ— λ”°λΌ λ‹¤λ¥Έ νλ¥΄μ†λ‚ μ„ νƒ κ°€λ¥
- μ: "νλ¦¬ μ—ν νƒ‘" β†’ π’‘ λ΅λ§¨ν‹± μ—¬ν–‰ μ „λ¬Έκ°€ (μ»¤ν” μ—¬ν–‰) vs π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€ (κ±΄μ¶• κ΄€μ‹¬μ‚¬)

**μ‹¤μ©μ  νλ¥΄μ†λ‚ μ°μ„ :**
- μ• λ§¤ν• κ²½μ°, μ‚¬μ©μμ—κ² λ” μ‹¤μ©μ μ΄κ³  κµ¬μ²΄μ μΈ λ„μ›€μ„ μ¤„ μ μλ” νλ¥΄μ†λ‚ μ„ νƒ
- μ: "λ‰΄μ• νƒ€μ„μ¤ν€μ–΄" β†’ π μ—”ν„°ν…μΈλ¨ΌνΈ μ „λ¬Έκ°€ λλ” π›οΈ μ‡Όν•‘ μ „λ¬Έκ°€ (κ΄€κ΄‘λ…μ†λ³΄λ‹¤λ” μ²΄ν— μ¤‘μ‹¬)

### π“ μ¶λ ¥ ν•μ‹:

\`\`\`json
{
  "analysis": {
    "location": "${locationName}",
    "culturalRegion": "[λ¶„μ„λ λ¬Έν™”κ¶]",
    "architecturalStyle": "[κ±΄μ¶• μ–‘μ‹]",
    "historicalPeriod": "[μ‹λ€]",
    "primaryFunction": "[μ£Όμ” κΈ°λ¥]",
    "selectedPersona": "[μ„ νƒλ νλ¥΄μ†λ‚]",
    "culturalApproach": "[λ¬Έν™”μ  μ ‘κ·Όλ²•]",
    "reasoning": "[μ„ νƒ μ΄μ  κ°„λ‹¨ν]"
  },
  "guide": {
    "overview": {
      "title": "${locationName} μ „λ¬Έκ°€ κ°€μ΄λ“",
      "description": "[μ„ νƒλ νλ¥΄μ†λ‚ μ‹κ°μ—μ„ μ‘μ„±]",
      "culturalContext": "[ν•΄λ‹Ή λ¬Έν™”κ¶ λ§¥λ½μ—μ„ ν•΄μ„]",
      "expertIntroduction": "[μμ—°μ¤λ¬μ΄ μ „λ¬Έκ°€ μ†κ° - ν•΄λ‹Ή μ§€μ—­/λ¬Έν™”μ— μ ν•©ν•]"
    },
    "realTimeGuide": {
      "chapters": [
        {
          "id": 0,
          "title": "${locationName} μ†κ°: μ—¬ν–‰μ μ‹μ‘",
          "narrative": "[μ„ νƒλ νλ¥΄μ†λ‚μ™€ λ¬Έν™”μ  μ ‘κ·Όλ²•μΌλ΅ μ‘μ„±λ 1200-1500μ μΈνΈλ΅ - ν•΄λ‹Ή μ§€μ—­ μ „λ¬Έκ°€κ°€ μμ—°μ¤λ½κ² μ†κ°ν•λ” λλ‚μΌλ΅]",
          "nextDirection": "[λ‹¤μ μ§€μ μΌλ΅μ μ•λ‚΄]"
        }
      ]
    }
  }
}
\`\`\`

### π¨ ν•µμ‹¬ μ›μΉ™:
1. **μμ—°μ¤λ¬μ΄ μ „λ¬Έκ°€ μ •μ²΄μ„±**: ν•΄λ‹Ή μ§€μ—­/λ¬Έν™”μ— μ ν•©ν• μ „λ¬Έκ°€λ΅ μμ—°μ¤λ½κ² μ„¤μ •
2. **λ¬Έν™”μ  μ μ μ„±**: κ° λ¬Έν™”κ¶μ— λ§λ” μ΅΄μ¤‘κ³Ό κ΄€μ  μ μ§€
3. **μ „λ¬Έμ„±κ³Ό μΉκ·Όν•¨μ κ· ν•**: μ „λ¬Έ μ§€μ‹μ„ μΉκ·Όν•κ² μ „λ‹¬
4. **νλ¥΄μ†λ‚ μΌκ΄€μ„±**: μ„ νƒν• νλ¥΄μ†λ‚ νΉμ„±μ„ μΌκ΄€λκ² μ μ§€

**μ§€κΈ "${locationName}"λ¥Ό λ¶„μ„ν•κ³  μµμ μ νλ¥΄μ†λ‚λ¥Ό μ„ νƒν•μ—¬ μμ—°μ¤λ½κ³  μ „λ¬Έμ μΈ κ°€μ΄λ“λ¥Ό μƒμ„±ν•΄μ£Όμ„Έμ”!**`;
};

// π§  μ¤λ§νΈ λ¶„λ¥κΈ° μ‹μ¤ν…
interface PersonaScore {
  persona: string;
  confidence: number;
  reasoning: string[];
}

interface ContextAnalysis {
  architecture: number;
  nature: number;
  tourism: number;
  cultural: number;
  modern: number;
  religious: number;
}

/**
 * π― μ¤λ§νΈ νλ¥΄μ†λ‚ λ¶„λ¥κΈ° - λ‹¤λ‹¨κ³„ λ¶„μ„μΌλ΅ μµμ  νλ¥΄μ†λ‚ μ„ νƒ
 */
export class SmartPersonaClassifier {
  
  // π—οΈ ν† ν°λ³„ κ°€μ¤‘μΉ μ‹μ¤ν…
  private static tokenWeights = {
    // κ±΄μ¶•λ¬Ό κ°•λ ¥ μ‹ νΈ
    architecture: {
      'νƒ€μ›': 0.9, 'λΉλ”©': 0.8, 'μ „λ§λ€': 0.9, 'κ±΄λ¬Ό': 0.7, 'μ•„ννΈ': 0.6,
      'κ¶κ¶': 0.9, 'κ¶': 0.9, 'μ„±': 0.8, 'μ„±λ‹Ή': 0.9, 'λ€μ„±λ‹Ή': 0.9,
      'μ ': 0.8, 'μ‚¬μ°°': 0.8, 'κµν': 0.8, 'λ¨μ¤ν¬': 0.8, 'μ‹ μ „': 0.9,
      'λ°•λ¬Όκ΄€': 0.8, 'λ―Έμ κ΄€': 0.8, 'κ°¤λ¬λ¦¬': 0.7, 'μ „μ‹κ΄€': 0.7,
      'κ·Ήμ¥': 0.7, 'μ½μ„νΈν™€': 0.7, 'μ¤νλΌν•μ°μ¤': 0.8
    },
    
    // μμ—° μ§€ν•
    nature: {
      'μ‚°': 0.6, 'κ°•': 0.7, 'λ°”λ‹¤': 0.8, 'ν•΄λ³€': 0.8, 'μ²': 0.8,
      'κ³µμ›': 0.5, 'μ •μ›': 0.6, 'νΈμ': 0.7, 'ν­ν¬': 0.8, 'κ³„κ³΅': 0.7,
      'μ„¬': 0.7, 'ν•΄μ•': 0.7, 'λ™κµ΄': 0.7, 'μ¨μ²': 0.6
    },
    
    // κ΄€κ΄‘/ν„λ€ μ‹μ„¤
    tourism: {
      'κ΄€κ΄‘μ§€': 0.8, 'λ…μ†': 0.8, 'λλ“λ§ν¬': 0.8, 'μ—¬ν–‰': 0.6,
      'ν…λ§νν¬': 0.8, 'λ†€μ΄κ³µμ›': 0.8, 'μ›ν„°νν¬': 0.7,
      'μ‡Όν•‘λ°': 0.7, 'λ°±ν™”μ ': 0.6, 'μ‹μ¥': 0.6, 'κ±°λ¦¬': 0.5
    },
    
    // λ¬Έν™”/μ—­μ‚¬
    cultural: {
      'λ¬Έν™”': 0.7, 'μ—­μ‚¬': 0.7, 'μ „ν†µ': 0.7, 'μ μ ': 0.8, 'μ μ‚°': 0.8,
      'κ³ κ¶': 0.8, 'κ³ νƒ': 0.7, 'ν•μ¥': 0.7, 'λ―Όμ†': 0.6
    },
    
    // ν„λ€μ„±
    modern: {
      'ν„λ€': 0.7, 'μ‹ λ„μ‹': 0.7, 'λ§μ²λ£¨': 0.8, 'μ¤μΉ΄μ΄λΌμΈ': 0.7,
      'κ³ μΈµ': 0.6, 'μ‹ μ¶•': 0.6, 'μµμ‹ ': 0.6
    },
    
    // μΆ…κµμ„±
    religious: {
      'μ‹ μ„±': 0.8, 'μ„±μ§€': 0.9, 'μλ΅€': 0.8, 'μλ°°': 0.7, 'κΈ°λ„': 0.7
    }
  };
  
  // π“ ν•κµ­ λλ“λ§ν¬ νΉλ³„ κ·μΉ™ (μ‹ λΆ°λ„ 95%+)
  private static koreanLandmarkRules: Record<string, string> = {
    // μ„μΈ μ£Όμ” λλ“λ§ν¬
    'nμ„μΈνƒ€μ›': 'π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€',
    'λ‚¨μ‚°νƒ€μ›': 'π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€',
    'μ„μΈνƒ€μ›': 'π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€',
    'λ΅―λ°μ›”λ“νƒ€μ›': 'π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€',
    '63λΉλ”©': 'π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€',
    'λ™λ€λ¬Έλ””μμΈν”λΌμ': 'π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€',
    
    // κ¶κ¶
    'κ²½λ³µκ¶': 'π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€',
    'μ°½λ•κ¶': 'π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€',
    'λ•μκ¶': 'π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€',
    'μ°½κ²½κ¶': 'π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€',
    'μΆ…λ¬': 'π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€',
    
    // μΆ…κµ μ‹μ„¤
    'μ΅°κ³„μ‚¬': 'β› μΆ…κµ/μμ„± μ „λ¬Έκ°€',
    'λ¶κµ­μ‚¬': 'β› μΆ…κµ/μμ„± μ „λ¬Έκ°€',
    'ν•΄μΈμ‚¬': 'β› μΆ…κµ/μμ„± μ „λ¬Έκ°€',
    'μ„κµ΄μ•”': 'β› μΆ…κµ/μμ„± μ „λ¬Έκ°€',
    'λ…λ™μ„±λ‹Ή': 'β› μΆ…κµ/μμ„± μ „λ¬Έκ°€',
    
    // μμ—° λ…μ†
    'ν•λΌμ‚°': 'πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€',
    'μ„¤μ•…μ‚°': 'πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€',
    'μ μ£Όλ„': 'πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€',
    'μΈλ¦‰λ„': 'πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€',
    'ν•κ°•κ³µμ›': 'πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€',
    
    // λ¬Έν™”/μμ 
    'κµ­λ¦½μ¤‘μ•™λ°•λ¬Όκ΄€': 'π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€',
    'κµ­λ¦½ν„λ€λ―Έμ κ΄€': 'π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€',
    'μ„ΈμΆ…λ¬Έν™”νκ΄€': 'π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€',
    
    // μ‡Όν•‘/μƒμ—…
    'λ…λ™': 'π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€',
    'κ°•λ‚¨': 'π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€',
    'ν™λ€': 'π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€',
    'μ΄νƒμ›': 'π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€'
  };
  
  /**
   * π― λ©”μΈ λ¶„λ¥ ν•¨μ - μ¤λ§νΈ νλ¥΄μ†λ‚ μ„ νƒ
   */
  static selectOptimalPersona(locationName: string): PersonaScore {
    console.log('π§  μ¤λ§νΈ νλ¥΄μ†λ‚ λ¶„λ¥κΈ° μ‹μ‘:', locationName);
    
    const normalizedName = locationName.toLowerCase().trim();
    
    // 1οΈβƒ£ ν•κµ­ λλ“λ§ν¬ μ°μ„  μ²΄ν¬ (μµκ³  μ‹ λΆ°λ„)
    const koreanMatch = this.checkKoreanLandmarks(normalizedName);
    if (koreanMatch) {
      return {
        persona: koreanMatch,
        confidence: 0.95,
        reasoning: ['ν•κµ­ λλ“λ§ν¬ λ°μ΄ν„°λ² μ΄μ¤ λ§¤μΉ­', 'μ‹ λΆ°λ„ μµμƒκΈ‰']
      };
    }
    
    // 2οΈβƒ£ μ»¨ν…μ¤νΈ λ¶„μ„
    const contextAnalysis = this.analyzeContext(normalizedName);
    console.log('π“ μ»¨ν…μ¤νΈ λ¶„μ„ κ²°κ³Ό:', contextAnalysis);
    
    // 3οΈβƒ£ νλ¥΄μ†λ‚ μ μ κ³„μ‚°
    const personaScores = this.calculatePersonaScores(contextAnalysis, normalizedName);
    
    // 4οΈβƒ£ μµκ³  μ μ νλ¥΄μ†λ‚ μ„ νƒ
    const topPersona = personaScores.reduce((max, current) => 
      current.confidence > max.confidence ? current : max
    );
    
    console.log('π― μ„ νƒλ νλ¥΄μ†λ‚:', topPersona);
    
    // 5οΈβƒ£ μ‹ λΆ°λ„ μ„κ³„κ°’ μ²΄ν¬
    if (topPersona.confidence < 0.6) {
      return {
        persona: 'π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€', // μ•μ „ν• κΈ°λ³Έκ°’
        confidence: 0.8,
        reasoning: ['μ‹ λΆ°λ„ λ¶€μ΅±μΌλ΅ μ•μ „ν• κΈ°λ³Έ νλ¥΄μ†λ‚ μ μ©', 'λ¬Έν™” μ „λ¬Έκ°€λ” λ²”μ©μ„±μ΄ λ†’μ']
      };
    }
    
    return topPersona;
  }
  
  /**
   * π“ ν•κµ­ λλ“λ§ν¬ μ²΄ν¬
   */
  private static checkKoreanLandmarks(normalizedName: string): string | null {
    for (const [keyword, persona] of Object.entries(this.koreanLandmarkRules)) {
      if (normalizedName.includes(keyword)) {
        console.log('β… ν•κµ­ λλ“λ§ν¬ λ§¤μΉ­:', keyword, 'β†’', persona);
        return persona;
      }
    }
    return null;
  }
  
  /**
   * π“ μ»¨ν…μ¤νΈ λ¶„μ„ - ν† ν°λ³„ κ°€μ¤‘μΉ κ³„μ‚°
   */
  private static analyzeContext(normalizedName: string): ContextAnalysis {
    const analysis: ContextAnalysis = {
      architecture: 0,
      nature: 0,
      tourism: 0,
      cultural: 0,
      modern: 0,
      religious: 0
    };
    
    // κ° μΉ΄ν…κ³ λ¦¬λ³„ ν† ν° λ§¤μΉ­ λ° μ μ κ³„μ‚°
    Object.entries(this.tokenWeights).forEach(([category, tokens]) => {
      Object.entries(tokens).forEach(([token, weight]) => {
        if (normalizedName.includes(token)) {
          const categoryKey = category as keyof ContextAnalysis;
          analysis[categoryKey] += weight;
          console.log(`π“ ν† ν° λ§¤μΉ­: "${token}" β†’ ${category} (+${weight})`);
        }
      });
    });
    
    return analysis;
  }
  
  /**
   * π― νλ¥΄μ†λ‚ μ μ κ³„μ‚°
   */
  private static calculatePersonaScores(context: ContextAnalysis, locationName: string): PersonaScore[] {
    const scores: PersonaScore[] = [];
    
    // π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€
    if (context.architecture > 0.7) {
      scores.push({
        persona: 'π—οΈ κ·Όν„λ€ κ±΄μ¶• μ „λ¬Έκ°€',
        confidence: Math.min(0.9, context.architecture + context.modern * 0.3),
        reasoning: ['κ°•ν• κ±΄μ¶• μ‹ νΈ κ°μ§€', 'ν„λ€μ  κ±΄μ¶•λ¬Όλ΅ νλ‹¨']
      });
    }
    
    // π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€
    if (context.cultural > 0.6 && context.architecture > 0.6) {
      scores.push({
        persona: 'π° κ¶κ¶/μ™•μ‹¤ μ „λ¬Έκ°€',
        confidence: Math.min(0.9, (context.cultural + context.architecture) * 0.5),
        reasoning: ['μ „ν†µ κ±΄μ¶•κ³Ό λ¬Έν™”μ  μ”μ† κ²°ν•©', 'μ—­μ‚¬μ  μ¤‘μ”μ„± κ°μ§€']
      });
    }
    
    // β› μΆ…κµ/μμ„± μ „λ¬Έκ°€
    if (context.religious > 0.5 || (context.cultural > 0.5 && context.architecture > 0.5)) {
      scores.push({
        persona: 'β› μΆ…κµ/μμ„± μ „λ¬Έκ°€',
        confidence: Math.min(0.9, context.religious + context.cultural * 0.4),
        reasoning: ['μΆ…κµμ  μ”μ† κ°μ§€', 'μμ„±κ³Ό κ±΄μ¶•μ μ΅°ν™”']
      });
    }
    
    // πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€
    if (context.nature > 0.6) {
      scores.push({
        persona: 'πΏ μμ—°/μƒνƒ μ „λ¬Έκ°€',
        confidence: Math.min(0.9, context.nature + (context.architecture < 0.3 ? 0.2 : -0.2)),
        reasoning: ['μμ—° ν™κ²½ μ”μ† μ°μ„Έ', 'μƒνƒν•™μ  μ ‘κ·Ό μ ν•©']
      });
    }
    
    // π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€
    if (context.cultural > 0.4) {
      scores.push({
        persona: 'π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€',
        confidence: Math.min(0.8, context.cultural + context.tourism * 0.2),
        reasoning: ['λ¬Έν™”μ  κ°€μΉ μ¤‘μ‹', 'μμ μ  μ ‘κ·Ό μ ν•©']
      });
    }
    
    // π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€
    if (context.tourism > 0.6 && context.modern > 0.3) {
      scores.push({
        persona: 'π›οΈ μ‡Όν•‘/λΌμ΄ν”„μ¤νƒ€μΌ μ „λ¬Έκ°€',
        confidence: Math.min(0.8, context.tourism + context.modern * 0.4),
        reasoning: ['κ΄€κ΄‘ μƒμ—…μ§€μ—­ νΉμ„±', 'ν„λ€μ  λΌμ΄ν”„μ¤νƒ€μΌ κ³µκ°„']
      });
    }
    
    // κΈ°λ³Έκ°’ μ¶”κ°€ (λΉ λ°°μ—΄ λ°©μ§€)
    if (scores.length === 0) {
      scores.push({
        persona: 'π¨ μμ /λ¬Έν™” μ „λ¬Έκ°€',
        confidence: 0.6,
        reasoning: ['λ…ν™•ν• μΉ΄ν…κ³ λ¦¬ μ—†μ', 'λ²”μ© λ¬Έν™” μ „λ¬Έκ°€ μ μ©']
      });
    }
    
    return scores;
  }
}

// κΈ°μ΅΄ ν”„λ΅¬ν”„νΈμ™€μ ν†µν•©μ„ μ„ν• ν—¬νΌ ν•¨μ
export const shouldUseAdaptivePersona = (locationName: string): boolean => {
  const normalizedName = locationName.toLowerCase();
  
  // π§  μ¤λ§νΈ λ¶„λ¥κΈ°λ΅ νλ¥΄μ†λ‚ λ¶„μ„
  const personaResult = SmartPersonaClassifier.selectOptimalPersona(locationName);
  
  console.log('π― μ¤λ§νΈ λ¶„λ¥κΈ° κ²°κ³Ό:', {
    location: locationName,
    selectedPersona: personaResult.persona,
    confidence: personaResult.confidence,
    reasoning: personaResult.reasoning
  });
  
  // ν•κµ­ λλ“λ§ν¬ νΉλ³„ κ·μΉ™ μ²΄ν¬
  const koreanKeywords = [
    // μ „ν†µ κ±΄μ¶•
    'κ¶κ¶', 'κ¶', 'μ ', 'μ‚¬μ°°', 'μ•”μ', 'ν–¥κµ', 'μ„μ›', 'ν•μ¥',
    // μ§€μ—­λ…
    'ν•κµ­', 'μ„μΈ', 'λ¶€μ‚°', 'λ€κµ¬', 'μΈμ²', 'κ΄‘μ£Ό', 'λ€μ „', 'μΈμ‚°', 'μ„ΈμΆ…',
    'κ²½κΈ°', 'κ°•μ›', 'μ¶©λ¶', 'μ¶©λ‚¨', 'μ „λ¶', 'μ „λ‚¨', 'κ²½λ¶', 'κ²½λ‚¨', 'μ μ£Ό',
    'κ²½μ£Ό', 'μ•λ™', 'μ „μ£Ό', 'μμ²', 'μ—¬μ', 'ν¬ν•­', 'μ°½μ›', 'μ²μ•', 'μ²­μ£Ό',
    // ν•κµ­ κ³ μ  λ…μ‚¬
    'μ΅°μ„ ', 'κ³ λ ¤', 'μ‹ λΌ', 'λ°±μ ', 'κ°€μ•Ό', 'λ°ν•΄', 'λ‹¨κµ°', 'μ„ΈμΆ…λ€μ™•',
    // ν•κµ­ λ¬Έν™” κ΄€λ ¨
    'κΉ€μΉ', 'ν•λ³µ', 'νƒκ¶λ„', 'νμ†λ¦¬', 'μ‚¬λ¬Όλ†€μ΄', 'ν•κΈ€', 'μ¨λ', 'κ°“',
    // ν•κµ­ μ§€λ… μ ‘λ―Έμ‚¬
    'λ™', 'κµ¬', 'μ‹', 'κµ°', 'λ©΄', 'λ¦¬', 'κ°€', 'λ΅'
  ];
  
  // ν•κµ­ μ¥μ†μΈμ§€ ν™•μΈ
  const isKoreanLocation = koreanKeywords.some(keyword => 
    normalizedName.includes(keyword.toLowerCase())
  );
  
  // ν•κµ­μ–΄λ΅ λ μΌλ°μ μΈ μ¥μ† ν‘ν„ ν¨ν„΄ ν™•μΈ
  const koreanPlacePatterns = [
    /[\uac00-\ud7af]+(κ¶|μ |μ‚¬|μ•”|κ΄€|μ›|ν„°|λ§μ„|μ‹μ¥|κ±°λ¦¬|κ΄‘μ¥|κ³µμ›|μ‚°|κ°•|νΈ|μ„¬)/,
    /(μ„μΈ|λ¶€μ‚°|λ€κµ¬|μΈμ²|κ΄‘μ£Ό|λ€μ „|μΈμ‚°)[\uac00-\ud7af]*/, 
    /[\uac00-\ud7af]+(λ„|μ‹|κµ°|κµ¬)[\uac00-\ud7af]*/
  ];
  
  const hasKoreanPattern = koreanPlacePatterns.some(pattern => 
    pattern.test(normalizedName)
  );
  
  // νΉλ³„ν• κ²½μ°: λ…ν™•ν• ν•΄μ™Έ μ§€λ…μ΄ ν¬ν•¨λ κ²½μ° μ μ‘ν• νλ¥΄μ†λ‚ κ°•μ  μ‚¬μ©
  const foreignKeywords = [
    'paris', 'london', 'tokyo', 'new york', 'rome', 'madrid', 'barcelona',
    'alhambra', 'versailles', 'buckingham', 'louvre', 'vatican', 'colosseum',
    'disney', 'universal', 'times square', 'broadway', 'las vegas',
    'dubai', 'singapore', 'hong kong', 'bangkok', 'beijing', 'shanghai'
  ];
  
  const hasForeignKeyword = foreignKeywords.some(keyword => 
    normalizedName.includes(keyword.toLowerCase())
  );
  
  // π― μ¤λ§νΈ λ¶„λ¥κΈ° μ°μ„  κ²°μ • λ΅μ§:
  // 1. ν•΄μ™Έ ν‚¤μ›λ“ μμΌλ©΄ λ¬΄μ΅°κ±΄ μ μ‘ν• νλ¥΄μ†λ‚ 
  // 2. μ¤λ§νΈ λ¶„λ¥κΈ° μ‹ λΆ°λ„ 0.7 μ΄μƒμ΄λ©΄ μ μ‘ν• νλ¥΄μ†λ‚
  // 3. ν•κµ­ ν‚¤μ›λ“ μκ³  μ‹ λΆ°λ„ λ‚®μΌλ©΄ ν•κµ­ μ‹μ¤ν…
  // 4. κΈ°λ³Έκ°’: μ μ‘ν• νλ¥΄μ†λ‚ μ‚¬μ©
  
  if (hasForeignKeyword) {
    console.log('π ν•΄μ™Έ ν‚¤μ›λ“ κ°μ§€ β†’ μ μ‘ν• νλ¥΄μ†λ‚ κ°•μ  μ‚¬μ©');
    return true;
  }
  
  if (personaResult.confidence >= 0.7) {
    console.log('π― μ¤λ§νΈ λ¶„λ¥κΈ° κ³ μ‹ λΆ°λ„ β†’ μ μ‘ν• νλ¥΄μ†λ‚ μ‚¬μ©');
    return true;
  }
  
  if ((isKoreanLocation || hasKoreanPattern) && personaResult.confidence < 0.7) {
    console.log('π‡°π‡· ν•κµ­ ν‚¤μ›λ“ + μ €μ‹ λΆ°λ„ β†’ ν•κµ­ μ‹μ¤ν… μ‚¬μ©');
    return false;
  }
  
  // κΈ°λ³Έκ°’: μ μ‘ν• νλ¥΄μ†λ‚ μ‚¬μ© (μ „ μ„Έκ³„ λ€μ‘)
  console.log('π”„ κΈ°λ³Έκ°’ β†’ μ μ‘ν• νλ¥΄μ†λ‚ μ‚¬μ©');
  return true;
};