"use strict";(()=>{var e={};e.id=364,e.ids=[364],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20629:e=>{e.exports=require("fs/promises")},55315:e=>{e.exports=require("path")},3235:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>E,requestAsyncStorage:()=>S,routeModule:()=>O,serverHooks:()=>y,staticGenerationAsyncStorage:()=>$});var a={};t.r(a),t.d(a,{POST:()=>j});var n=t(49303),s=t(88716),o=t(60670),i=t(11258),l=t(87070),u=t(56608),c=t(20629),p=t.n(c),d=t(55315),g=t.n(d);let m=new i.$D("AIzaSyBX31RqKOdt98m5cDOJft-3EIcJyPg6C5c"),h=g().join(process.cwd(),"saved-guides","history"),f=(e,r="ko")=>{let t={알함브라:"alhambra","알함브라 궁전":"alhambra-palace",메스키타:"mezquita","코르도바 메스키타":"mezquita-cordoba","코르도바 메스키타-카테드랄":"mezquita-cordoba","세비야 대성당":"seville-cathedral","히랄다 탑":"giralda-tower","사그라다 파밀리아":"sagrada-familia","구엘 공원":"park-guell","카사 밀라":"casa-mila","카사 바트요":"casa-batllo",몬세라트:"montserrat",플라멩코:"flamenco","레알 알카사르":"real-alcazar",에펠탑:"eiffel-tower","루브르 박물관":"louvre-museum","노트르담 대성당":"notre-dame-cathedral","베르사유 궁전":"versailles-palace",샹젤리제:"champs-elysees",몽마르트:"montmartre",개선문:"arc-de-triomphe",콜로세움:"colosseum",바티칸:"vatican","피사의 사탑":"leaning-tower-pisa",두오모:"duomo",베네치아:"venice",피렌체:"florence",성:"castle",궁전:"palace",대성당:"cathedral",성당:"church",박물관:"museum",공원:"park",광장:"square",다리:"bridge",탑:"tower"},a=e.toLowerCase();return t[e]?t[e]:(Object.entries(t).forEach(([r,t])=>{e.includes(r)&&(a=a.replace(r,t))}),a=a.replace(/[^a-zA-Z0-9가-힣\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),/[가-힣]/.test(a)&&(a=a.replace(/[가-힣]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"")),a||(a=`location-${Date.now()}`),a)},w=(e,r="ko")=>{let t=f(e,r),a=Date.now();return`${t}-${r}-${a}.json`},v=async(e,r="ko")=>{try{let t=f(e,r),a=(await p().readdir(h)).filter(e=>e.startsWith(t)&&e.includes(`-${r}-`)&&e.endsWith(".json")).sort((e,r)=>{let t=parseInt(e.split("-").pop()?.replace(".json","")||"0");return parseInt(r.split("-").pop()?.replace(".json","")||"0")-t});if(a.length>0){let e=a[0],r=g().join(h,e),t=await p().readFile(r,"utf-8");return JSON.parse(t)}return null}catch(e){return null}},x=async(e,r,t)=>{try{await p().mkdir(h,{recursive:!0});let a=w(e,r),n=g().join(h,a),s={...t,metadata:{originalLocationName:e,language:r,englishFileName:a,generatedAt:new Date().toISOString(),version:"2.0-multilingual"}};await p().writeFile(n,JSON.stringify(s,null,2),"utf-8")}catch(e){}};async function j(e){try{let{locationName:r,language:t="ko",userProfile:a}=await e.json();if(!r)return l.NextResponse.json({success:!1,error:"Location is required"},{status:400});let n=await v(r,t);if(n)return l.NextResponse.json({success:!0,data:n,cached:"file",language:t});let s=m.getGenerativeModel({model:"gemini-1.5-pro",generationConfig:{temperature:.3,topK:20,topP:.6,maxOutputTokens:8192}}),o=(0,u.bM)(r,t,a),i=(await s.generateContent(o)).response.text(),c=function(e){let r=e.replace(/^```(?:json)?\s*([\s\S]*?)\s*```$/g,"$1").trim(),t=r.indexOf("{");if(-1===t)throw Error("응답에서 JSON 시작(`{`)을 찾을 수 없습니다.");let a=(r=r.substring(t)).lastIndexOf("}");if(-1===a)throw Error("응답에서 JSON 끝(`}`)을 찾을 수 없습니다.");r=(r=r.substring(0,a+1)).replace(/\\(["\\\/bfnrtu])/g,(e,r)=>`__ESCAPED_${r.charCodeAt(0)}__`);let n=!1,s=[],o="";for(let e=0;e<r.length;e++){let t=r[e];'"'===t&&(0===e||"\\"!==r[e-1])?(n=!n,o+=t,n||(s.push(o),o="")):n?o+=t:" "===t||"\n"===t||"\r"===t||"	"===t?s.length>0&&" "!==s[s.length-1]&&s.push(" "):s.push(t)}o&&s.push(o),r=(r=s.join("").replace(/\s*([\{\}\[\],:])\s*/g,"$1").replace(/,(\s*[\}\]])(?=([^"]*"[^"]*")*[^"]*$)/g,"$1")).replace(/__ESCAPED_(\d+)__/g,(e,r)=>`\\${String.fromCharCode(parseInt(r))}`);try{return JSON.parse(r)}catch(e){throw Error(`JSON 파싱에 실패했습니다: ${e instanceof Error?e.message:"알 수 없는 오류"}`)}}(i);if(!c||!c.content)throw Error("AI 가이드 생성 또는 파싱에 실패했습니다.");return await x(r,t,c),l.NextResponse.json({success:!0,data:c,cached:"new",language:t,version:"2.0-multilingual"})}catch(r){let e=r instanceof Error?r.message:"An unknown error occurred";return l.NextResponse.json({success:!1,error:e,cached:"error"},{status:500})}}let O=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ai/generate-guide/route",pathname:"/api/ai/generate-guide",filename:"route",bundlePath:"app/api/ai/generate-guide/route"},resolvedPagePath:"C:\\guideai\\src\\app\\api\\ai\\generate-guide\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:S,staticGenerationAsyncStorage:$,serverHooks:y}=O,b="/api/ai/generate-guide/route";function E(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:$})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[380,972,258,608],()=>t(3235));module.exports=a})();